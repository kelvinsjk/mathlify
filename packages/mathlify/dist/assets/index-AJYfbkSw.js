var Mr=Object.defineProperty;var Nr=(e,t,r)=>t in e?Mr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var W=(e,t,r)=>(Nr(e,typeof t!="symbol"?t+"":t,r),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();class Ge{constructor(t){this.name=t}toString(){return this.name}toLexicalString(){return this.name}clone(){return new Ge(this.name)}}function ke(...e){if(e.length===0)throw new Error("no arguments provided to gcd function");if(e.length===1){const o=e[0];if(!Number.isInteger(o))throw new Error(`non-integer ${o} received in gcd function`);if(o===0)throw new Error("gcd(0) is undefined");return Math.abs(o)}if(e.length===2)return kt(e[0],e[1]);const[t,r,...n]=e;return t===0&&r===0?ke(0,...n):ke(kt(t,r),...n)}function kt(e,t){if(!Number.isInteger(e)||!Number.isInteger(t))throw new Error(`Non-integers (${e}, ${t}) received in gcd function`);if(e=Math.abs(e),t=Math.abs(t),e===0&&t===0)throw new Error("gcd(0,0) not defined");if(e===0||t===0)return Math.max(e,t);for(;t!==0;)[e,t]=[t,e%t];return e}function St(e,t){if(!Number.isInteger(e)||!Number.isInteger(t))throw new Error(`Non-integers (${e}, ${t}) received in lcm function`);if(e===0||t===0)throw new Error("lcm(0) is undefined");const r=ke(e,t);return Math.abs(e*t)/r}class F{constructor(t,r=1){W(this,"num");W(this,"den");W(this,"is",{positive:()=>this.valueOf()>0,negative:()=>this.valueOf()<0,zero:()=>this.valueOf()===0,nonzero:()=>!this.is.zero(),integer:()=>Number.isInteger(this.valueOf()),nonnegative:()=>this.valueOf()>=0,one:()=>this.num===this.den,negative_one:()=>this.num===-this.den});if(r===0)throw new RangeError("0 denominator received in fraction constructor");if(!Number.isInteger(t)||!Number.isInteger(r))throw console.error(`numerator and denominators should be integers. ${t} and ${r} received.`),new RangeError("non-integers received in Fraction constructor");this.num=t,this.den=r}_hoist_negative(){return this.den<0&&(this.num*=-1,this.den*=-1),this}simplify(){this._hoist_negative();const t=ke(this.num,this.den);return this.num/=t,this.den/=t,this}clone(){return new F(this.num,this.den)}valueOf(){return this.num/this.den}toString(t){let{mixedFractions:r}={mixedFractions:!1,...t};const n=this.num<0?`- ${-this.num}`:`${this.num}`;if(this.den===1)return n;if(this.den<0){const a=`- ${-this.den}`;return`\\frac{${n}}{${a}}`}const o=F.sign(this)===1?"":"- ";if(r&&Math.abs(this.valueOf())>1){const a=Math.floor(this.abs().valueOf()),l=Math.abs(this.num)%this.den;return`${o}${a}\\frac{${l}}{${this.den}}`}else{const a=Math.abs(this.num);return`${o}\\frac{${a}}{${this.den}}`}}toFixed(t){return this.valueOf().toFixed(t)}toPrecision(t){return this.valueOf().toPrecision(t)}plus(t){const r=new F(this.num*t.den+t.num*this.den,this.den*t.den);return r.simplify(),r}times(t){const r=new F(this.num*t.num,this.den*t.den);return r.simplify(),r}pow(t){if(t instanceof F&&(t=t.valueOf()),!Number.isInteger(t))throw new RangeError("fractional exponents not supported at the moment");const r=t<0;let n=this.clone();for(let o=1;o<Math.abs(t);o++)n=n.times(this);return r?n.reciprocal():n}reciprocal(){if(this.is.zero())throw new RangeError("reciprocal of 0 is undefined");const t=new F(this.den,this.num);return t.simplify(),t}divide(t){if(t.is.zero())throw new RangeError("division by 0 is undefined");return this.times(t.reciprocal())}abs(){return new F(Math.abs(this.num),Math.abs(this.den))}negative(){return new F(-this.num,this.den)}static sign(t){return Math.sign(t.valueOf())}static gcd(...t){if(t.length===0)throw new RangeError("no fractions received in gcd");if(t.length===1){const n=t[0];if(n.is.zero())throw new RangeError("gcd(0) is undefined");return n.abs()}if(t.length===2){const[n,o]=t;return new F(ke(n.num,o.num),St(n.den,o.den)).simplify()}let r=t[0];t.shift();for(let n of t)r=F.gcd(r,n);return r}static lcm(...t){const r=t.map(o=>o instanceof F?o:new F(o));if(r.length===0)throw new RangeError("no fractions received in lcm");if(r.length===1){const o=r[0];if(o.is.zero())throw new RangeError("lcm(0) is undefined");return o.abs()}if(r.length===2){const[o,a]=r;return new F(St(o.num,a.num),ke(o.den,a.den)).simplify()}let n=r[0];r.shift();for(let o of r)n=F.lcm(n,o);return n}}class k{constructor(t,r){W(this,"number");W(this,"is",{one:()=>this.number.is.one(),negative_one:()=>this.number.is.negative_one(),zero:()=>this.number.is.zero(),negative:()=>this.number.is.negative(),nonzero:()=>this.number.is.nonzero()});typeof t=="number"?t=new F(t):Array.isArray(t)?t=new F(t[0],t[1]):t=t.clone(),this.number=t;const{verbatim:n}={verbatim:!1,...r};n||this.simplify()}simplify(){return this.number.simplify(),this}toString(t){return this.number.toString(t)}toLexicalString(){return this.toString()}clone(){return new k(this.number.clone(),{verbatim:!0})}plus(t){return new k(this.number.plus(he(t)))}times(t){return t=he(t),new k(this.number.times(t))}reciprocal(){return new k(this.number.reciprocal())}divide(t){return t=he(t),new k(this.number.divide(t))}abs(){return new k(this.number.abs())}negative(){return new k(this.number.negative())}minus(t){return this.plus(he(t).negative())}subIn(){return this}valueOf(){return this.number.valueOf()}static min(t,r){return t.valueOf()<=r.valueOf()?t instanceof k?t.clone():new k(t).clone():r instanceof k?r.clone():new k(r).clone()}static max(t,r){return t.valueOf()>=r.valueOf()?t instanceof k?t.clone():new k(t).clone():r instanceof k?r.clone():new k(r).clone()}static gcd(t,r){const n=he(t),o=he(r);return new k(F.gcd(n,o))}static lcm(t,r){const n=he(t),o=he(r);return new k(F.lcm(n,o))}}function he(e){return typeof e=="number"&&(e=new F(e)),e instanceof k?e.number:e}class B{constructor(t,r){W(this,"baseExp");W(this,"powerExp");t=t instanceof v?t:new v(t),r=r instanceof v?r:new v(r),this.baseExp=t,this.powerExp=r}get base(){return this.baseExp.expression}get power(){return this.powerExp.expression}toString(t){let r=this.power.toString(t);r.length>1&&(r=`{${r}}`);let n=this.base.toString(t);return(this.base instanceof X||this.base instanceof D)&&(n=`\\left( ${n} \\right)`),`${n}^${r}`}toLexicalString(){return`(${this.base.toLexicalString()})^(${this.power.toLexicalString()})`}clone(){return new B(this.base.clone(),this.power.clone())}simplify(t){return this.baseExp.simplify(t),this.powerExp.simplify(t),this}subIn(t,r){return this.baseExp.subIn(t,r),this.powerExp.subIn(t,r),this}}class D{constructor(...t){W(this,"coeff");W(this,"_factorsExp");W(this,"is",{negative:()=>this.coeff.number.is.negative()});if(t.length===0){this.coeff=new k(1),this._factorsExp=[];return}let r=new k(1),n=t[0];(n instanceof F||typeof n=="number")&&(n=new k(n,{verbatim:!0})),n instanceof k&&(n=new v(n)),n instanceof v&&n.expression instanceof k&&(r=n.expression,t.shift()),this._factorsExp=t.map(o=>o instanceof v?o:new v(o)),this.coeff=r}toString(t){const{multiplicationSign:r,mixedFractions:n}={multiplicationSign:"",mixedFractions:!1,...t};if(this.factors.length===0)return this.coeff.toString();let o=this.coeff.is.one()?"":this.coeff.is.negative_one()?"- ":`${this.coeff}`;r&&this.coeff.is.negative_one()&&(o="- 1");for(let a of this.factors){const l=o===""?"":r;a instanceof k&&a.number.is.negative()||a instanceof X&&a.terms.length>1?o+=`${l}\\left( ${a.toString(t)} \\right)`:o+=`${l}${a.toString(t)}`}return o}toLexicalString(t){const{coeff:r}={coeff:!0,...t};return(r?this.coeff.toLexicalString():"")+this._factorsExp.map(o=>o.toLexicalString()).toSorted().join("*")}toUnit(){const t=this._factorsExp.map(r=>r.clone());return new v(new D(1,...t)).simplify()}clone(){const t=this._factorsExp.map(r=>r.clone());return new D(this.coeff.clone(),...t)}simplify(t){const{product:r,numeral:n,sum:o,quotient:a,exponent:l,brackets:u}={product:!0,numeral:!0,sum:!0,quotient:!0,exponent:!0,brackets:!0,...t};for(let h of this._factorsExp)h.simplify({product:r,numeral:n,sum:o,quotient:a,exponent:l,brackets:u});return r&&(this._flatten(),this._combine_factors()),this}_combine_factors(){const t={},r=[],n=[];for(const[o,a]of this.factors.entries())if(a instanceof B&&a.power instanceof k){const l=a.base.toLexicalString(),u=t[l];u?(u[0].push(o),u[1]=u[1].plus(a.power)):(r.push(l),t[l]=[[o],a.power,a.baseExp.clone()])}else if(a instanceof k)this.coeff=this.coeff.times(a),n.push(o);else{const l=a.toLexicalString(),u=t[l];u?(u[0].push(o),u[1]=u[1].plus(1)):(r.push(l),t[l]=[[o],new k(1),this._factorsExp[o]])}for(const o of r){const[a,l,u]=t[o];if(a.length>1)if(l.is.zero())n.push(...a);else{const h=l.is.one()?u:new v(new B(u,l));this._factorsExp[a[0]]=h,n.push(...a.slice(1))}}return this._factorsExp=this._factorsExp.filter((o,a)=>!n.includes(a)),this}_flatten(){let t=this.coeff,r=[];for(const n of this.factors)n instanceof X?(n._flatten(),r.push(n)):n instanceof D?(n._flatten(),t=t.times(n.coeff),r=r.concat(n.factors)):r.push(n);return this._factorsExp=r.map(n=>new v(n)),this.coeff=t,this}subIn(t,r){for(const n of this._factorsExp)n.subIn(t,r);return this}get factors(){return this._factorsExp.map(t=>t.expression)}}class X{constructor(...t){W(this,"_termsExp");const r=t.map(n=>n instanceof v?n:new v(n));this._termsExp=r}toString(t){if(this.terms.length===0)return"0";if(this.terms.length===1)return this.terms[0].toString();let n=`${this.terms[0].toString(t)}`;for(const o of this.terms.slice(1))o instanceof k&&o.is.negative()||o instanceof D&&o.is.negative()?n+=` ${o.toString(t)}`:n+=` + ${o.toString(t)}`;return n}toLexicalString(){return this._termsExp.map(t=>t.toLexicalString()).toSorted().join("+")}clone(){const t=this._termsExp.map(r=>r.clone());return new X(...t)}simplify(t){const{product:r,numeral:n,sum:o,quotient:a,exponent:l,brackets:u}={product:!0,numeral:!0,sum:!0,quotient:!0,exponent:!0,brackets:!0,...t};for(let h of this._termsExp)h.simplify({product:r,numeral:n,sum:o,quotient:a,exponent:l,brackets:u});return o&&(this._flatten(),this._combine_like_terms(),this._remove_zeroes()),this}_remove_zeroes(){return this._termsExp=this._termsExp.filter(t=>{const r=t.expression;return r instanceof k?r.number.is.nonzero():!0}),this}_flatten(){const t=[];for(const r of this.terms)r instanceof X?(r._flatten(),t.push(...r.terms)):(r instanceof D&&r._flatten(),t.push(r));return this._termsExp=t.map(r=>new v(r)),this}_combine_like_terms(){const t={},r=[];for(const[o,a]of this.terms.entries()){const l=a instanceof k?"numeral":a.toLexicalString({coeff:!1}),u=t[l];u?(u[0].push(o),a instanceof D?u[1]=u[1].plus(a.coeff):a instanceof k?u[1]=u[1].plus(a.number):u[1]=u[1].plus(1)):(r.push(l),a instanceof D?t[l]=[[o],a.coeff,a.toUnit()]:a instanceof k?t[l]=[[o],a.clone(),new v(1)]:t[l]=[[o],new k(1),new v(a).clone()])}const n=[];for(const o of r){const[a,l,u]=t[o];if(a.length>1){const h=a[0];o==="numeral"?this._termsExp[h].expression=l:this._termsExp[h].expression=new D(l,u).simplify(),n.push(...a.slice(1))}}return this._termsExp=this._termsExp.filter((o,a)=>!n.includes(a)),this}subIn(t,r){for(const n of this._termsExp)n.subIn(t,r);return this}get terms(){return this._termsExp.map(t=>t.expression)}}class Z{constructor(t,r){W(this,"num");W(this,"den");t=t instanceof v?t:new v(t),r=r instanceof v?r:new v(r),this.num=t,this.den=r}toString(t){return`\\frac{${this.num.toString(t)}}{${this.den.toString(t)}}`}toLexicalString(){return`(${this.num.toLexicalString()})/(${this.den.toLexicalString()})`}clone(){return new Z(this.num.clone(),this.den.clone())}simplify(t){const{product:r,numeral:n,sum:o,quotient:a,brackets:l}={brackets:!0,product:!0,numeral:!0,sum:!0,quotient:!0,...t};return this.num.simplify({product:r,numeral:n,sum:o,quotient:a,brackets:l}),this.den.simplify({product:r,numeral:n,sum:o,quotient:a,brackets:l}),this}subIn(t,r){return this.num.subIn(t,r),this.den.subIn(t,r),this}}class je{constructor(t){W(this,"expression");this.expression=t instanceof v?t:new v(t)}toString(){return`\\left( ${this.expression} \\right)`}toLexicalString(){return`(${this.expression.toLexicalString()})`}clone(){return new je(this.expression.clone())}subIn(t,r){return this.expression.subIn(t,r),this}}class ye{constructor(t){W(this,"fn");this.fn=t}toString(){return this.fn.toString()}toLexicalString(){return this.fn.toLexicalString()}clone(){return new ye(this.fn.clone())}subIn(t,r){return this.fn.subIn(t,r),this}}class v{constructor(t){W(this,"expression");W(this,"multiplicationSign","");W(this,"mixedFractions",!1);typeof t=="string"?t=new Ge(t):typeof t=="number"||t instanceof F?t=new k(t,{verbatim:!0}):t instanceof je&&(t=new ye(t)),this.expression=t}toString(t){return t={multiplicationSign:this.multiplicationSign,mixedFractions:this.mixedFractions,...t},this.expression.toString(t)}toLexicalString(t){return this.expression.toLexicalString(t)}simplify(t){t===void 0&&(t={brackets:!0,product:!0,sum:!0,numeral:!0,quotient:!0,exponent:!0});const{brackets:r,product:n,sum:o,numeral:a,quotient:l,exponent:u}={brackets:!1,product:!1,sum:!1,numeral:!1,quotient:!1,exponent:!1,...t};return r&&this._remove_brackets(),a&&this.expression instanceof k&&this.expression.simplify(),(this.expression instanceof X||this.expression instanceof D||this.expression instanceof Z||this.expression instanceof B)&&this.expression.simplify({product:n,sum:o,numeral:a,quotient:l,exponent:u,brackets:r}),u&&this._simplify_exponent(),this._remove_singletons({product:n,sum:o,quotient:l}),this}_remove_singletons(t){const{product:r,sum:n,quotient:o}={product:!0,sum:!0,quotient:!0,...t};return n&&this.expression instanceof X?this.expression.terms.length===0?this.expression=new k(0):this.expression.terms.length===1&&(this.expression=this.expression.terms[0]):r&&this.expression instanceof D?this.expression._factorsExp.length===0?this.expression=this.expression.coeff:this.expression.coeff.is.zero()?this.expression=new k(0):this.expression._factorsExp.length===1&&this.expression.coeff.is.one()&&(this.expression=this.expression.factors[0]):o&&this.expression instanceof Z&&(this.expression.num.expression instanceof k&&this.expression.num.expression.number.is.zero()?this.expression=new k(0):this.expression.den.expression instanceof k&&this.expression.den.expression.number.is.one()?this.expression=this.expression.num.expression:this.expression.num.expression instanceof k&&this.expression.den.expression instanceof k&&(this.expression=this.expression.num.expression.divide(this.expression.den.expression))),this}_remove_brackets(){if(this.expression instanceof X)for(const t of this.expression._termsExp)t._remove_brackets();else if(this.expression instanceof D)for(const t of this.expression._factorsExp)t._remove_brackets();return this.expression instanceof ye&&(this.expression=this.expression.fn.expression.expression),this}_simplify_exponent(){const t=this.expression;if(!(t instanceof B))return this;const{base:r,power:n}=t;return r instanceof k&&n instanceof k&&n.number.is.integer()?this.expression=new k(r.number.pow(n.number)):n instanceof k&&n.number.is.zero()?this.expression=new k(1):n instanceof k&&n.number.is.one()&&(this.expression=r),this}expand(t){const r=this.expression;if(r instanceof D){for(const o of r._factorsExp)o.expand(t);return this._expand_product(t)}else if(r instanceof X){for(const o of r._termsExp)o.expand(t);r._flatten()}else if(r instanceof Z){const{numerator:o}={numerator:!1,...t};r.num.expand(t),o||r.den.expand(t)}const{verbatim:n}={verbatim:!1,...t};return n||this.simplify(),this}_expand_product(t){const r=this.expression;if(!(r instanceof D))return this;const n=[],o=[];for(const h of r.factors)h instanceof X?n.push(h):o.push(h);if(n.length===0||n.length===1&&r.coeff.is.one())return this;let a=n[0].terms.map(h=>new D(r.coeff,...o,h).simplify());n.shift();for(const h of n){const g=[];for(const y of a)for(const _ of h.terms)g.push(new D(y,_).simplify());a=g}const l=new X(...a);l._flatten(),this.expression=l;const{verbatim:u}={verbatim:!1,...t};return u||l.simplify(),this}negative(){const t=this.expression;if(t instanceof k)return new v(t.negative());if(t instanceof D)return new v(new D(-1,...t.factors));throw new Error("negative not supported for this type at the moment")}subIn(t,r){const{verbatim:n}={verbatim:!1,...r},o={};for(const[a,l]of Object.entries(t)){const u=be(l),h=u instanceof v?u:new v(u);o[a]=h}if(this.expression instanceof Ge){const a=this.expression.name;a in o&&(this.expression=o[a].expression)}else this.expression.subIn(o,{verbatim:n});return n||this.simplify(),this}clone(){let t=new v(this.expression.clone());return t.multiplicationSign=this.multiplicationSign,t}combine_fraction(){return this._common_denominator(),this._combine_fraction(),this.expand({numerator:!0}),this}_common_denominator(){const t=this.expression;if(!(t instanceof X))throw new Error("common denominator only supported for sums");const r=v.denominator_lcm(...t._termsExp),n=r.expression;if(n instanceof k&&n.is.one())return this;const o=[];for(const a of t.terms)if(a instanceof k)a.is.negative()?o.push(new v(new D(-1,new Z(new D(a.abs(),n).simplify(),n)))):o.push(new v(new Z(new D(a,n).simplify(),n)));else if(a instanceof Z){const l=At(r,a.den.expression),u=new v(new D(l.coeff,a.num,...l.factors)).simplify();o.push(new v(new Z(u,n)))}else if(a instanceof D&&a.coeff.is.negative())if(a.factors.length===1&&a.factors[0]instanceof Z){const l=At(r,a.factors[0].den.expression),u=new v(new D(l.coeff,a.factors[0].num,...l.factors)).simplify();o.push(new v(new D(-1,new Z(u,n))))}else o.push(new v(new D(-1,new Z(new D(a.coeff.abs(),...a.factors,n).simplify(),n))));else o.push(new v(new Z(new D(a,n).simplify(),n)));return t._termsExp=o,this}_combine_fraction(t){const{verbatim:r}={verbatim:!1,...t},n=[],o=this.expression;if(!(o instanceof X))throw new Error("common denominator only supported for sums");let a;for(const l of o.terms){if(l instanceof Z)a=a??l.den,n.push(l.num);else if(l instanceof D&&l.coeff.is.negative()&&l.factors.length===1&&l.factors[0]instanceof Z){const u=l.factors[0];a=a??u.den,n.push(new D(-1,u.num))}//! assumption: no other cases should be possible
}return a===void 0?this:(this.expression=new Z(new X(...n),a),r||this.simplify(),this)}static brackets(t){const r=t instanceof ye?t:new ye(new je(t));return new v(r)}static denominator_lcm(...t){if(t.length===0)throw new Error("Cannot find denominator lcm of empty array");if(t.length===1){let o=t[0].expression;return o instanceof k?new v(new k(o.number.den).abs()):o instanceof Z?new v(o.den.expression.clone()):o instanceof D&&o.coeff.is.negative()&&o.factors.length===1?v.denominator_lcm(o._factorsExp[0]):new v(1)}if(t.length===2){const[o,a]=t,l=v.denominator_lcm(o),u=v.denominator_lcm(a);return v._lcmTwo(l,u)}const r=t.map(o=>v.denominator_lcm(o));let n=v._lcmTwo(r[0],r[1]);r.shift(),r.shift();for(const o of r)n=v._lcmTwo(n,o);return n}static _gcdTwo(t,r){const n=t.expression,o=r.expression;if(n instanceof B&&n.power instanceof k){if(o instanceof B&&o.power instanceof k)return n.base.toLexicalString()===o.base.toLexicalString()?new v(new B(n.base.clone(),k.min(n.power,o.power))):new v(1);if(o instanceof D){for(const a of o.factors)if(a instanceof B&&a.power instanceof k&&a.base.toLexicalString()===n.base.toLexicalString())return new v(new B(n.base.clone(),k.min(n.power,a.power)));return new v(1)}else return n.base.toLexicalString()==r.toLexicalString()?r.clone():new v(1)}else if(n instanceof D){if(o instanceof B&&o.power instanceof k)return v._gcdTwo(r,t);if(o instanceof D){const a={},l=[];for(const h of n.factors)if(h instanceof B&&h.power instanceof k){const g=h.base.toLexicalString();l.push(g),a[g]=[h.power,h.baseExp.clone()]}else{const g=h.toLexicalString();l.push(g),a[g]=[new k(1),new v(h.clone())]}for(const h of o.factors)if(h instanceof B&&h.power instanceof k){const g=h.base.toLexicalString(),y=a[g];y&&(y[0]=k.min(h.power,y[0]),y[2]=!0)}else{const g=h.toLexicalString(),y=a[g];y&&(y[0]=k.min(1,y[0]),y[2]=!0)}for(const[h,g]of Object.entries(a))g[2]===void 0&&delete a[h];const u=[];for(const h of l){const g=a[h];if(g){const[y,_]=g;y.is.one()?u.push(_):y.is.nonzero()&&u.push(new v(new B(_,y)))}}return new v(new D(k.gcd(n.coeff,o.coeff),...u)).simplify()}else{if(o instanceof k)return new v(k.gcd(n.coeff,o));for(const a of n.factors)if(a instanceof B&&a.power instanceof k){if(a.base.toLexicalString()===o.toLexicalString())return r.clone()}else if(a.toLexicalString()===o.toLexicalString())return r.clone();return new v(1)}}else return t.toLexicalString()===r.toLexicalString()?t.clone():new v(1)}static _lcmTwo(t,r){const n=t.expression,o=r.expression;if(n instanceof D)if(o instanceof D){const a={},l=[];for(const h of n.factors)if(h instanceof B&&h.power instanceof k){const g=h.base.toLexicalString();l.push(g),a[g]=[h.power,h.baseExp.clone()]}else{const g=h.toLexicalString();l.push(g),a[g]=[new k(1),new v(h.clone())]}for(const h of o.factors)if(h instanceof B&&h.power instanceof k){const g=h.base.toLexicalString(),y=a[g];y?y[0]=k.max(h.power,y[0]):(a[g]=[h.power,h.baseExp.clone()],l.push(g))}else{const g=h.toLexicalString(),y=a[g];y?y[0]=k.max(1,y[0]):(a[g]=[new k(1),new v(h.clone())],l.push(g))}const u=[];for(const h of l){const g=a[h];if(g){const[y,_]=g;y.is.one()?u.push(_):y.is.nonzero()&&u.push(new v(new B(_,y)))}}return new v(new D(k.lcm(n.coeff,o.coeff),...u)).simplify()}else{if(o instanceof k)return new v(new D(k.lcm(n.coeff,o),...n.factors)).simplify();{const a=[];let l=!0;for(const u of n.factors)u instanceof B&&u.power instanceof k&&o instanceof B&&o.power instanceof k&&u.base.toLexicalString()===o.base.toLexicalString()?(a.push(new B(u.base,k.max(u.power,o.power))),l=!1):u instanceof B&&u.power instanceof k&&u.base.toLexicalString()===o.toLexicalString()?(a.push(new B(u.base,k.max(u.power,new k(1)))),l=!1):u.toLexicalString()===o.toLexicalString()?(a.push(u.clone()),l=!1):a.push(u);return l&&a.push(o),new v(new D(n.coeff,...a)).simplify()}}else return o instanceof D?v._lcmTwo(r,t):n instanceof B&&n.power instanceof k?o instanceof B&&o.power instanceof k?n.base.toLexicalString()===o.base.toLexicalString()?new v(new B(n.base.clone(),k.max(n.power,o.power))):new v(new D(t.clone(),r.clone())).simplify():n.base.toLexicalString()===o.toLexicalString()?n.power.valueOf()>=1?t.clone():r.clone():new v(new D(t.clone(),r.clone())).simplify():o instanceof B&&o.power instanceof k?v._lcmTwo(r,t):n instanceof k?o instanceof k?new v(k.lcm(n,o)):new v(new D(n,r.clone())).simplify():o instanceof k?v._lcmTwo(r,t):t.toLexicalString()===r.toLexicalString()?t.clone():new v(new D(t.clone(),r.clone())).simplify()}}function At(e,t){if(e.expression instanceof k)return new D(e.expression.divide(t));const r=e.expression instanceof D?e.expression:new D(e.expression);if(t instanceof k)return new D(r.coeff.divide(t),...r.factors);if(t instanceof B){const n=[];for(const o of r.factors)o instanceof B&&o.base.toLexicalString()===t.base.toLexicalString()&&o.power instanceof k&&t.power instanceof k?n.push(new B(o.base,o.power.minus(t.power))):n.push(o);return new D(r.coeff,...n)}else if(t instanceof D){const n=[];for(const o of r.factors){let a=!1;if(o instanceof B&&o.power instanceof k){for(const l of t.factors)if(l instanceof B&&l.base.toLexicalString()===o.base.toLexicalString()&&l.power instanceof k){n.push(new B(o.base,o.power.minus(l.power))),a=!0;break}else if(l.toLexicalString()===o.base.toLexicalString()){n.push(new B(o.base,o.power.minus(1))),a=!0;break}}else for(const l of t.factors)if(o.toLexicalString()===l.toLexicalString()){a=!0;break}a||n.push(o)}return new D(r.coeff.divide(t.coeff),...n)}else{const n=[];for(const o of r.factors)o instanceof B&&o.base.toLexicalString()===t.toLexicalString()&&o.power instanceof k?n.push(new B(o.base,o.power.minus(1))):o.toLexicalString()!==t.toLexicalString()&&n.push(o);return new D(r.coeff,...n)}}function Re(e,t=1,r){const n=new k([e,t],r);return new v(n)}function ee(...e){const t=[];for(const r of e){const n=or(r);Array.isArray(n)?t.push(ve(...n)):t.push(n)}return new v(new X(...t))}function ve(...e){const t=[];for(const r of e){const n=or(r);Array.isArray(n)?t.push(ee(...n)):t.push(n)}return new v(new D(...t))}function Qe(e){return v.brackets(be(e))}function De(e,t,r){const{verbatim:n}={verbatim:!1,...r},o=be(e),a=be(t),l=new v(new Z(o,a));return n||l.simplify(),l}function or(...e){let t=e[0];if(Array.isArray(t)){if(t.length===3&&t[1]==="/"&&typeof t[0]=="number"&&typeof t[2]=="number")return Re(t[0],t[2]);if(t.length===2&&t[0]==="()"){const r=t[1];if(Array.isArray(r))if(r.length===3){const[n,o,a]=r;return v.brackets(De(n,a)).simplify()}else throw new Error("unexpected nested brackets");else return v.brackets(r)}else if(t.length===2&&typeof t[1]=="number"&&(typeof t[0]=="string"||t[0]instanceof v)){const[r,n]=t,o=r instanceof v?r:new v(r),a=new B(o,n);return new v(a)}else if(t.length===2&&t[0]==="-"){const[r,n]=t;return new v(new D(-1,be(n)))}else{const r=[];for(const n of t)if(Array.isArray(n))if(n.length===3&&n[1]==="/"){const[o,a,l]=n;r.push(De(o,l).simplify())}else if(n.length===2&&n[0]==="()"&&(n[1]instanceof v||typeof n[1]=="number"||typeof n[1]=="string"))r.push(v.brackets(n[1]));else if(n.length===2&&typeof n[1]=="number"&&(typeof n[0]=="string"||n[0]instanceof v)){const[o,a]=n,l=o instanceof v?o:new v(o),u=new B(l,a);r.push(new v(u))}else if(n.length===2&&n[0]==="-"){const[o,a]=n;r.push(new v(new D(-1,be(a))))}else throw new Error("unexpected nested arrays");else r.push(n);return r}}else return t}function be(e){if(Array.isArray(e))if(e.length===3&&e[1]==="/"){const[t,r,n]=e;return De(t,n).simplify()}else if(e.length===2&&e[0]==="()"){const t=e[1];if(Array.isArray(t))if(t.length===3){const[r,n,o]=t;return v.brackets(De(r,o))}else throw new Error("unexpected nested brackets");else return v.brackets(t)}else if(e.length===2&&typeof e[1]=="number"&&(typeof e[0]=="string"||e[0]instanceof v)){const[t,r]=e,n=t instanceof v?t:new v(t),o=new B(n,r);return new v(o)}else if(e.length===2&&e[0]==="-"){const[t,r]=e;return new v(new D(-1,be(r)))}else throw new Error("unexpected array");else return e}class w{constructor(t,r){let n=" "+t,o;const a=r&&r.loc;if(a&&a.start<=a.end){const u=a.lexer.input;o=a.start;const h=a.end;o===u.length?n+=" at end of input: ":n+=" at position "+(o+1)+": ";const g=u.slice(o,h).replace(/[^]/g,"$&̲");let y;o>15?y="…"+u.slice(o-15,o):y=u.slice(0,o);let _;h+15<u.length?_=u.slice(h,h+15)+"…":_=u.slice(h),n+=y+g+_}const l=new Error(n);return l.name="ParseError",l.__proto__=w.prototype,l.position=o,l}}w.prototype.__proto__=Error.prototype;const Lr=function(e,t){return e===void 0?t:e},Er=/([A-Z])/g,zr=function(e){return e.replace(Er,"-$1").toLowerCase()},Ir={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},Fr=/[&><"']/g;function Pr(e){return String(e).replace(Fr,t=>Ir[t])}const Te=function(e){return e.type==="ordgroup"||e.type==="color"?e.body.length===1?Te(e.body[0]):e:e.type==="font"?Te(e.body):e},Rr=function(e){const t=Te(e);return t.type==="mathord"||t.type==="textord"||t.type==="atom"},Gr=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e},jr=function(e){const t=/^\s*([^\\/#]*?)(?::|&#0*58|&#x0*3a)/i.exec(e);return t!=null?t[1]:"_relative"},Ur=function(e){return+e.toFixed(4)};var L={deflt:Lr,escape:Pr,hyphenate:zr,getBaseElem:Te,isCharacterBox:Rr,protocolFromUrl:jr,round:Ur};class at{constructor(t){t=t||{},this.displayMode=L.deflt(t.displayMode,!1),this.annotate=L.deflt(t.annotate,!1),this.leqno=L.deflt(t.leqno,!1),this.throwOnError=L.deflt(t.throwOnError,!1),this.errorColor=L.deflt(t.errorColor,"#b22222"),this.macros=t.macros||{},this.wrap=L.deflt(t.wrap,"tex"),this.xml=L.deflt(t.xml,!1),this.colorIsTextColor=L.deflt(t.colorIsTextColor,!1),this.strict=L.deflt(t.strict,!1),this.trust=L.deflt(t.trust,!1),this.maxSize=t.maxSize===void 0?[1/0,1/0]:Array.isArray(t.maxSize)?t.maxSize:[1/0,1/0],this.maxExpand=Math.max(0,L.deflt(t.maxExpand,1e3))}isTrusted(t){return t.url&&!t.protocol&&(t.protocol=L.protocolFromUrl(t.url)),!!(typeof this.trust=="function"?this.trust(t):this.trust)}}const sr={},Ue={};function q({type:e,names:t,props:r,handler:n,mathmlBuilder:o}){const a={type:e,numArgs:r.numArgs,argTypes:r.argTypes,allowedInArgument:!!r.allowedInArgument,allowedInText:!!r.allowedInText,allowedInMath:r.allowedInMath===void 0?!0:r.allowedInMath,numOptionalArgs:r.numOptionalArgs||0,infix:!!r.infix,primitive:!!r.primitive,handler:n};for(let l=0;l<t.length;++l)sr[t[l]]=a;e&&o&&(Ue[e]=o)}function xe({type:e,mathmlBuilder:t}){q({type:e,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},mathmlBuilder:t})}const Oe=function(e){return e.type==="ordgroup"&&e.body.length===1?e.body[0]:e},P=function(e){return e.type==="ordgroup"?e.body:[e]};class lt{constructor(t){this.children=t,this.classes=[],this.style={}}hasClass(t){return this.classes.includes(t)}toNode(){const t=document.createDocumentFragment();for(let r=0;r<this.children.length;r++)t.appendChild(this.children[r].toNode());return t}toMarkup(){let t="";for(let r=0;r<this.children.length;r++)t+=this.children[r].toMarkup();return t}toText(){const t=r=>r.toText();return this.children.map(t).join("")}}const Ve=function(e){return e.filter(t=>t).join(" ")},Vr=function(e,t){this.classes=e||[],this.attributes={},this.style=t||{}},Wr=function(e){const t=document.createElement(e);t.className=Ve(this.classes);for(const r in this.style)Object.prototype.hasOwnProperty.call(this.style,r)&&(t.style[r]=this.style[r]);for(const r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&t.setAttribute(r,this.attributes[r]);for(let r=0;r<this.children.length;r++)t.appendChild(this.children[r].toNode());return t},Hr=function(e){let t=`<${e}`;this.classes.length&&(t+=` class="${L.escape(Ve(this.classes))}"`);let r="";for(const n in this.style)Object.prototype.hasOwnProperty.call(this.style,n)&&(r+=`${L.hyphenate(n)}:${this.style[n]};`);r&&(t+=` style="${r}"`);for(const n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(t+=` ${n}="${L.escape(this.attributes[n])}"`);t+=">";for(let n=0;n<this.children.length;n++)t+=this.children[n].toMarkup();return t+=`</${e}>`,t};class ir{constructor(t,r,n){Vr.call(this,t,n),this.children=r||[]}setAttribute(t,r){this.attributes[t]=r}toNode(){return Wr.call(this,"span")}toMarkup(){return Hr.call(this,"span")}}class Zr{constructor(t){this.text=t}toNode(){return document.createTextNode(this.text)}toMarkup(){return L.escape(this.text)}}class Xr{constructor(t,r,n){this.alt=r,this.src=t,this.classes=["mord"],this.style=n}hasClass(t){return this.classes.includes(t)}toNode(){const t=document.createElement("img");t.src=this.src,t.alt=this.alt,t.className="mord";for(const r in this.style)Object.prototype.hasOwnProperty.call(this.style,r)&&(t.style[r]=this.style[r]);return t}toMarkup(){let t=`<img src='${this.src}' alt='${this.alt}'`,r="";for(const n in this.style)Object.prototype.hasOwnProperty.call(this.style,n)&&(r+=`${L.hyphenate(n)}:${this.style[n]};`);return r&&(t+=` style="${L.escape(r)}"`),t+=">",t}}function Yr(e){return new lt(e)}class Y{constructor(t,r,n,o){this.type=t,this.attributes={},this.children=r||[],this.classes=n||[],this.style=o||{}}setAttribute(t,r){this.attributes[t]=r}getAttribute(t){return this.attributes[t]}toNode(){const t=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(const r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&t.setAttribute(r,this.attributes[r]);this.classes.length>0&&(t.className=Ve(this.classes));for(const r in this.style)Object.prototype.hasOwnProperty.call(this.style,r)&&(t.style[r]=this.style[r]);for(let r=0;r<this.children.length;r++)t.appendChild(this.children[r].toNode());return t}toMarkup(){let t="<"+this.type;for(const n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(t+=" "+n+'="',t+=L.escape(this.attributes[n]),t+='"');this.classes.length>0&&(t+=` class="${L.escape(Ve(this.classes))}"`);let r="";for(const n in this.style)Object.prototype.hasOwnProperty.call(this.style,n)&&(r+=`${L.hyphenate(n)}:${this.style[n]};`);r&&(t+=` style="${r}"`),t+=">";for(let n=0;n<this.children.length;n++)t+=this.children[n].toMarkup();return t+="</"+this.type+">",t}toText(){return this.children.map(t=>t.toText()).join("")}}class ar{constructor(t){this.text=t}toNode(){return document.createTextNode(this.text)}toMarkup(){return L.escape(this.toText())}toText(){return this.text}}const ut=e=>{let t;return e.length===1&&e[0].type==="mrow"?(t=e.pop(),t.type="mstyle"):t=new Y("mstyle",e),t};var p={MathNode:Y,TextNode:ar,newDocumentFragment:Yr};const qe=e=>{let t=0;if(e.body)for(const r of e.body)t+=qe(r);else if(e.type==="supsub")t+=qe(e.base),e.sub&&(t+=.7*qe(e.sub)),e.sup&&(t+=.7*qe(e.sup));else if(e.type==="mathord"||e.type==="textord")for(const r of e.text.split("")){const n=r.codePointAt(0);96<n&&n<123||944<n&&n<970?t+=.56:47<n&&n<58?t+=.5:t+=.92}else t+=1;return t},Kr={widehat:"^",widecheck:"ˇ",widetilde:"~",wideparen:"⏜",utilde:"~",overleftarrow:"←",underleftarrow:"←",xleftarrow:"←",overrightarrow:"→",underrightarrow:"→",xrightarrow:"→",underbrace:"⏟",overbrace:"⏞",overgroup:"⏠",overparen:"⏜",undergroup:"⏡",underparen:"⏝",overleftrightarrow:"↔",underleftrightarrow:"↔",xleftrightarrow:"↔",Overrightarrow:"⇒",xRightarrow:"⇒",overleftharpoon:"↼",xleftharpoonup:"↼",overrightharpoon:"⇀",xrightharpoonup:"⇀",xLeftarrow:"⇐",xLeftrightarrow:"⇔",xhookleftarrow:"↩",xhookrightarrow:"↪",xmapsto:"↦",xrightharpoondown:"⇁",xleftharpoondown:"↽",xtwoheadleftarrow:"↞",xtwoheadrightarrow:"↠",xlongequal:"=",xrightleftarrows:"⇄",yields:"→",yieldsLeft:"←",mesomerism:"↔",longrightharpoonup:"⇀",longleftharpoondown:"↽",eqrightharpoonup:"⇀",eqleftharpoondown:"↽","\\cdrightarrow":"→","\\cdleftarrow":"←","\\cdlongequal":"="},lr=function(e){const t=new p.TextNode(Kr[e.slice(1)]),r=new p.MathNode("mo",[t]);return r.setAttribute("stretchy","true"),r},Jr=["\\widetilde","\\widehat","\\widecheck","\\utilde"],Qr=e=>{const t=lr(e.label);if(Jr.includes(e.label)){const r=qe(e.base);1<r&&r<1.6?t.classes.push("tml-crooked-2"):1.6<=r&&r<2.5?t.classes.push("tml-crooked-3"):2.5<=r&&t.classes.push("tml-crooked-4")}return t};var Ze={mathMLnode:lr,accentNode:Qr};const en={bin:1,close:1,inner:1,open:1,punct:1,rel:1},tn={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},j={math:{},text:{}};function s(e,t,r,n,o){j[e][n]={group:t,replace:r},o&&r&&(j[e][r]=j[e][n])}const i="math",f="text",M="accent-token",T="bin",R="close",we="inner",S="mathord",N="op-token",U="open",Me="punct",d="rel",ce="spacing",m="textord";s(i,d,"≡","\\equiv",!0);s(i,d,"≺","\\prec",!0);s(i,d,"≻","\\succ",!0);s(i,d,"∼","\\sim",!0);s(i,d,"⟂","\\perp",!0);s(i,d,"⪯","\\preceq",!0);s(i,d,"⪰","\\succeq",!0);s(i,d,"≃","\\simeq",!0);s(i,d,"≌","\\backcong",!0);s(i,d,"|","\\mid",!0);s(i,d,"≪","\\ll",!0);s(i,d,"≫","\\gg",!0);s(i,d,"≍","\\asymp",!0);s(i,d,"∥","\\parallel");s(i,d,"⌣","\\smile",!0);s(i,d,"⊑","\\sqsubseteq",!0);s(i,d,"⊒","\\sqsupseteq",!0);s(i,d,"≐","\\doteq",!0);s(i,d,"⌢","\\frown",!0);s(i,d,"∋","\\ni",!0);s(i,d,"∌","\\notni",!0);s(i,d,"∝","\\propto",!0);s(i,d,"⊢","\\vdash",!0);s(i,d,"⊣","\\dashv",!0);s(i,d,"∋","\\owns");s(i,d,"≘","\\arceq",!0);s(i,d,"≙","\\wedgeq",!0);s(i,d,"≚","\\veeeq",!0);s(i,d,"≛","\\stareq",!0);s(i,d,"≝","\\eqdef",!0);s(i,d,"≞","\\measeq",!0);s(i,d,"≟","\\questeq",!0);s(i,d,"≠","\\ne",!0);s(i,d,"≠","\\neq");s(i,d,"⩵","\\eqeq",!0);s(i,d,"⩶","\\eqeqeq",!0);s(i,d,"∷","\\dblcolon",!0);s(i,d,"≔","\\coloneqq",!0);s(i,d,"≕","\\eqqcolon",!0);s(i,d,"∹","\\eqcolon",!0);s(i,d,"⩴","\\Coloneqq",!0);s(i,Me,".","\\ldotp");s(i,Me,"·","\\cdotp");s(i,m,"#","\\#");s(f,m,"#","\\#");s(i,m,"&","\\&");s(f,m,"&","\\&");s(i,m,"ℵ","\\aleph",!0);s(i,m,"∀","\\forall",!0);s(i,m,"ℏ","\\hbar",!0);s(i,m,"∃","\\exists",!0);s(i,T,"∇","\\nabla",!0);s(i,m,"♭","\\flat",!0);s(i,m,"ℓ","\\ell",!0);s(i,m,"♮","\\natural",!0);s(i,m,"Å","\\Angstrom",!0);s(f,m,"Å","\\Angstrom",!0);s(i,m,"♣","\\clubsuit",!0);s(i,m,"♧","\\varclubsuit",!0);s(i,m,"℘","\\wp",!0);s(i,m,"♯","\\sharp",!0);s(i,m,"♢","\\diamondsuit",!0);s(i,m,"♦","\\vardiamondsuit",!0);s(i,m,"ℜ","\\Re",!0);s(i,m,"♡","\\heartsuit",!0);s(i,m,"♥","\\varheartsuit",!0);s(i,m,"ℑ","\\Im",!0);s(i,m,"♠","\\spadesuit",!0);s(i,m,"♤","\\varspadesuit",!0);s(i,m,"♀","\\female",!0);s(i,m,"♂","\\male",!0);s(i,m,"§","\\S",!0);s(f,m,"§","\\S");s(i,m,"¶","\\P",!0);s(f,m,"¶","\\P");s(f,m,"☺","\\smiley",!0);s(i,m,"☺","\\smiley",!0);s(i,m,"†","\\dag");s(f,m,"†","\\dag");s(f,m,"†","\\textdagger");s(i,m,"‡","\\ddag");s(f,m,"‡","\\ddag");s(f,m,"‡","\\textdaggerdbl");s(i,R,"⎱","\\rmoustache",!0);s(i,U,"⎰","\\lmoustache",!0);s(i,R,"⟯","\\rgroup",!0);s(i,U,"⟮","\\lgroup",!0);s(i,T,"∓","\\mp",!0);s(i,T,"⊖","\\ominus",!0);s(i,T,"⊎","\\uplus",!0);s(i,T,"⊓","\\sqcap",!0);s(i,T,"∗","\\ast");s(i,T,"⊔","\\sqcup",!0);s(i,T,"◯","\\bigcirc",!0);s(i,T,"∙","\\bullet",!0);s(i,T,"‡","\\ddagger");s(i,T,"≀","\\wr",!0);s(i,T,"⨿","\\amalg");s(i,T,"&","\\And");s(i,T,"⫽","\\sslash",!0);s(i,d,"⟵","\\longleftarrow",!0);s(i,d,"⇐","\\Leftarrow",!0);s(i,d,"⟸","\\Longleftarrow",!0);s(i,d,"⟶","\\longrightarrow",!0);s(i,d,"⇒","\\Rightarrow",!0);s(i,d,"⟹","\\Longrightarrow",!0);s(i,d,"↔","\\leftrightarrow",!0);s(i,d,"⟷","\\longleftrightarrow",!0);s(i,d,"⇔","\\Leftrightarrow",!0);s(i,d,"⟺","\\Longleftrightarrow",!0);s(i,d,"↤","\\mapsfrom",!0);s(i,d,"↦","\\mapsto",!0);s(i,d,"⟼","\\longmapsto",!0);s(i,d,"↗","\\nearrow",!0);s(i,d,"↩","\\hookleftarrow",!0);s(i,d,"↪","\\hookrightarrow",!0);s(i,d,"↘","\\searrow",!0);s(i,d,"↼","\\leftharpoonup",!0);s(i,d,"⇀","\\rightharpoonup",!0);s(i,d,"↙","\\swarrow",!0);s(i,d,"↽","\\leftharpoondown",!0);s(i,d,"⇁","\\rightharpoondown",!0);s(i,d,"↖","\\nwarrow",!0);s(i,d,"⇌","\\rightleftharpoons",!0);s(i,S,"↯","\\lightning",!0);s(i,S,"∎","\\QED",!0);s(i,S,"‰","\\permil",!0);s(f,m,"‰","\\permil");s(i,S,"☉","\\astrosun",!0);s(i,S,"☼","\\sun",!0);s(i,S,"☾","\\leftmoon",!0);s(i,S,"☽","\\rightmoon",!0);s(i,d,"≮","\\nless",!0);s(i,d,"⪇","\\lneq",!0);s(i,d,"≨","\\lneqq",!0);s(i,d,"≨︀","\\lvertneqq");s(i,d,"⋦","\\lnsim",!0);s(i,d,"⪉","\\lnapprox",!0);s(i,d,"⊀","\\nprec",!0);s(i,d,"⋠","\\npreceq",!0);s(i,d,"⋨","\\precnsim",!0);s(i,d,"⪹","\\precnapprox",!0);s(i,d,"≁","\\nsim",!0);s(i,d,"∤","\\nmid",!0);s(i,d,"∤","\\nshortmid");s(i,d,"⊬","\\nvdash",!0);s(i,d,"⊭","\\nvDash",!0);s(i,d,"⋪","\\ntriangleleft");s(i,d,"⋬","\\ntrianglelefteq",!0);s(i,d,"⊄","\\nsubset",!0);s(i,d,"⊅","\\nsupset",!0);s(i,d,"⊊","\\subsetneq",!0);s(i,d,"⊊︀","\\varsubsetneq");s(i,d,"⫋","\\subsetneqq",!0);s(i,d,"⫋︀","\\varsubsetneqq");s(i,d,"≯","\\ngtr",!0);s(i,d,"⪈","\\gneq",!0);s(i,d,"≩","\\gneqq",!0);s(i,d,"≩︀","\\gvertneqq");s(i,d,"⋧","\\gnsim",!0);s(i,d,"⪊","\\gnapprox",!0);s(i,d,"⊁","\\nsucc",!0);s(i,d,"⋡","\\nsucceq",!0);s(i,d,"⋩","\\succnsim",!0);s(i,d,"⪺","\\succnapprox",!0);s(i,d,"≆","\\ncong",!0);s(i,d,"∦","\\nparallel",!0);s(i,d,"∦","\\nshortparallel");s(i,d,"⊯","\\nVDash",!0);s(i,d,"⋫","\\ntriangleright");s(i,d,"⋭","\\ntrianglerighteq",!0);s(i,d,"⊋","\\supsetneq",!0);s(i,d,"⊋","\\varsupsetneq");s(i,d,"⫌","\\supsetneqq",!0);s(i,d,"⫌︀","\\varsupsetneqq");s(i,d,"⊮","\\nVdash",!0);s(i,d,"⪵","\\precneqq",!0);s(i,d,"⪶","\\succneqq",!0);s(i,T,"⊴","\\unlhd");s(i,T,"⊵","\\unrhd");s(i,d,"↚","\\nleftarrow",!0);s(i,d,"↛","\\nrightarrow",!0);s(i,d,"⇍","\\nLeftarrow",!0);s(i,d,"⇏","\\nRightarrow",!0);s(i,d,"↮","\\nleftrightarrow",!0);s(i,d,"⇎","\\nLeftrightarrow",!0);s(i,d,"△","\\vartriangle");s(i,m,"ℏ","\\hslash");s(i,m,"▽","\\triangledown");s(i,m,"◊","\\lozenge");s(i,m,"Ⓢ","\\circledS");s(i,m,"®","\\circledR",!0);s(f,m,"®","\\circledR");s(f,m,"®","\\textregistered");s(i,m,"∡","\\measuredangle",!0);s(i,m,"∄","\\nexists");s(i,m,"℧","\\mho");s(i,m,"Ⅎ","\\Finv",!0);s(i,m,"⅁","\\Game",!0);s(i,m,"‵","\\backprime");s(i,m,"‶","\\backdprime");s(i,m,"‷","\\backtrprime");s(i,m,"▲","\\blacktriangle");s(i,m,"▼","\\blacktriangledown");s(i,m,"■","\\blacksquare");s(i,m,"⧫","\\blacklozenge");s(i,m,"★","\\bigstar");s(i,m,"∢","\\sphericalangle",!0);s(i,m,"∁","\\complement",!0);s(i,m,"ð","\\eth",!0);s(f,m,"ð","ð");s(i,m,"╱","\\diagup");s(i,m,"╲","\\diagdown");s(i,m,"□","\\square");s(i,m,"□","\\Box");s(i,m,"◊","\\Diamond");s(i,m,"¥","\\yen",!0);s(f,m,"¥","\\yen",!0);s(i,m,"✓","\\checkmark",!0);s(f,m,"✓","\\checkmark");s(i,m,"✗","\\ballotx",!0);s(f,m,"✗","\\ballotx");s(f,m,"•","\\textbullet");s(i,m,"ℶ","\\beth",!0);s(i,m,"ℸ","\\daleth",!0);s(i,m,"ℷ","\\gimel",!0);s(i,m,"ϝ","\\digamma",!0);s(i,m,"ϰ","\\varkappa");s(i,U,"⌜","\\ulcorner",!0);s(i,R,"⌝","\\urcorner",!0);s(i,U,"⌞","\\llcorner",!0);s(i,R,"⌟","\\lrcorner",!0);s(i,d,"≦","\\leqq",!0);s(i,d,"⩽","\\leqslant",!0);s(i,d,"⪕","\\eqslantless",!0);s(i,d,"≲","\\lesssim",!0);s(i,d,"⪅","\\lessapprox",!0);s(i,d,"≊","\\approxeq",!0);s(i,T,"⋖","\\lessdot");s(i,d,"⋘","\\lll",!0);s(i,d,"≶","\\lessgtr",!0);s(i,d,"⋚","\\lesseqgtr",!0);s(i,d,"⪋","\\lesseqqgtr",!0);s(i,d,"≑","\\doteqdot");s(i,d,"≓","\\risingdotseq",!0);s(i,d,"≒","\\fallingdotseq",!0);s(i,d,"∽","\\backsim",!0);s(i,d,"⋍","\\backsimeq",!0);s(i,d,"⫅","\\subseteqq",!0);s(i,d,"⋐","\\Subset",!0);s(i,d,"⊏","\\sqsubset",!0);s(i,d,"≼","\\preccurlyeq",!0);s(i,d,"⋞","\\curlyeqprec",!0);s(i,d,"≾","\\precsim",!0);s(i,d,"⪷","\\precapprox",!0);s(i,d,"⊲","\\vartriangleleft");s(i,d,"⊴","\\trianglelefteq");s(i,d,"⊨","\\vDash",!0);s(i,d,"⊫","\\VDash",!0);s(i,d,"⊪","\\Vvdash",!0);s(i,d,"⌣","\\smallsmile");s(i,d,"⌢","\\smallfrown");s(i,d,"≏","\\bumpeq",!0);s(i,d,"≎","\\Bumpeq",!0);s(i,d,"≧","\\geqq",!0);s(i,d,"⩾","\\geqslant",!0);s(i,d,"⪖","\\eqslantgtr",!0);s(i,d,"≳","\\gtrsim",!0);s(i,d,"⪆","\\gtrapprox",!0);s(i,T,"⋗","\\gtrdot");s(i,d,"⋙","\\ggg",!0);s(i,d,"≷","\\gtrless",!0);s(i,d,"⋛","\\gtreqless",!0);s(i,d,"⪌","\\gtreqqless",!0);s(i,d,"≖","\\eqcirc",!0);s(i,d,"≗","\\circeq",!0);s(i,d,"≜","\\triangleq",!0);s(i,d,"∼","\\thicksim");s(i,d,"≈","\\thickapprox");s(i,d,"⫆","\\supseteqq",!0);s(i,d,"⋑","\\Supset",!0);s(i,d,"⊐","\\sqsupset",!0);s(i,d,"≽","\\succcurlyeq",!0);s(i,d,"⋟","\\curlyeqsucc",!0);s(i,d,"≿","\\succsim",!0);s(i,d,"⪸","\\succapprox",!0);s(i,d,"⊳","\\vartriangleright");s(i,d,"⊵","\\trianglerighteq");s(i,d,"⊩","\\Vdash",!0);s(i,d,"∣","\\shortmid");s(i,d,"∥","\\shortparallel");s(i,d,"≬","\\between",!0);s(i,d,"⋔","\\pitchfork",!0);s(i,d,"∝","\\varpropto");s(i,d,"◀","\\blacktriangleleft");s(i,d,"∴","\\therefore",!0);s(i,d,"∍","\\backepsilon");s(i,d,"▶","\\blacktriangleright");s(i,d,"∵","\\because",!0);s(i,d,"⋘","\\llless");s(i,d,"⋙","\\gggtr");s(i,T,"⊲","\\lhd");s(i,T,"⊳","\\rhd");s(i,d,"≂","\\eqsim",!0);s(i,d,"≑","\\Doteq",!0);s(i,d,"⥽","\\strictif",!0);s(i,d,"⥼","\\strictfi",!0);s(i,T,"∔","\\dotplus",!0);s(i,T,"∖","\\smallsetminus");s(i,T,"⋒","\\Cap",!0);s(i,T,"⋓","\\Cup",!0);s(i,T,"⩞","\\doublebarwedge",!0);s(i,T,"⊟","\\boxminus",!0);s(i,T,"⊞","\\boxplus",!0);s(i,T,"⋇","\\divideontimes",!0);s(i,T,"⋉","\\ltimes",!0);s(i,T,"⋊","\\rtimes",!0);s(i,T,"⋋","\\leftthreetimes",!0);s(i,T,"⋌","\\rightthreetimes",!0);s(i,T,"⋏","\\curlywedge",!0);s(i,T,"⋎","\\curlyvee",!0);s(i,T,"⊝","\\circleddash",!0);s(i,T,"⊛","\\circledast",!0);s(i,T,"⊺","\\intercal",!0);s(i,T,"⋒","\\doublecap");s(i,T,"⋓","\\doublecup");s(i,T,"⊠","\\boxtimes",!0);s(i,T,"⋈","\\bowtie",!0);s(i,T,"⋈","\\Join");s(i,T,"⟕","\\leftouterjoin",!0);s(i,T,"⟖","\\rightouterjoin",!0);s(i,T,"⟗","\\fullouterjoin",!0);s(i,d,"⇢","\\dashrightarrow",!0);s(i,d,"⇠","\\dashleftarrow",!0);s(i,d,"⇇","\\leftleftarrows",!0);s(i,d,"⇆","\\leftrightarrows",!0);s(i,d,"⇚","\\Lleftarrow",!0);s(i,d,"↞","\\twoheadleftarrow",!0);s(i,d,"↢","\\leftarrowtail",!0);s(i,d,"↫","\\looparrowleft",!0);s(i,d,"⇋","\\leftrightharpoons",!0);s(i,d,"↶","\\curvearrowleft",!0);s(i,d,"↺","\\circlearrowleft",!0);s(i,d,"↰","\\Lsh",!0);s(i,d,"⇈","\\upuparrows",!0);s(i,d,"↿","\\upharpoonleft",!0);s(i,d,"⇃","\\downharpoonleft",!0);s(i,d,"⊶","\\origof",!0);s(i,d,"⊷","\\imageof",!0);s(i,d,"⊸","\\multimap",!0);s(i,d,"↭","\\leftrightsquigarrow",!0);s(i,d,"⇉","\\rightrightarrows",!0);s(i,d,"⇄","\\rightleftarrows",!0);s(i,d,"↠","\\twoheadrightarrow",!0);s(i,d,"↣","\\rightarrowtail",!0);s(i,d,"↬","\\looparrowright",!0);s(i,d,"↷","\\curvearrowright",!0);s(i,d,"↻","\\circlearrowright",!0);s(i,d,"↱","\\Rsh",!0);s(i,d,"⇊","\\downdownarrows",!0);s(i,d,"↾","\\upharpoonright",!0);s(i,d,"⇂","\\downharpoonright",!0);s(i,d,"⇝","\\rightsquigarrow",!0);s(i,d,"⇝","\\leadsto");s(i,d,"⇛","\\Rrightarrow",!0);s(i,d,"↾","\\restriction");s(i,m,"‘","`");s(i,m,"$","\\$");s(f,m,"$","\\$");s(f,m,"$","\\textdollar");s(i,m,"¢","\\cent");s(f,m,"¢","\\cent");s(i,m,"%","\\%");s(f,m,"%","\\%");s(i,m,"_","\\_");s(f,m,"_","\\_");s(f,m,"_","\\textunderscore");s(f,m,"␣","\\textvisiblespace",!0);s(i,m,"∠","\\angle",!0);s(i,m,"∞","\\infty",!0);s(i,m,"′","\\prime");s(i,m,"″","\\dprime");s(i,m,"‴","\\trprime");s(i,m,"⁗","\\qprime");s(i,m,"△","\\triangle");s(f,m,"Α","\\Alpha",!0);s(f,m,"Β","\\Beta",!0);s(f,m,"Γ","\\Gamma",!0);s(f,m,"Δ","\\Delta",!0);s(f,m,"Ε","\\Epsilon",!0);s(f,m,"Ζ","\\Zeta",!0);s(f,m,"Η","\\Eta",!0);s(f,m,"Θ","\\Theta",!0);s(f,m,"Ι","\\Iota",!0);s(f,m,"Κ","\\Kappa",!0);s(f,m,"Λ","\\Lambda",!0);s(f,m,"Μ","\\Mu",!0);s(f,m,"Ν","\\Nu",!0);s(f,m,"Ξ","\\Xi",!0);s(f,m,"Ο","\\Omicron",!0);s(f,m,"Π","\\Pi",!0);s(f,m,"Ρ","\\Rho",!0);s(f,m,"Σ","\\Sigma",!0);s(f,m,"Τ","\\Tau",!0);s(f,m,"Υ","\\Upsilon",!0);s(f,m,"Φ","\\Phi",!0);s(f,m,"Χ","\\Chi",!0);s(f,m,"Ψ","\\Psi",!0);s(f,m,"Ω","\\Omega",!0);s(i,S,"Α","\\Alpha",!0);s(i,S,"Β","\\Beta",!0);s(i,S,"Γ","\\Gamma",!0);s(i,S,"Δ","\\Delta",!0);s(i,S,"Ε","\\Epsilon",!0);s(i,S,"Ζ","\\Zeta",!0);s(i,S,"Η","\\Eta",!0);s(i,S,"Θ","\\Theta",!0);s(i,S,"Ι","\\Iota",!0);s(i,S,"Κ","\\Kappa",!0);s(i,S,"Λ","\\Lambda",!0);s(i,S,"Μ","\\Mu",!0);s(i,S,"Ν","\\Nu",!0);s(i,S,"Ξ","\\Xi",!0);s(i,S,"Ο","\\Omicron",!0);s(i,S,"Π","\\Pi",!0);s(i,S,"Ρ","\\Rho",!0);s(i,S,"Σ","\\Sigma",!0);s(i,S,"Τ","\\Tau",!0);s(i,S,"Υ","\\Upsilon",!0);s(i,S,"Φ","\\Phi",!0);s(i,S,"Χ","\\Chi",!0);s(i,S,"Ψ","\\Psi",!0);s(i,S,"Ω","\\Omega",!0);s(i,U,"¬","\\neg",!0);s(i,U,"¬","\\lnot");s(i,m,"⊤","\\top");s(i,m,"⊥","\\bot");s(i,m,"∅","\\emptyset");s(i,m,"⌀","\\varnothing");s(i,S,"α","\\alpha",!0);s(i,S,"β","\\beta",!0);s(i,S,"γ","\\gamma",!0);s(i,S,"δ","\\delta",!0);s(i,S,"ϵ","\\epsilon",!0);s(i,S,"ζ","\\zeta",!0);s(i,S,"η","\\eta",!0);s(i,S,"θ","\\theta",!0);s(i,S,"ι","\\iota",!0);s(i,S,"κ","\\kappa",!0);s(i,S,"λ","\\lambda",!0);s(i,S,"μ","\\mu",!0);s(i,S,"ν","\\nu",!0);s(i,S,"ξ","\\xi",!0);s(i,S,"ο","\\omicron",!0);s(i,S,"π","\\pi",!0);s(i,S,"ρ","\\rho",!0);s(i,S,"σ","\\sigma",!0);s(i,S,"τ","\\tau",!0);s(i,S,"υ","\\upsilon",!0);s(i,S,"ϕ","\\phi",!0);s(i,S,"χ","\\chi",!0);s(i,S,"ψ","\\psi",!0);s(i,S,"ω","\\omega",!0);s(i,S,"ε","\\varepsilon",!0);s(i,S,"ϑ","\\vartheta",!0);s(i,S,"ϖ","\\varpi",!0);s(i,S,"ϱ","\\varrho",!0);s(i,S,"ς","\\varsigma",!0);s(i,S,"φ","\\varphi",!0);s(i,S,"Ϙ","\\Coppa",!0);s(i,S,"ϙ","\\coppa",!0);s(i,S,"ϙ","\\varcoppa",!0);s(i,S,"Ϟ","\\Koppa",!0);s(i,S,"ϟ","\\koppa",!0);s(i,S,"Ϡ","\\Sampi",!0);s(i,S,"ϡ","\\sampi",!0);s(i,S,"Ϛ","\\Stigma",!0);s(i,S,"ϛ","\\stigma",!0);s(i,S,"⫫","\\Bot");s(i,T,"∗","∗",!0);s(i,T,"+","+");s(i,T,"*","*");s(i,T,"⁄","/",!0);s(i,T,"⁄","⁄");s(i,T,"−","-",!0);s(i,T,"⋅","\\cdot",!0);s(i,T,"∘","\\circ",!0);s(i,T,"÷","\\div",!0);s(i,T,"±","\\pm",!0);s(i,T,"×","\\times",!0);s(i,T,"∩","\\cap",!0);s(i,T,"∪","\\cup",!0);s(i,T,"∖","\\setminus",!0);s(i,T,"∧","\\land");s(i,T,"∨","\\lor");s(i,T,"∧","\\wedge",!0);s(i,T,"∨","\\vee",!0);s(i,U,"⟦","\\llbracket",!0);s(i,R,"⟧","\\rrbracket",!0);s(i,U,"⟨","\\langle",!0);s(i,U,"⟪","\\lAngle",!0);s(i,U,"⦉","\\llangle",!0);s(i,U,"|","\\lvert");s(i,U,"‖","\\lVert");s(i,m,"!","\\oc");s(i,m,"?","\\wn");s(i,m,"↓","\\shpos");s(i,m,"↕","\\shift");s(i,m,"↑","\\shneg");s(i,R,"?","?");s(i,R,"!","!");s(i,R,"‼","‼");s(i,R,"⟩","\\rangle",!0);s(i,R,"⟫","\\rAngle",!0);s(i,R,"⦊","\\rrangle",!0);s(i,R,"|","\\rvert");s(i,R,"‖","\\rVert");s(i,U,"⦃","\\lBrace",!0);s(i,R,"⦄","\\rBrace",!0);s(i,d,"=","\\equal",!0);s(i,d,":",":");s(i,d,"≈","\\approx",!0);s(i,d,"≅","\\cong",!0);s(i,d,"≥","\\ge");s(i,d,"≥","\\geq",!0);s(i,d,"←","\\gets");s(i,d,">","\\gt",!0);s(i,d,"∈","\\in",!0);s(i,d,"∉","\\notin",!0);s(i,d,"","\\@not");s(i,d,"⊂","\\subset",!0);s(i,d,"⊃","\\supset",!0);s(i,d,"⊆","\\subseteq",!0);s(i,d,"⊇","\\supseteq",!0);s(i,d,"⊈","\\nsubseteq",!0);s(i,d,"⊈","\\nsubseteqq");s(i,d,"⊉","\\nsupseteq",!0);s(i,d,"⊉","\\nsupseteqq");s(i,d,"⊨","\\models");s(i,d,"←","\\leftarrow",!0);s(i,d,"≤","\\le");s(i,d,"≤","\\leq",!0);s(i,d,"<","\\lt",!0);s(i,d,"→","\\rightarrow",!0);s(i,d,"→","\\to");s(i,d,"≱","\\ngeq",!0);s(i,d,"≱","\\ngeqq");s(i,d,"≱","\\ngeqslant");s(i,d,"≰","\\nleq",!0);s(i,d,"≰","\\nleqq");s(i,d,"≰","\\nleqslant");s(i,d,"⫫","\\Perp",!0);s(i,ce," ","\\ ");s(i,ce," ","\\space");s(i,ce," ","\\nobreakspace");s(f,ce," ","\\ ");s(f,ce," "," ");s(f,ce," ","\\space");s(f,ce," ","\\nobreakspace");s(i,ce,null,"\\nobreak");s(i,ce,null,"\\allowbreak");s(i,Me,",",",");s(f,Me,":",":");s(i,Me,";",";");s(i,T,"⊼","\\barwedge",!0);s(i,T,"⊻","\\veebar",!0);s(i,T,"⊙","\\odot",!0);s(i,T,"⊕︎","\\oplus");s(i,T,"⊗","\\otimes",!0);s(i,m,"∂","\\partial",!0);s(i,T,"⊘","\\oslash",!0);s(i,T,"⊚","\\circledcirc",!0);s(i,T,"⊡","\\boxdot",!0);s(i,T,"△","\\bigtriangleup");s(i,T,"▽","\\bigtriangledown");s(i,T,"†","\\dagger");s(i,T,"⋄","\\diamond");s(i,T,"⋆","\\star");s(i,T,"◃","\\triangleleft");s(i,T,"▹","\\triangleright");s(i,U,"{","\\{");s(f,m,"{","\\{");s(f,m,"{","\\textbraceleft");s(i,R,"}","\\}");s(f,m,"}","\\}");s(f,m,"}","\\textbraceright");s(i,U,"{","\\lbrace");s(i,R,"}","\\rbrace");s(i,U,"[","\\lbrack",!0);s(f,m,"[","\\lbrack",!0);s(i,R,"]","\\rbrack",!0);s(f,m,"]","\\rbrack",!0);s(i,U,"(","\\lparen",!0);s(i,R,")","\\rparen",!0);s(i,U,"⦇","\\llparenthesis",!0);s(i,R,"⦈","\\rrparenthesis",!0);s(f,m,"<","\\textless",!0);s(f,m,">","\\textgreater",!0);s(i,U,"⌊","\\lfloor",!0);s(i,R,"⌋","\\rfloor",!0);s(i,U,"⌈","\\lceil",!0);s(i,R,"⌉","\\rceil",!0);s(i,m,"\\","\\backslash");s(i,m,"|","|");s(i,m,"|","\\vert");s(f,m,"|","\\textbar",!0);s(i,m,"‖","\\|");s(i,m,"‖","\\Vert");s(f,m,"‖","\\textbardbl");s(f,m,"~","\\textasciitilde");s(f,m,"\\","\\textbackslash");s(f,m,"^","\\textasciicircum");s(i,d,"↑","\\uparrow",!0);s(i,d,"⇑","\\Uparrow",!0);s(i,d,"↓","\\downarrow",!0);s(i,d,"⇓","\\Downarrow",!0);s(i,d,"↕","\\updownarrow",!0);s(i,d,"⇕","\\Updownarrow",!0);s(i,N,"∐","\\coprod");s(i,N,"⋁","\\bigvee");s(i,N,"⋀","\\bigwedge");s(i,N,"⨄","\\biguplus");s(i,N,"⋂","\\bigcap");s(i,N,"⋃","\\bigcup");s(i,N,"∫","\\int");s(i,N,"∫","\\intop");s(i,N,"∬","\\iint");s(i,N,"∭","\\iiint");s(i,N,"∏","\\prod");s(i,N,"∑","\\sum");s(i,N,"⨂","\\bigotimes");s(i,N,"⨁","\\bigoplus");s(i,N,"⨀","\\bigodot");s(i,N,"⨉","\\bigtimes");s(i,N,"∮","\\oint");s(i,N,"∯","\\oiint");s(i,N,"∰","\\oiiint");s(i,N,"∱","\\intclockwise");s(i,N,"∲","\\varointclockwise");s(i,N,"⨌","\\iiiint");s(i,N,"⨍","\\intbar");s(i,N,"⨎","\\intBar");s(i,N,"⨏","\\fint");s(i,N,"⨒","\\rppolint");s(i,N,"⨓","\\scpolint");s(i,N,"⨕","\\pointint");s(i,N,"⨖","\\sqint");s(i,N,"⨗","\\intlarhk");s(i,N,"⨘","\\intx");s(i,N,"⨙","\\intcap");s(i,N,"⨚","\\intcup");s(i,N,"⨅","\\bigsqcap");s(i,N,"⨆","\\bigsqcup");s(i,N,"∫","\\smallint");s(f,we,"…","\\textellipsis");s(i,we,"…","\\mathellipsis");s(f,we,"…","\\ldots",!0);s(i,we,"…","\\ldots",!0);s(i,we,"⋰","\\iddots",!0);s(i,we,"⋯","\\@cdots",!0);s(i,we,"⋱","\\ddots",!0);s(i,m,"⋮","\\varvdots");s(i,M,"ˊ","\\acute");s(i,M,"`","\\grave");s(i,M,"¨","\\ddot");s(i,M,"…","\\dddot");s(i,M,"….","\\ddddot");s(i,M,"~","\\tilde");s(i,M,"‾","\\bar");s(i,M,"˘","\\breve");s(i,M,"ˇ","\\check");s(i,M,"^","\\hat");s(i,M,"→","\\vec");s(i,M,"˙","\\dot");s(i,M,"˚","\\mathring");s(i,S,"ı","\\imath",!0);s(i,S,"ȷ","\\jmath",!0);s(i,m,"ı","ı");s(i,m,"ȷ","ȷ");s(f,m,"ı","\\i",!0);s(f,m,"ȷ","\\j",!0);s(f,m,"ß","\\ss",!0);s(f,m,"æ","\\ae",!0);s(f,m,"œ","\\oe",!0);s(f,m,"ø","\\o",!0);s(i,S,"ø","\\o",!0);s(f,m,"Æ","\\AE",!0);s(f,m,"Œ","\\OE",!0);s(f,m,"Ø","\\O",!0);s(i,S,"Ø","\\O",!0);s(f,M,"ˊ","\\'");s(f,M,"ˋ","\\`");s(f,M,"ˆ","\\^");s(f,M,"˜","\\~");s(f,M,"ˉ","\\=");s(f,M,"˘","\\u");s(f,M,"˙","\\.");s(f,M,"¸","\\c");s(f,M,"˚","\\r");s(f,M,"ˇ","\\v");s(f,M,"¨",'\\"');s(f,M,"˝","\\H");s(i,M,"ˊ","\\'");s(i,M,"ˋ","\\`");s(i,M,"ˆ","\\^");s(i,M,"˜","\\~");s(i,M,"ˉ","\\=");s(i,M,"˘","\\u");s(i,M,"˙","\\.");s(i,M,"¸","\\c");s(i,M,"˚","\\r");s(i,M,"ˇ","\\v");s(i,M,"¨",'\\"');s(i,M,"˝","\\H");const rn={"--":!0,"---":!0,"``":!0,"''":!0};s(f,m,"–","--",!0);s(f,m,"–","\\textendash");s(f,m,"—","---",!0);s(f,m,"—","\\textemdash");s(f,m,"‘","`",!0);s(f,m,"‘","\\textquoteleft");s(f,m,"’","'",!0);s(f,m,"’","\\textquoteright");s(f,m,"“","``",!0);s(f,m,"“","\\textquotedblleft");s(f,m,"”","''",!0);s(f,m,"”","\\textquotedblright");s(i,m,"°","\\degree",!0);s(f,m,"°","\\degree");s(f,m,"°","\\textdegree",!0);s(i,m,"£","\\pounds");s(i,m,"£","\\mathsterling",!0);s(f,m,"£","\\pounds");s(f,m,"£","\\textsterling",!0);s(i,m,"✠","\\maltese");s(f,m,"✠","\\maltese");s(i,m,"€","\\euro",!0);s(f,m,"€","\\euro",!0);s(f,m,"€","\\texteuro");s(i,m,"©","\\copyright",!0);s(f,m,"©","\\textcopyright");s(i,m,"⌀","\\diameter",!0);s(f,m,"⌀","\\diameter");s(i,m,"𝛤","\\varGamma");s(i,m,"𝛥","\\varDelta");s(i,m,"𝛩","\\varTheta");s(i,m,"𝛬","\\varLambda");s(i,m,"𝛯","\\varXi");s(i,m,"𝛱","\\varPi");s(i,m,"𝛴","\\varSigma");s(i,m,"𝛶","\\varUpsilon");s(i,m,"𝛷","\\varPhi");s(i,m,"𝛹","\\varPsi");s(i,m,"𝛺","\\varOmega");s(f,m,"𝛤","\\varGamma");s(f,m,"𝛥","\\varDelta");s(f,m,"𝛩","\\varTheta");s(f,m,"𝛬","\\varLambda");s(f,m,"𝛯","\\varXi");s(f,m,"𝛱","\\varPi");s(f,m,"𝛴","\\varSigma");s(f,m,"𝛶","\\varUpsilon");s(f,m,"𝛷","\\varPhi");s(f,m,"𝛹","\\varPsi");s(f,m,"𝛺","\\varOmega");const _t='0123456789/@."';for(let e=0;e<_t.length;e++){const t=_t.charAt(e);s(i,m,t,t)}const qt='0123456789!@*()-=+";:?/.,';for(let e=0;e<qt.length;e++){const t=qt.charAt(e);s(f,m,t,t)}const We="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(let e=0;e<We.length;e++){const t=We.charAt(e);s(i,S,t,t),s(f,m,t,t)}const Tt="ÇÐÞçþℂℍℕℙℚℝℤℎℏℊℋℌℐℑℒℓ℘ℛℜℬℰℱℳℭℨ";for(let e=0;e<Tt.length;e++){const t=Tt.charAt(e);s(i,S,t,t),s(f,m,t,t)}let $="";for(let e=0;e<We.length;e++){$=String.fromCharCode(55349,56320+e),s(i,S,$,$),s(f,m,$,$),$=String.fromCharCode(55349,56372+e),s(i,S,$,$),s(f,m,$,$),$=String.fromCharCode(55349,56424+e),s(i,S,$,$),s(f,m,$,$),$=String.fromCharCode(55349,56580+e),s(i,S,$,$),s(f,m,$,$),$=String.fromCharCode(55349,56736+e),s(i,S,$,$),s(f,m,$,$),$=String.fromCharCode(55349,56788+e),s(i,S,$,$),s(f,m,$,$),$=String.fromCharCode(55349,56840+e),s(i,S,$,$),s(f,m,$,$),$=String.fromCharCode(55349,56944+e),s(i,S,$,$),s(f,m,$,$),$=String.fromCharCode(55349,56632+e),s(i,S,$,$),s(f,m,$,$);const t=We.charAt(e);$=String.fromCharCode(55349,56476+e),s(i,S,t,$),s(f,m,t,$)}for(let e=0;e<10;e++)$=String.fromCharCode(55349,57294+e),s(i,S,$,$),s(f,m,$,$),$=String.fromCharCode(55349,57314+e),s(i,S,$,$),s(f,m,$,$),$=String.fromCharCode(55349,57324+e),s(i,S,$,$),s(f,m,$,$),$=String.fromCharCode(55349,57334+e),s(i,S,$,$),s(f,m,$,$);const nn="([{⌊⌈⟨⟮⎰⟦⦃",on=")]}⌋⌉⟩⟯⎱⟦⦄";function sn(e,t,r){const n=[];let o=[],a=[],l=0,u=0,h=0;for(;u<e.length;){for(;e[u]instanceof lt;)e.splice(u,1,...e[u].children);const g=e[u];if(g.attributes&&g.attributes.linebreak&&g.attributes.linebreak==="newline"){a.length>0&&o.push(new p.MathNode("mrow",a)),o.push(g),a=[];const y=new p.MathNode("mtd",o);y.style.textAlign="left",n.push(new p.MathNode("mtr",[y])),o=[],u+=1;continue}if(a.push(g),g.type&&g.type==="mo"&&g.children.length===1&&!Object.hasOwn(g.attributes,"movablelimits")){const y=g.children[0].text;if(nn.indexOf(y)>-1)h+=1;else if(on.indexOf(y)>-1)h-=1;else if(h===0&&t==="="&&y==="="){if(l+=1,l>1){a.pop();const _=new p.MathNode("mrow",a);o.push(_),a=[g]}}else if(h===0&&t==="tex"&&y!=="∇"){const _=u<e.length-1?e[u+1]:null;let b=!0;if(!(_&&_.type==="mtext"&&_.attributes.linebreak&&_.attributes.linebreak==="nobreak"))for(let A=u+1;A<e.length;A++){const C=e[A];if(C.type&&C.type==="mspace"&&!(C.attributes.linebreak&&C.attributes.linebreak==="newline"))a.push(C),u+=1,C.attributes&&C.attributes.linebreak&&C.attributes.linebreak==="nobreak"&&(b=!1);else break}if(b){const A=new p.MathNode("mrow",a);o.push(A),a=[]}}}u+=1}if(a.length>0){const g=new p.MathNode("mrow",a);o.push(g)}if(n.length>0){const g=new p.MathNode("mtd",o);g.style.textAlign="left";const y=new p.MathNode("mtr",[g]);n.push(y);const _=new p.MathNode("mtable",n);return r||(_.setAttribute("columnalign","left"),_.setAttribute("rowspacing","0em")),_}return p.newDocumentFragment(o)}const Q=function(e,t,r){return j[t][e]&&j[t][e].replace&&e.charCodeAt(0)!==55349&&!(Object.prototype.hasOwnProperty.call(rn,e)&&r&&(r.fontFamily&&r.fontFamily.slice(4,6)==="tt"||r.font&&r.font.slice(4,6)==="tt"))&&(e=j[t][e].replace),new p.TextNode(e)},ct=e=>{if(e.type!=="mrow"&&e.type!=="mstyle"||e.children.length===0||!e.children[0].attributes||e.children[0].type!=="mtext")return e;const t=e.children[0].attributes.mathvariant||"",r=new p.MathNode("mtext",[new p.TextNode(e.children[0].children[0].text)]);for(let o=1;o<e.children.length;o++){const a=e.children[o].attributes.mathvariant||"";if(e.children[o].type==="mrow"){const l=e.children[o];for(let u=0;u<l.children.length;u++){if((l.children[u].attributes.mathvariant||"")!==t||l.children[u].type!=="mtext")return e;r.children[0].text+=l.children[u].children[0].text}}else{if(a!==t||e.children[o].type!=="mtext")return e;r.children[0].text+=e.children[o].children[0].text}}r.children[0].text.charAt(0)===" "&&(r.children[0].text=" "+r.children[0].text.slice(1));const n=r.children[0].text.length;n>0&&r.children[0].text.charAt(n-1)===" "&&(r.children[0].text=r.children[0].text.slice(0,-1)+" ");for(const[o,a]of Object.entries(e.attributes))r.attributes[o]=a;return r},$t=/^[0-9]$/,an=e=>e.type==="atom"&&e.text===","||e.type==="textord"&&e.text===".",ln=e=>{if(e.length<2)return;const t=[];let r=!1;for(let n=0;n<e.length;n++){const o=e[n];o.type==="textord"&&$t.test(o.text)?(r||t.push({start:n}),r=!0):(r&&(t[t.length-1].end=n-1),r=!1)}r&&(t[t.length-1].end=e.length-1);for(let n=t.length-1;n>0;n--)t[n-1].end===t[n].start-2&&an(e[t[n].start-1])&&(t[n-1].end=t[n].end,t.splice(n,1));for(let n=t.length-1;n>=0;n--){for(let o=t[n].start+1;o<=t[n].end;o++)e[t[n].start].text+=e[o].text;if(e.splice(t[n].start+1,t[n].end-t[n].start),e.length>t[n].start+1){const o=e[t[n].start+1];o.type==="supsub"&&o.base&&o.base.type==="textord"&&$t.test(o.base.text)&&(o.base.text=e[t[n].start].text+o.base.text,e.splice(t[n].start,1))}}},dt=function(e,t=!1){if(e.length===1&&!(e[0]instanceof lt))return e[0];if(!t){e[0]instanceof Y&&e[0].type==="mo"&&!e[0].attributes.fence&&(e[0].attributes.lspace="0em",e[0].attributes.rspace="0em");const r=e.length-1;e[r]instanceof Y&&e[r].type==="mo"&&!e[r].attributes.fence&&(e[r].attributes.lspace="0em",e[r].attributes.rspace="0em")}return new p.MathNode("mrow",e)},ze=e=>e.type==="atom"&&e.family==="rel"||e.type==="mclass"&&e.mclass==="mrel",K=function(e,t,r=!1){if(!r&&e.length===1){const o=E(e[0],t);return o instanceof Y&&o.type==="mo"&&(o.setAttribute("lspace","0em"),o.setAttribute("rspace","0em")),[o]}ln(e);const n=[];for(let o=0;o<e.length;o++){const a=E(e[o],t);o<e.length-1&&ze(e[o])&&ze(e[o+1])&&a.setAttribute("rspace","0em"),o>0&&ze(e[o])&&ze(e[o-1])&&a.setAttribute("lspace","0em"),n.push(a)}return n},de=function(e,t,r=!1){return dt(K(e,t,r),r)},E=function(e,t){if(!e)return new p.MathNode("mrow");if(Ue[e.type])return Ue[e.type](e,t);throw new w("Got group of unknown type: '"+e.type+"'")},Dt=e=>new p.MathNode("mtd",[],[],{padding:"0",width:"50%"}),un=(e,t,r,n)=>{t=de(t[0].body,r),t=ct(t),t.classes.push("tml-tag"),e=new p.MathNode("mtd",[e]);const o=[Dt(),e,Dt()];o[n?0:2].classes.push(n?"tml-left":"tml-right"),o[n?0:2].children.push(t);const a=new p.MathNode("mtr",o,["tml-tageqn"]),l=new p.MathNode("mtable",[a]);return l.style.width="100%",l.setAttribute("displaystyle","true"),l};function cn(e,t,r,n){let o=null;e.length===1&&e[0].type==="tag"&&(o=e[0].tag,e=e[0].body);const a=K(e,r),l=n.displayMode||n.annotate?"none":n.wrap,u=a.length===0?null:a[0];let h=a.length===1&&o===null&&u instanceof Y?a[0]:sn(a,l,n.displayMode);if(o&&(h=un(h,o,r,n.leqno)),n.annotate){const y=new p.MathNode("annotation",[new p.TextNode(t)]);y.setAttribute("encoding","application/x-tex"),h=new p.MathNode("semantics",[h,y])}const g=new p.MathNode("math",[h]);return n.xml&&g.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),n.displayMode&&(g.setAttribute("display","block"),g.style.display="block math",g.classes=["tml-display"]),g}const dn="acegıȷmnopqrsuvwxyzαγεηικμνοπρςστυχωϕ𝐚𝐜𝐞𝐠𝐦𝐧𝐨𝐩𝐪𝐫𝐬𝐮𝐯𝐰𝐱𝐲𝐳",mn="ABCDEFGHIJKLMNOPQRSTUVWXYZbdfhkltΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩβδλζφθψ𝐀𝐁𝐂𝐃𝐄𝐅𝐆𝐇𝐈𝐉𝐊𝐋𝐌𝐍𝐎𝐏𝐐𝐑𝐒𝐓𝐔𝐕𝐖𝐗𝐘𝐙𝐛𝐝𝐟𝐡𝐤𝐥𝐭",hn=new Set(["\\alpha","\\gamma","\\delta","\\epsilon","\\eta","\\iota","\\kappa","\\mu","\\nu","\\pi","\\rho","\\sigma","\\tau","\\upsilon","\\chi","\\psi","\\omega","\\imath","\\jmath"]),pn=new Set(["\\Gamma","\\Delta","\\Sigma","\\Omega","\\beta","\\delta","\\lambda","\\theta","\\psi"]),ur=(e,t)=>{const r=e.isStretchy?Ze.accentNode(e):new p.MathNode("mo",[Q(e.label,e.mode)]);if(e.label==="\\vec")r.style.transform="scale(0.75) translate(10%, 30%)";else if(r.style.mathStyle="normal",r.style.mathDepth="0",gn.has(e.label)&&L.isCharacterBox(e.base)){let o="";const a=e.base.text;(dn.indexOf(a)>-1||hn.has(a))&&(o="tml-xshift"),(mn.indexOf(a)>-1||pn.has(a))&&(o="tml-capshift"),o&&r.classes.push(o)}return e.isStretchy||r.setAttribute("stretchy","false"),new p.MathNode(e.label==="\\c"?"munder":"mover",[E(e.base,t),r])},fn=new Set(["\\acute","\\grave","\\ddot","\\dddot","\\ddddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"]),gn=new Set(["\\acute","\\bar","\\breve","\\check","\\dot","\\ddot","\\grave","\\hat","\\mathring","\\'","\\^","\\~","\\=","\\u","\\.",'\\"',"\\r","\\H","\\v"]);q({type:"accent",names:["\\acute","\\grave","\\ddot","\\dddot","\\ddddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\overparen","\\widecheck","\\widehat","\\wideparen","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(e,t)=>{const r=Oe(t[0]),n=!fn.has(e.funcName);return{type:"accent",mode:e.parser.mode,label:e.funcName,isStretchy:n,base:r}},mathmlBuilder:ur});q({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\c","\\u","\\.",'\\"',"\\r","\\H","\\v"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(e,t)=>{const r=Oe(t[0]),n=e.parser.mode;return n==="math"&&e.parser.settings.strict&&console.log(`Temml parse error: Command ${e.funcName} is invalid in math mode.`),{type:"accent",mode:n,label:e.funcName,isStretchy:!1,base:r}},mathmlBuilder:ur});q({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underparen","\\utilde"],props:{numArgs:1},handler:({parser:e,funcName:t},r)=>{const n=r[0];return{type:"accentUnder",mode:e.mode,label:t,base:n}},mathmlBuilder:(e,t)=>{const r=Ze.accentNode(e);return r.style["math-depth"]=0,new p.MathNode("munder",[E(e.base,t),r])}});const Ot={pt:800/803,pc:12*800/803,dd:1238/1157*800/803,cc:14856/1157*800/803,nd:685/642*800/803,nc:1370/107*800/803,sp:1/65536*800/803,mm:25.4/72,cm:2.54/72,in:1/72,px:96/72},bn=["em","ex","mu","pt","mm","cm","in","px","bp","pc","dd","cc","nd","nc","sp"],cr=function(e){return typeof e!="string"&&(e=e.unit),bn.indexOf(e)>-1},dr=e=>{const t=Math.max(e-1,0);return[1,.7,.5][t]},le=function(e,t){let r=e.number;if(t.maxSize[0]<0&&r>0)return{number:0,unit:"em"};const n=e.unit;switch(n){case"mm":case"cm":case"in":case"px":return r*Ot[n]>t.maxSize[1]?{number:t.maxSize[1],unit:"pt"}:{number:r,unit:n};case"em":case"ex":return n==="ex"&&(r*=.431),r=Math.min(r/dr(t.level),t.maxSize[0]),{number:L.round(r),unit:"em"};case"bp":return r>t.maxSize[1]&&(r=t.maxSize[1]),{number:r,unit:"pt"};case"pt":case"pc":case"dd":case"cc":case"nd":case"nc":case"sp":return r=Math.min(r*Ot[n],t.maxSize[1]),{number:L.round(r),unit:"pt"};case"mu":return r=Math.min(r/18,t.maxSize[0]),{number:L.round(r),unit:"em"};default:throw new w("Invalid unit: '"+n+"'")}},ae=e=>{const t=new p.MathNode("mspace");return t.setAttribute("width",e+"em"),t},Ie=(e,t=.3,r=0)=>{if(e==null&&r===0)return ae(t);const n=e?[e]:[];return t!==0&&n.unshift(ae(t)),r>0&&n.push(ae(r)),new p.MathNode("mrow",n)},et=(e,t)=>Number(e)/dr(t),nt=(e,t,r,n)=>{const o=Ze.mathMLnode(e),a=e.slice(1,3)==="eq",l=e.charAt(1)==="x"?"1.75":e.slice(2,4)==="cd"?"3.0":a?"1.0":"2.0";o.setAttribute("lspace","0"),o.setAttribute("rspace",a?"0.5em":"0");const u=n.withLevel(n.level<2?2:3),h=et(l,u.level),g=et(l,3),y=Ie(null,h.toFixed(4),0),_=Ie(null,g.toFixed(4),0),b=et(a?0:.3,u.level).toFixed(4);let A,C;const H=t&&t.body&&(t.body.body||t.body.length>0);if(H){let V=E(t,u);V=Ie(V,b,b),A=new p.MathNode("mover",[V,_])}const oe=r&&r.body&&(r.body.body||r.body.length>0);if(oe){let V=E(r,u);V=Ie(V,b,b),C=new p.MathNode("munder",[V,_])}let I;return!H&&!oe?I=new p.MathNode("mover",[o,y]):H&&oe?I=new p.MathNode("munderover",[o,C,A]):H?I=new p.MathNode("mover",[o,A]):I=new p.MathNode("munder",[o,C]),l==="3.0"&&(I.style.height="1em"),I.setAttribute("accent","false"),I};q({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\yields","\\yieldsLeft","\\mesomerism","\\longrightharpoonup","\\longleftharpoondown","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler({parser:e,funcName:t},r,n){return{type:"xArrow",mode:e.mode,name:t,body:r[0],below:n[0]}},mathmlBuilder(e,t){const n=[nt(e.name,e.body,e.below,t)];return n.unshift(ae(.2778)),n.push(ae(.2778)),new p.MathNode("mrow",n)}});const Ct={"\\xtofrom":["\\xrightarrow","\\xleftarrow"],"\\xleftrightharpoons":["\\xleftharpoonup","\\xrightharpoondown"],"\\xrightleftharpoons":["\\xrightharpoonup","\\xleftharpoondown"],"\\yieldsLeftRight":["\\yields","\\yieldsLeft"],"\\equilibrium":["\\longrightharpoonup","\\longleftharpoondown"],"\\equilibriumRight":["\\longrightharpoonup","\\eqleftharpoondown"],"\\equilibriumLeft":["\\eqrightharpoonup","\\longleftharpoondown"]};q({type:"stackedArrow",names:["\\xtofrom","\\xleftrightharpoons","\\xrightleftharpoons","\\yieldsLeftRight","\\equilibrium","\\equilibriumRight","\\equilibriumLeft"],props:{numArgs:1,numOptionalArgs:1},handler({parser:e,funcName:t},r,n){const o=r[0]?{type:"hphantom",mode:e.mode,body:r[0]}:null,a=n[0]?{type:"hphantom",mode:e.mode,body:n[0]}:null;return{type:"stackedArrow",mode:e.mode,name:t,body:r[0],upperArrowBelow:a,lowerArrowBody:o,below:n[0]}},mathmlBuilder(e,t){const r=Ct[e.name][0],n=Ct[e.name][1],o=nt(r,e.body,e.upperArrowBelow,t),a=nt(n,e.lowerArrowBody,e.below,t);let l;const u=new p.MathNode("mpadded",[o]);if(u.setAttribute("voffset","0.3em"),u.setAttribute("height","+0.3em"),u.setAttribute("depth","-0.3em"),e.name==="\\equilibriumLeft"){const h=new p.MathNode("mpadded",[a]);h.setAttribute("width","0.5em"),l=new p.MathNode("mpadded",[ae(.2778),h,u,ae(.2778)])}else u.setAttribute("width",e.name==="\\equilibriumRight"?"0.5em":"0"),l=new p.MathNode("mpadded",[ae(.2778),u,a,ae(.2778)]);return l.setAttribute("voffset","-0.18em"),l.setAttribute("height","-0.18em"),l.setAttribute("depth","+0.18em"),l}});function O(e,t){if(!e||e.type!==t)throw new Error(`Expected node of type ${t}, but got `+(e?`node of type ${e.type}`:String(e)));return e}function mt(e){const t=Xe(e);if(!t)throw new Error("Expected node of symbol group type, but got "+(e?`node of type ${e.type}`:String(e)));return t}function Xe(e){return e&&(e.type==="atom"||Object.prototype.hasOwnProperty.call(tn,e.type))?e:null}const xn={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},Bt=()=>({type:"styling",body:[],mode:"math",scriptLevel:"display"}),Mt=e=>e.type==="textord"&&e.text==="@",wn=(e,t)=>(e.type==="mathord"||e.type==="atom")&&e.text===t;function yn(e,t,r){const n=xn[e];switch(n){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return r.callFunction(n,[t[0]],[t[1]]);case"\\uparrow":case"\\downarrow":{const o=r.callFunction("\\\\cdleft",[t[0]],[]),a={type:"atom",text:n,mode:"math",family:"rel"},l=r.callFunction("\\Big",[a],[]),u=r.callFunction("\\\\cdright",[t[1]],[]),h={type:"ordgroup",mode:"math",body:[o,l,u],semisimple:!0};return r.callFunction("\\\\cdparent",[h],[])}case"\\\\cdlongequal":return r.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{const o={type:"textord",text:"\\Vert",mode:"math"};return r.callFunction("\\Big",[o],[])}default:return{type:"textord",text:" ",mode:"math"}}}function vn(e){const t=[];for(e.gullet.beginGroup(),e.gullet.macros.set("\\cr","\\\\\\relax"),e.gullet.beginGroup();;){t.push(e.parseExpression(!1,"\\\\")),e.gullet.endGroup(),e.gullet.beginGroup();const o=e.fetch().text;if(o==="&"||o==="\\\\")e.consume();else if(o==="\\end"){t[t.length-1].length===0&&t.pop();break}else throw new w("Expected \\\\ or \\cr or \\end",e.nextToken)}let r=[];const n=[r];for(let o=0;o<t.length;o++){const a=t[o];let l=Bt();for(let u=0;u<a.length;u++)if(!Mt(a[u]))l.body.push(a[u]);else{r.push(l),u+=1;const h=mt(a[u]).text,g=new Array(2);if(g[0]={type:"ordgroup",mode:"math",body:[]},g[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(h)>-1))if("<>AV".indexOf(h)>-1)for(let _=0;_<2;_++){let b=!0;for(let A=u+1;A<a.length;A++){if(wn(a[A],h)){b=!1,u=A;break}if(Mt(a[A]))throw new w("Missing a "+h+" character to complete a CD arrow.",a[A]);g[_].body.push(a[A])}if(b)throw new w("Missing a "+h+" character to complete a CD arrow.",a[u])}else throw new w('Expected one of "<>AV=|." after @.');const y=yn(h,g,e);r.push(y),l=Bt()}o%2===0?r.push(l):r.shift(),r=[],n.push(r)}return n.pop(),e.gullet.endGroup(),e.gullet.endGroup(),{type:"array",mode:"math",body:n,envClasses:["jot","cd"],cols:[],hLinesBeforeRow:new Array(n.length+1).fill([])}}q({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler({parser:e,funcName:t},r){return{type:"cdlabel",mode:e.mode,side:t.slice(4),label:r[0]}},mathmlBuilder(e,t){let r=new p.MathNode("mrow",[E(e.label,t)]);return r=new p.MathNode("mpadded",[r]),r.setAttribute("width","0"),e.side==="left"&&r.setAttribute("lspace","-1width"),r.setAttribute("voffset","0.7em"),r=new p.MathNode("mstyle",[r]),r.setAttribute("displaystyle","false"),r.setAttribute("scriptlevel","1"),r}});q({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler({parser:e},t){return{type:"cdlabelparent",mode:e.mode,fragment:t[0]}},mathmlBuilder(e,t){return new p.MathNode("mrow",[E(e.fragment,t)])}});q({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler({parser:e,token:t},r){const o=O(r[0],"ordgroup").body;let a="";for(let u=0;u<o.length;u++){const h=O(o[u],"textord");a+=h.text}const l=parseInt(a);if(isNaN(l))throw new w(`\\@char has non-numeric argument ${a}`,t);return{type:"textord",mode:e.mode,text:String.fromCodePoint(l)}}});const kn=/^(#[a-f0-9]{3}|#?[a-f0-9]{6})$/i,Sn=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i,An=/^ *\d{1,3} *(?:, *\d{1,3} *){2}$/,_n=/^ *[10](?:\.\d*)? *(?:, *[10](?:\.\d*)? *){2}$/,qn=/^[a-f0-9]{6}$/i,Nt=e=>{let t=e.toString(16);return t.length===1&&(t="0"+t),t},Lt=JSON.parse(`{
  "Apricot": "#ffb484",
  "Aquamarine": "#08b4bc",
  "Bittersweet": "#c84c14",
  "blue": "#0000FF",
  "Blue": "#303494",
  "BlueGreen": "#08b4bc",
  "BlueViolet": "#503c94",
  "BrickRed": "#b8341c",
  "brown": "#BF8040",
  "Brown": "#802404",
  "BurntOrange": "#f8941c",
  "CadetBlue": "#78749c",
  "CarnationPink": "#f884b4",
  "Cerulean": "#08a4e4",
  "CornflowerBlue": "#40ace4",
  "cyan": "#00FFFF",
  "Cyan": "#08acec",
  "Dandelion": "#ffbc44",
  "darkgray": "#404040",
  "DarkOrchid": "#a8548c",
  "Emerald": "#08ac9c",
  "ForestGreen": "#089c54",
  "Fuchsia": "#90348c",
  "Goldenrod": "#ffdc44",
  "gray": "#808080",
  "Gray": "#98949c",
  "green": "#00FF00",
  "Green": "#08a44c",
  "GreenYellow": "#e0e474",
  "JungleGreen": "#08ac9c",
  "Lavender": "#f89cc4",
  "lightgray": "#c0c0c0",
  "lime": "#BFFF00",
  "LimeGreen": "#90c43c",
  "magenta": "#FF00FF",
  "Magenta": "#f0048c",
  "Mahogany": "#b0341c",
  "Maroon": "#b03434",
  "Melon": "#f89c7c",
  "MidnightBlue": "#086494",
  "Mulberry": "#b03c94",
  "NavyBlue": "#086cbc",
  "olive": "#7F7F00",
  "OliveGreen": "#407c34",
  "orange": "#FF8000",
  "Orange": "#f8843c",
  "OrangeRed": "#f0145c",
  "Orchid": "#b074ac",
  "Peach": "#f8945c",
  "Periwinkle": "#8074bc",
  "PineGreen": "#088c74",
  "pink": "#ff7f7f",
  "Plum": "#98248c",
  "ProcessBlue": "#08b4ec",
  "purple": "#BF0040",
  "Purple": "#a0449c",
  "RawSienna": "#983c04",
  "red": "#ff0000",
  "Red": "#f01c24",
  "RedOrange": "#f86434",
  "RedViolet": "#a0246c",
  "Rhodamine": "#f0549c",
  "Royallue": "#0874bc",
  "RoyalPurple": "#683c9c",
  "RubineRed": "#f0047c",
  "Salmon": "#f8948c",
  "SeaGreen": "#30bc9c",
  "Sepia": "#701404",
  "SkyBlue": "#48c4dc",
  "SpringGreen": "#c8dc64",
  "Tan": "#e09c74",
  "teal": "#007F7F",
  "TealBlue": "#08acb4",
  "Thistle": "#d884b4",
  "Turquoise": "#08b4cc",
  "violet": "#800080",
  "Violet": "#60449c",
  "VioletRed": "#f054a4",
  "WildStrawberry": "#f0246c",
  "yellow": "#FFFF00",
  "Yellow": "#fff404",
  "YellowGreen": "#98cc6c",
  "YellowOrange": "#ffa41c"
}`),Se=(e,t)=>{let r="";if(e==="HTML"){if(!kn.test(t))throw new w("Invalid HTML input.");r=t}else if(e==="RGB"){if(!An.test(t))throw new w("Invalid RGB input.");t.split(",").map(n=>{r+=Nt(Number(n.trim()))})}else{if(!_n.test(t))throw new w("Invalid rbg input.");t.split(",").map(n=>{const o=Number(n.trim());if(o>1)throw new w("Color rgb input must be < 1.");r+=Nt(Number((o*255).toFixed(0)))})}return r.charAt(0)!=="#"&&(r="#"+r),r},Ce=(e,t,r)=>{const n=`\\\\color@${e}`;if(!Sn.exec(e))throw new w("Invalid color: '"+e+"'",r);return qn.test(e)?"#"+e:(e.charAt(0)==="#"||(t.has(n)?e=t.get(n).tokens[0].text:Lt[e]&&(e=Lt[e])),e)},mr=(e,t)=>{let r=K(e.body,t.withColor(e.color));return r=r.map(n=>(n.style.color=e.color,n)),p.newDocumentFragment(r)};q({type:"color",names:["\\textcolor"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,argTypes:["raw","raw","original"]},handler({parser:e,token:t},r,n){const o=n[0]&&O(n[0],"raw").string;let a="";if(o){const u=O(r[0],"raw").string;a=Se(o,u)}else a=Ce(O(r[0],"raw").string,e.gullet.macros,t);const l=r[1];return{type:"color",mode:e.mode,color:a,body:P(l)}},mathmlBuilder:mr});q({type:"color",names:["\\color"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0,argTypes:["raw","raw"]},handler({parser:e,breakOnTokenText:t,token:r},n,o){const a=o[0]&&O(o[0],"raw").string;let l="";if(a){const h=O(n[0],"raw").string;l=Se(a,h)}else l=Ce(O(n[0],"raw").string,e.gullet.macros,r);const u=e.parseExpression(!0,t,!0);return{type:"color",mode:e.mode,color:l,body:u}},mathmlBuilder:mr});q({type:"color",names:["\\definecolor"],props:{numArgs:3,allowedInText:!0,argTypes:["raw","raw","raw"]},handler({parser:e,funcName:t,token:r},n){const o=O(n[0],"raw").string;if(!/^[A-Za-z]+$/.test(o))throw new w("Color name must be latin letters.",r);const a=O(n[1],"raw").string;if(!["HTML","RGB","rgb"].includes(a))throw new w("Color model must be HTML, RGB, or rgb.",r);const l=O(n[2],"raw").string,u=Se(a,l);return e.gullet.macros.set(`\\\\color@${o}`,{tokens:[{text:u}],numArgs:0}),{type:"internal",mode:e.mode}}});q({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler({parser:e},t,r){const n=e.gullet.future().text==="["?e.parseSizeGroup(!0):null,o=!e.settings.displayMode;return{type:"cr",mode:e.mode,newLine:o,size:n&&O(n,"size").value}},mathmlBuilder(e,t){const r=new p.MathNode("mo");if(e.newLine&&(r.setAttribute("linebreak","newline"),e.size)){const n=le(e.size,t);r.setAttribute("height",n.number+n.unit)}return r}});const ot={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},He=e=>{const t=e.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(t))throw new w("Expected a control sequence",e);return t},Tn=e=>{let t=e.gullet.popToken();return t.text==="="&&(t=e.gullet.popToken(),t.text===" "&&(t=e.gullet.popToken())),t},hr=(e,t,r,n)=>{let o=e.gullet.macros.get(r.text);o==null&&(r.noexpand=!0,o={tokens:[r],numArgs:0,unexpandable:!e.gullet.isExpandable(r.text)}),e.gullet.macros.set(t,o,n)};q({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler({parser:e,funcName:t}){e.consumeSpaces();const r=e.fetch();if(ot[r.text])return(t==="\\global"||t==="\\\\globallong")&&(r.text=ot[r.text]),O(e.parseFunction(),"internal");throw new w("Invalid token after macro prefix",r)}});q({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler({parser:e,funcName:t}){let r=e.gullet.popToken();const n=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(n))throw new w("Expected a control sequence",r);let o=0,a;const l=[[]];for(;e.gullet.future().text!=="{";)if(r=e.gullet.popToken(),r.text==="#"){if(e.gullet.future().text==="{"){a=e.gullet.future(),l[o].push("{");break}if(r=e.gullet.popToken(),!/^[1-9]$/.test(r.text))throw new w(`Invalid argument number "${r.text}"`);if(parseInt(r.text)!==o+1)throw new w(`Argument number "${r.text}" out of order`);o++,l.push([])}else{if(r.text==="EOF")throw new w("Expected a macro definition");l[o].push(r.text)}let{tokens:u}=e.gullet.consumeArg();return a&&u.unshift(a),(t==="\\edef"||t==="\\xdef")&&(u=e.gullet.expandTokens(u),u.reverse()),e.gullet.macros.set(n,{tokens:u,numArgs:o,delimiters:l},t===ot[t]),{type:"internal",mode:e.mode}}});q({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler({parser:e,funcName:t}){const r=He(e.gullet.popToken());e.gullet.consumeSpaces();const n=Tn(e);return hr(e,r,n,t==="\\\\globallet"),{type:"internal",mode:e.mode}}});q({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler({parser:e,funcName:t}){const r=He(e.gullet.popToken()),n=e.gullet.popToken(),o=e.gullet.popToken();return hr(e,r,o,t==="\\\\globalfuture"),e.gullet.pushToken(o),e.gullet.pushToken(n),{type:"internal",mode:e.mode}}});q({type:"internal",names:["\\newcommand","\\renewcommand","\\providecommand"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler({parser:e,funcName:t}){let r="";const n=e.gullet.popToken();n.text==="{"?(r=He(e.gullet.popToken()),e.gullet.popToken()):r=He(n);const o=e.gullet.isDefined(r);if(o&&t==="\\newcommand")throw new w(`\\newcommand{${r}} attempting to redefine ${r}; use \\renewcommand`);if(!o&&t==="\\renewcommand")throw new w(`\\renewcommand{${r}} when command ${r} does not yet exist; use \\newcommand`);let a=0;if(e.gullet.future().text==="["){let u=e.gullet.popToken();if(u=e.gullet.popToken(),!/^[0-9]$/.test(u.text))throw new w(`Invalid number of arguments: "${u.text}"`);if(a=parseInt(u.text),u=e.gullet.popToken(),u.text!=="]")throw new w(`Invalid argument "${u.text}"`)}const{tokens:l}=e.gullet.consumeArg();return e.gullet.macros.set(r,{tokens:l,numArgs:a},!e.settings.strict),{type:"internal",mode:e.mode}}});const st={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},pr=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","⦇","\\llparenthesis","⦈","\\rrparenthesis","\\lfloor","\\rfloor","⌊","⌋","\\lceil","\\rceil","⌈","⌉","<",">","\\langle","⟨","\\rangle","⟩","\\lAngle","⟪","\\rAngle","⟫","\\llangle","⦉","\\rrangle","⦊","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","⟮","⟯","\\lmoustache","\\rmoustache","⎰","⎱","\\llbracket","\\rrbracket","⟦","⟦","\\lBrace","\\rBrace","⦃","⦄","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."],$n=["}","\\left","\\middle","\\right"],Ye=e=>e.length>0&&(pr.includes(e)||st[e]||$n.includes(e)),Et=[0,1.2,1.8,2.4,3];function Be(e,t){const r=Xe(e);if(r&&pr.includes(r.text))return["/","⁄"].includes(r.text)&&(r.text="∕"),["<","\\lt"].includes(r.text)&&(r.text="⟨"),[">","\\gt"].includes(r.text)&&(r.text="⟩"),r.text==="\\backslash"&&(r.text="∖"),r;throw r?new w(`Invalid delimiter '${r.text}' after '${t.funcName}'`,e):new w(`Invalid delimiter type '${e.type}'`,e)}q({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(e,t)=>{const r=Be(t[0],e);return{type:"delimsizing",mode:e.parser.mode,size:st[e.funcName].size,mclass:st[e.funcName].mclass,delim:r.text}},mathmlBuilder:e=>{const t=[];e.delim==="."&&(e.delim=""),t.push(Q(e.delim,e.mode));const r=new p.MathNode("mo",t);return e.mclass==="mopen"||e.mclass==="mclose"?r.setAttribute("fence","true"):r.setAttribute("fence","false"),(e.delim==="∖"||e.delim==="\\vert"||e.delim==="|"||e.delim.indexOf("arrow")>-1)&&r.setAttribute("stretchy","true"),r.setAttribute("symmetric","true"),r.setAttribute("minsize",Et[e.size]+"em"),r.setAttribute("maxsize",Et[e.size]+"em"),r}});function Dn(e){if(!e.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}q({type:"leftright-right",names:["\\right"],props:{numArgs:1,argTypes:["primitive"]},handler:(e,t)=>({type:"leftright-right",mode:e.parser.mode,delim:Be(t[0],e).text})});q({type:"leftright",names:["\\left"],props:{numArgs:1,argTypes:["primitive"]},handler:(e,t)=>{const r=Be(t[0],e),n=e.parser;++n.leftrightDepth;let o=n.parseExpression(!1,null,!0),a=n.fetch();for(;a.text==="\\middle";){n.consume();const u=n.fetch().text;if(!j.math[u])throw new w(`Invalid delimiter '${u}' after '\\middle'`);Be({type:"atom",mode:"math",text:u},{funcName:"\\middle"}),o.push({type:"middle",mode:"math",delim:u}),n.consume(),o=o.concat(n.parseExpression(!1,null,!0)),a=n.fetch()}--n.leftrightDepth,n.expect("\\right",!1);const l=O(n.parseFunction(),"leftright-right");return{type:"leftright",mode:n.mode,body:o,left:r.text,right:l.delim}},mathmlBuilder:(e,t)=>{Dn(e);const r=K(e.body,t);e.left==="."&&(e.left="");const n=new p.MathNode("mo",[Q(e.left,e.mode)]);n.setAttribute("fence","true"),n.setAttribute("form","prefix"),(e.left==="∖"||e.left.indexOf("arrow")>-1)&&n.setAttribute("stretchy","true"),r.unshift(n),e.right==="."&&(e.right="");const o=new p.MathNode("mo",[Q(e.right,e.mode)]);return o.setAttribute("fence","true"),o.setAttribute("form","postfix"),(e.right==="∖"||e.right.indexOf("arrow")>-1)&&o.setAttribute("stretchy","true"),r.push(o),dt(r)}});q({type:"middle",names:["\\middle"],props:{numArgs:1,argTypes:["primitive"]},handler:(e,t)=>{const r=Be(t[0],e);if(!e.parser.leftrightDepth)throw new w("\\middle without preceding \\left",r);return{type:"middle",mode:e.parser.mode,delim:r.text}},mathmlBuilder:(e,t)=>{const r=Q(e.delim,e.mode),n=new p.MathNode("mo",[r]);return n.setAttribute("fence","true"),e.delim.indexOf("arrow")>-1&&n.setAttribute("stretchy","true"),n.setAttribute("form","prefix"),n.setAttribute("lspace","0.05em"),n.setAttribute("rspace","0.05em"),n}});const zt=e=>{const t=new p.MathNode("mspace");return t.setAttribute("width","3pt"),t},Ke=(e,t)=>{let r;switch(e.label.indexOf("colorbox")>-1||e.label==="\\boxed"?r=new p.MathNode("mrow",[zt(),E(e.body,t),zt()]):r=new p.MathNode("mrow",[E(e.body,t)]),e.label){case"\\overline":r.style.padding="0.1em 0 0 0",r.style.borderTop="0.065em solid";break;case"\\underline":r.style.padding="0 0 0.1em 0",r.style.borderBottom="0.065em solid";break;case"\\cancel":r.classes.push("tml-cancel");break;case"\\bcancel":r.classes.push("tml-bcancel");break;case"\\angl":r.style.padding="0.03889em 0.03889em 0 0.03889em",r.style.borderTop="0.049em solid",r.style.borderRight="0.049em solid",r.style.marginRight="0.03889em";break;case"\\sout":r.style.backgroundImage="linear-gradient(black, black)",r.style.backgroundRepeat="no-repeat",r.style.backgroundSize="100% 1.5px",r.style.backgroundPosition="0 center";break;case"\\boxed":r.style={padding:"3pt 0 3pt 0",border:"1px solid"},r.setAttribute("scriptlevel","0"),r.setAttribute("displaystyle","true");break;case"\\fbox":r.style={padding:"3pt",border:"1px solid"};break;case"\\fcolorbox":case"\\colorbox":{const n={padding:"3pt 0 3pt 0"};e.label==="\\fcolorbox"&&(n.border="0.06em solid "+String(e.borderColor)),r.style=n;break}case"\\xcancel":r.classes.push("tml-xcancel");break}return e.backgroundColor&&r.setAttribute("mathbackground",e.backgroundColor),r};q({type:"enclose",names:["\\colorbox"],props:{numArgs:2,numOptionalArgs:1,allowedInText:!0,argTypes:["raw","raw","text"]},handler({parser:e,funcName:t},r,n){const o=n[0]&&O(n[0],"raw").string;let a="";if(o){const u=O(r[0],"raw").string;a=Se(o,u)}else a=Ce(O(r[0],"raw").string,e.gullet.macros);const l=r[1];return{type:"enclose",mode:e.mode,label:t,backgroundColor:a,body:l}},mathmlBuilder:Ke});q({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,numOptionalArgs:1,allowedInText:!0,argTypes:["raw","raw","raw","text"]},handler({parser:e,funcName:t},r,n){const o=n[0]&&O(n[0],"raw").string;let a="",l;if(o){const h=O(r[0],"raw").string,g=O(r[0],"raw").string;a=Se(o,h),l=Se(o,g)}else a=Ce(O(r[0],"raw").string,e.gullet.macros),l=Ce(O(r[1],"raw").string,e.gullet.macros);const u=r[2];return{type:"enclose",mode:e.mode,label:t,backgroundColor:l,borderColor:a,body:u}},mathmlBuilder:Ke});q({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler({parser:e},t){return{type:"enclose",mode:e.mode,label:"\\fbox",body:t[0]}}});q({type:"enclose",names:["\\angl","\\cancel","\\bcancel","\\xcancel","\\sout","\\overline","\\boxed"],props:{numArgs:1},handler({parser:e,funcName:t},r){const n=r[0];return{type:"enclose",mode:e.mode,label:t,body:n}},mathmlBuilder:Ke});q({type:"enclose",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler({parser:e,funcName:t},r){const n=r[0];return{type:"enclose",mode:e.mode,label:t,body:n}},mathmlBuilder:Ke});const fr={};function te({type:e,names:t,props:r,handler:n,mathmlBuilder:o}){const a={type:e,numArgs:r.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:n};for(let l=0;l<t.length;++l)fr[t[l]]=a;o&&(Ue[e]=o)}const G={DISPLAY:0,TEXT:1,SCRIPT:2,SCRIPTSCRIPT:3};function It(e){const t=[];e.consumeSpaces();let r=e.fetch().text;for(r==="\\relax"&&(e.consume(),e.consumeSpaces(),r=e.fetch().text);r==="\\hline"||r==="\\hdashline";)e.consume(),t.push(r==="\\hdashline"),e.consumeSpaces(),r=e.fetch().text;return t}const Ne=e=>{if(!e.parser.settings.displayMode)throw new w(`{${e.envName}} can be used only in display mode.`)},On=(e,t,r)=>{let n;const o=e.tags.shift();if(o)if(o.body)n=de(o.body,t,!0),n.classes=["tml-tag"];else return n=new p.MathNode("mtext",[],[]),n;else{if(e.envClasses.includes("multline")&&(e.leqno&&r!==0||!e.leqno&&r!==e.body.length-1))return n=new p.MathNode("mtext",[],[]),n;n=new p.MathNode("mtext",[new ir(["tml-eqn"])])}return n};function me(e,{cols:t,envClasses:r,addEqnNum:n,singleRow:o,emptySingleRow:a,maxNumCols:l,leqno:u},h){e.gullet.beginGroup(),o||e.gullet.macros.set("\\cr","\\\\\\relax"),n&&(e.gullet.macros.set("\\tag","\\@ifstar\\envtag@literal\\envtag@paren"),e.gullet.macros.set("\\envtag@paren","\\env@tag{{(\\text{#1})}}"),e.gullet.macros.set("\\envtag@literal","\\env@tag{\\text{#1}}"),e.gullet.macros.set("\\notag","\\env@notag"),e.gullet.macros.set("\\nonumber","\\env@notag")),e.gullet.beginGroup();let g=[];const y=[g],_=[],b=[];let A;const C=[];for(C.push(It(e));;){let H=e.parseExpression(!1,o?"\\end":"\\\\");if(n&&!A){for(let I=0;I<H.length;I++)if(H[I].type==="envTag"||H[I].type==="noTag"){A=H[I].type==="envTag"?H.splice(I,1)[0].body.body[0]:{body:null};break}}e.gullet.endGroup(),e.gullet.beginGroup(),H={type:"ordgroup",mode:e.mode,body:H,semisimple:!0},g.push(H);const oe=e.fetch().text;if(oe==="&"){if(l&&g.length===l)if(r.includes("array")){if(e.settings.strict)throw new w("Too few columns specified in the {array} column argument.",e.nextToken)}else throw l===2?new w("The split environment accepts no more than two columns",e.nextToken):new w("The equation environment accepts only one column",e.nextToken);e.consume()}else if(oe==="\\end"){g.length===1&&H.body.length===0&&(y.length>1||!a)&&y.pop(),C.length<y.length+1&&C.push([]);break}else if(oe==="\\\\"){e.consume();let I;e.gullet.future().text!==" "&&(I=e.parseSizeGroup(!0)),_.push(I?I.value:null),b.push(A),C.push(It(e)),g=[],A=null,y.push(g)}else throw new w("Expected & or \\\\ or \\cr or \\end",e.nextToken)}return e.gullet.endGroup(),e.gullet.endGroup(),b.push(A),{type:"array",mode:e.mode,body:y,cols:t,rowGaps:_,hLinesBeforeRow:C,envClasses:r,addEqnNum:n,scriptLevel:h,tags:b,leqno:u}}function gr(e){return e.slice(0,1)==="d"?"display":"text"}const Cn={c:"center ",l:"left ",r:"right "},Ft=e=>{const t=new p.MathNode("mtd",[]);return t.style={padding:"0",width:"50%"},e.envClasses.includes("multline")&&(t.style.width="7.5%"),t},re=function(e,t){const r=[],n=e.body.length,o=e.hLinesBeforeRow;for(let u=0;u<n;u++){const h=e.body[u],g=[],y=e.scriptLevel==="text"?G.TEXT:e.scriptLevel==="script"?G.SCRIPT:G.DISPLAY;for(let b=0;b<h.length;b++){const A=new p.MathNode("mtd",[E(h[b],t.withLevel(y))]);if(e.envClasses.includes("multline")){const C=u===0?"left":u===n-1?"right":"center";A.setAttribute("columnalign",C),C!=="center"&&A.classes.push("tml-"+C)}g.push(A)}if(e.addEqnNum){g.unshift(Ft(e)),g.push(Ft(e));const b=On(e,t.withLevel(y),u);e.leqno?(g[0].children.push(b),g[0].classes.push("tml-left")):(g[g.length-1].children.push(b),g[g.length-1].classes.push("tml-right"))}const _=new p.MathNode("mtr",g,[]);u===0&&o[0].length>0&&(o[0].length===2?_.children.forEach(b=>{b.style.borderTop="0.15em double"}):_.children.forEach(b=>{b.style.borderTop=o[0][0]?"0.06em dashed":"0.06em solid"})),o[u+1].length>0&&(o[u+1].length===2?_.children.forEach(b=>{b.style.borderBottom="0.15em double"}):_.children.forEach(b=>{b.style.borderBottom=o[u+1][0]?"0.06em dashed":"0.06em solid"})),r.push(_)}if(e.envClasses.length>0){const u=e.envClasses.includes("jot")?"0.7":e.envClasses.includes("small")?"0.35":"0.5",h=e.envClasses.includes("abut")||e.envClasses.includes("cases")?"0":e.envClasses.includes("small")?"0.1389":e.envClasses.includes("cd")?"0.25":"0.4",g=r.length===0?0:r[0].children.length,y=(b,A)=>b===0&&A===0||b===g-1&&A===1?"0":e.envClasses[0]!=="align"?h:A===1?"0":e.addEqnNum?b%2?"1":"0":b%2?"0":"1";for(let b=0;b<r.length;b++)for(let A=0;A<r[b].children.length;A++)r[b].children[A].style.padding=`${u}ex ${y(A,1)}em ${u}ex ${y(A,0)}em`;const _=e.envClasses.includes("align")||e.envClasses.includes("alignat");for(let b=0;b<r.length;b++){const A=r[b];if(_){for(let C=0;C<A.children.length;C++)A.children[C].classes=["tml-"+(C%2?"left":"right")];if(e.addEqnNum){const C=e.leqno?0:A.children.length-1;A.children[C].classes=["tml-"+(e.leqno?"left":"right")]}}if(A.children.length>1&&e.envClasses.includes("cases")&&(A.children[1].style.padding=A.children[1].style.padding.replace(/0em$/,"1em")),e.envClasses.includes("cases")||e.envClasses.includes("subarray"))for(const C of A.children)C.classes.push("tml-left")}}else for(let u=0;u<r.length;u++)r[u].children[0].style.paddingLeft="0em",r[u].children.length===r[0].children.length&&(r[u].children[r[u].children.length-1].style.paddingRight="0em");let a=new p.MathNode("mtable",r);e.scriptLevel==="display"&&a.setAttribute("displaystyle","true"),(e.addEqnNum||e.envClasses.includes("multline"))&&(a.style.width="100%");let l="";if(e.cols&&e.cols.length>0){const u=e.cols;let h=!1,g=0,y=u.length;for(;u[g].type==="separator";)g+=1;for(;u[y-1].type==="separator";)y-=1;if(u[0].type==="separator"){const b=u[1].type==="separator"?"0.15em double":u[0].separator==="|"?"0.06em solid ":"0.06em dashed ";for(const A of a.children)A.children[0].style.borderLeft=b}let _=e.addEqnNum?0:-1;for(let b=g;b<y;b++)if(u[b].type==="align"){const A=Cn[u[b].align];l+=A,_+=1;for(const C of a.children)A.trim()!=="center"&&_<C.children.length&&(C.children[_].classes=["tml-"+A.trim()]);h=!0}else if(u[b].type==="separator"){if(h){const A=u[b+1].type==="separator"?"0.15em double":u[b].separator==="|"?"0.06em solid":"0.06em dashed";for(const C of a.children)_<C.children.length&&(C.children[_].style.borderRight=A)}h=!1}if(u[u.length-1].type==="separator"){const b=u[u.length-2].type==="separator"?"0.15em double":u[u.length-1].separator==="|"?"0.06em solid":"0.06em dashed";for(const A of a.children)A.children[A.children.length-1].style.borderRight=b,A.children[A.children.length-1].style.paddingRight="0.4em"}}return e.addEqnNum&&(l="left "+(l.length>0?l:"center ")+"right "),l&&a.setAttribute("columnalign",l.trim()),e.envClasses.includes("small")&&(a=new p.MathNode("mstyle",[a]),a.setAttribute("scriptlevel","1")),a},br=function(e,t){e.envName.indexOf("ed")===-1&&Ne(e);const r=[],n=me(e.parser,{cols:r,addEqnNum:e.envName==="align"||e.envName==="alignat",emptySingleRow:!0,envClasses:["abut","jot"],maxNumCols:e.envName==="split"?2:void 0,leqno:e.parser.settings.leqno},"display");let o,a=0;const l=e.envName.indexOf("at")>-1;if(t[0]&&l){let u="";for(let h=0;h<t[0].body.length;h++){const g=O(t[0].body[h],"textord");u+=g.text}if(isNaN(u))throw new w("The alignat enviroment requires a numeric first argument.");o=Number(u),a=o*2}n.body.forEach(function(u){if(l){const h=u.length/2;if(o<h)throw new w(`Too many math in a row: expected ${o}, but got ${h}`,u[0])}else a<u.length&&(a=u.length)});for(let u=0;u<a;++u){let h="r";u%2===1&&(h="l"),r[u]={type:"align",align:h}}return e.envName==="split"||(l?n.envClasses.push("alignat"):n.envClasses[0]="align"),n};te({type:"array",names:["array","darray"],props:{numArgs:1},handler(e,t){const o=(Xe(t[0])?[t[0]]:O(t[0],"ordgroup").body).map(function(l){const h=mt(l).text;if("lcr".indexOf(h)!==-1)return{type:"align",align:h};if(h==="|")return{type:"separator",separator:"|"};if(h===":")return{type:"separator",separator:":"};throw new w("Unknown column alignment: "+h,l)}),a={cols:o,envClasses:["array"],maxNumCols:o.length};return me(e.parser,a,gr(e.envName))},mathmlBuilder:re});te({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(e){const t={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[e.envName.replace("*","")];let r="c";const n={envClasses:[],cols:[]};if(e.envName.charAt(e.envName.length-1)==="*"){const a=e.parser;if(a.consumeSpaces(),a.fetch().text==="["){if(a.consume(),a.consumeSpaces(),r=a.fetch().text,"lcr".indexOf(r)===-1)throw new w("Expected l or c or r",a.nextToken);a.consume(),a.consumeSpaces(),a.expect("]"),a.consume(),n.cols=[]}}const o=me(e.parser,n,"text");return o.cols=new Array(o.body[0].length).fill({type:"align",align:r}),t?{type:"leftright",mode:e.mode,body:[o],left:t[0],right:t[1],rightColor:void 0}:o},mathmlBuilder:re});te({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(e){const t={type:"small"},r=me(e.parser,t,"script");return r.envClasses=["small"],r},mathmlBuilder:re});te({type:"array",names:["subarray"],props:{numArgs:1},handler(e,t){const o=(Xe(t[0])?[t[0]]:O(t[0],"ordgroup").body).map(function(l){const h=mt(l).text;if("lc".indexOf(h)!==-1)return{type:"align",align:h};throw new w("Unknown column alignment: "+h,l)});if(o.length>1)throw new w("{subarray} can contain only one column");let a={cols:o,envClasses:["small"]};if(a=me(e.parser,a,"script"),a.body.length>0&&a.body[0].length>1)throw new w("{subarray} can contain only one column");return a},mathmlBuilder:re});te({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(e){const t={cols:[],envClasses:["cases"]},r=me(e.parser,t,gr(e.envName));return{type:"leftright",mode:e.mode,body:[r],left:e.envName.indexOf("r")>-1?".":"\\{",right:e.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},mathmlBuilder:re});te({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:br,mathmlBuilder:re});te({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:br,mathmlBuilder:re});te({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(e){e.envName!=="gathered"&&Ne(e);const t={cols:[],envClasses:["abut","jot"],addEqnNum:e.envName==="gather",emptySingleRow:!0,leqno:e.parser.settings.leqno};return me(e.parser,t,"display")},mathmlBuilder:re});te({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(e){Ne(e);const t={addEqnNum:e.envName==="equation",emptySingleRow:!0,singleRow:!0,maxNumCols:1,envClasses:["align"],leqno:e.parser.settings.leqno};return me(e.parser,t,"display")},mathmlBuilder:re});te({type:"array",names:["multline","multline*"],props:{numArgs:0},handler(e){Ne(e);const t={addEqnNum:e.envName==="multline",maxNumCols:1,envClasses:["jot","multline"],leqno:e.parser.settings.leqno};return me(e.parser,t,"display")},mathmlBuilder:re});te({type:"array",names:["CD"],props:{numArgs:0},handler(e){return Ne(e),vn(e.parser)},mathmlBuilder:re});q({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(e,t){throw new w(`${e.funcName} valid only within array environment`)}});const Pt=fr;q({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler({parser:e,funcName:t},r){const n=r[0];if(n.type!=="ordgroup")throw new w("Invalid environment name",n);let o="";for(let a=0;a<n.body.length;++a)o+=O(n.body[a],"textord").text;if(t==="\\begin"){if(!Object.prototype.hasOwnProperty.call(Pt,o))throw new w("No such environment: "+o,n);const a=Pt[o],{args:l,optArgs:u}=e.parseArguments("\\begin{"+o+"}",a),h={mode:e.mode,envName:o,parser:e},g=a.handler(h,l,u);e.expect("\\end",!1);const y=e.nextToken,_=O(e.parseFunction(),"environment");if(_.name!==o)throw new w(`Mismatch: \\begin{${o}} matched by \\end{${_.name}}`,y);return g}return{type:"environment",mode:e.mode,name:o,nameGroup:n}}});q({type:"envTag",names:["\\env@tag"],props:{numArgs:1,argTypes:["math"]},handler({parser:e},t){return{type:"envTag",mode:e.mode,body:t[0]}},mathmlBuilder(e,t){return new p.MathNode("mrow")}});q({type:"noTag",names:["\\env@notag"],props:{numArgs:0},handler({parser:e}){return{type:"noTag",mode:e.mode}},mathmlBuilder(e,t){return new p.MathNode("mrow")}});const xr=(e,t)=>{const r=e.font,n=t.withFont(r),o=E(e.body,n);if(o.children.length===0)return o;if(r==="boldsymbol"&&["mo","mpadded","mrow"].includes(o.type))return o.style.fontWeight="bold",o;let a=o.children[0].type==="mo";for(let u=1;u<o.children.length;u++)o.children[u].type==="mo"&&r==="boldsymbol"&&(o.children[u].style.fontWeight="bold"),o.children[u].type!=="mi"&&(a=!1),(o.children[u].attributes&&o.children[u].attributes.mathvariant||"")!=="normal"&&(a=!1);if(!a)return o;const l=o.children[0];for(let u=1;u<o.children.length;u++)l.children.push(o.children[u].children[0]);if(l.attributes.mathvariant&&l.attributes.mathvariant==="normal"){const u=new p.MathNode("mtext",new p.TextNode("​"));return new p.MathNode("mrow",[u,l])}return l},Rt={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};q({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\up@greek","\\boldsymbol","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bm","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:({parser:e,funcName:t},r)=>{const n=Oe(r[0]);let o=t;return o in Rt&&(o=Rt[o]),{type:"font",mode:e.mode,font:o.slice(1),body:n}},mathmlBuilder:xr});q({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:({parser:e,funcName:t,breakOnTokenText:r},n)=>{const{mode:o}=e,a=e.parseExpression(!0,r,!0),l=`math${t.slice(1)}`;return{type:"font",mode:o,font:l,body:{type:"ordgroup",mode:e.mode,body:a}}},mathmlBuilder:xr});const Gt=["display","text","script","scriptscript"],Bn={auto:-1,display:0,text:0,script:1,scriptscript:2},ht=(e,t)=>{const r=e.scriptLevel==="auto"?t.incrementLevel():e.scriptLevel==="display"?t.withLevel(G.TEXT):e.scriptLevel==="text"?t.withLevel(G.SCRIPT):t.withLevel(G.SCRIPTSCRIPT);let n=new p.MathNode("mfrac",[E(e.numer,r),E(e.denom,r)]);if(!e.hasBarLine)n.setAttribute("linethickness","0px");else if(e.barSize){const o=le(e.barSize,t);n.setAttribute("linethickness",o.number+o.unit)}if(e.leftDelim!=null||e.rightDelim!=null){const o=[];if(e.leftDelim!=null){const a=new p.MathNode("mo",[new p.TextNode(e.leftDelim.replace("\\",""))]);a.setAttribute("fence","true"),o.push(a)}if(o.push(n),e.rightDelim!=null){const a=new p.MathNode("mo",[new p.TextNode(e.rightDelim.replace("\\",""))]);a.setAttribute("fence","true"),o.push(a)}n=dt(o)}return e.scriptLevel!=="auto"&&(n=new p.MathNode("mstyle",[n]),n.setAttribute("displaystyle",String(e.scriptLevel==="display")),n.setAttribute("scriptlevel",Bn[e.scriptLevel])),n};q({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:({parser:e,funcName:t},r)=>{const n=r[0],o=r[1];let a=!1,l=null,u=null,h="auto";switch(t){case"\\dfrac":case"\\frac":case"\\tfrac":a=!0;break;case"\\\\atopfrac":a=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":l="(",u=")";break;case"\\\\bracefrac":l="\\{",u="\\}";break;case"\\\\brackfrac":l="[",u="]";break;default:throw new Error("Unrecognized genfrac command")}switch(t){case"\\dfrac":case"\\dbinom":h="display";break;case"\\tfrac":case"\\tbinom":h="text";break}return{type:"genfrac",mode:e.mode,continued:!1,numer:n,denom:o,hasBarLine:a,leftDelim:l,rightDelim:u,scriptLevel:h,barSize:null}},mathmlBuilder:ht});q({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:({parser:e,funcName:t},r)=>{const n=r[0],o=r[1];return{type:"genfrac",mode:e.mode,continued:!0,numer:n,denom:o,hasBarLine:!0,leftDelim:null,rightDelim:null,scriptLevel:"display",barSize:null}}});q({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler({parser:e,funcName:t,token:r}){let n;switch(t){case"\\over":n="\\frac";break;case"\\choose":n="\\binom";break;case"\\atop":n="\\\\atopfrac";break;case"\\brace":n="\\\\bracefrac";break;case"\\brack":n="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:e.mode,replaceWith:n,token:r}}});const jt=function(e){let t=null;return e.length>0&&(t=e,t=t==="."?null:t),t};q({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler({parser:e},t){const r=t[4],n=t[5],o=Oe(t[0]),a=o.type==="atom"&&o.family==="open"?jt(o.text):null,l=Oe(t[1]),u=l.type==="atom"&&l.family==="close"?jt(l.text):null,h=O(t[2],"size");let g,y=null;h.isBlank?g=!0:(y=h.value,g=y.number>0);let _="auto",b=t[3];if(b.type==="ordgroup"){if(b.body.length>0){const A=O(b.body[0],"textord");_=Gt[Number(A.text)]}}else b=O(b,"textord"),_=Gt[Number(b.text)];return{type:"genfrac",mode:e.mode,numer:r,denom:n,continued:!1,hasBarLine:g,barSize:y,leftDelim:a,rightDelim:u,scriptLevel:_}},mathmlBuilder:ht});q({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler({parser:e,funcName:t,token:r},n){return{type:"infix",mode:e.mode,replaceWith:"\\\\abovefrac",barSize:O(n[0],"size").value,token:r}}});q({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:({parser:e,funcName:t},r)=>{const n=r[0],o=Gr(O(r[1],"infix").barSize),a=r[2],l=o.number>0;return{type:"genfrac",mode:e.mode,numer:n,denom:a,continued:!1,hasBarLine:l,barSize:o,leftDelim:null,rightDelim:null,scriptLevel:"auto"}},mathmlBuilder:ht});q({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["hbox"],allowedInArgument:!0,allowedInText:!1},handler({parser:e},t){return{type:"hbox",mode:e.mode,body:P(t[0])}},mathmlBuilder(e,t){const r=t.withLevel(G.TEXT),n=de(e.body,r);return ct(n)}});const Mn=(e,t)=>{const r=Ze.mathMLnode(e.label);return r.style["math-depth"]=0,new p.MathNode(e.isOver?"mover":"munder",[E(e.base,t),r])};q({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler({parser:e,funcName:t},r){return{type:"horizBrace",mode:e.mode,label:t,isOver:/^\\over/.test(t),base:r[0]}},mathmlBuilder:Mn});q({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:({parser:e,token:t},r)=>{const n=r[1],o=O(r[0],"url").url;if(!e.settings.isTrusted({command:"\\href",url:o}))throw new w('Function "\\href" is not trusted',t);return{type:"href",mode:e.mode,href:o,body:P(n)}},mathmlBuilder:(e,t)=>{let r=de(e.body,t);return r instanceof Y||(r=new Y("mrow",[r])),r.setAttribute("href",e.href),r}});q({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:({parser:e,token:t},r)=>{const n=O(r[0],"url").url;if(!e.settings.isTrusted({command:"\\url",url:n}))throw new w('Function "\\url" is not trusted',t);const o=[];for(let l=0;l<n.length;l++){let u=n[l];u==="~"&&(u="\\textasciitilde"),o.push({type:"textord",mode:"text",text:u})}const a={type:"text",mode:e.mode,font:"\\texttt",body:o};return{type:"href",mode:e.mode,href:n,body:P(a)}}});q({type:"html",names:["\\class","\\id","\\style","\\data"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:({parser:e,funcName:t,token:r},n)=>{const o=O(n[0],"raw").string,a=n[1];if(e.settings.strict)throw new w(`Function "${t}" is disabled in strict mode`,r);let l;const u={};switch(t){case"\\class":u.class=o,l={command:"\\class",class:o};break;case"\\id":u.id=o,l={command:"\\id",id:o};break;case"\\style":u.style=o,l={command:"\\style",style:o};break;case"\\data":{const h=o.split(",");for(let g=0;g<h.length;g++){const y=h[g].split("=");if(y.length!==2)throw new w("Error parsing key-value for \\data");u["data-"+y[0].trim()]=y[1].trim()}l={command:"\\data",attributes:u};break}default:throw new Error("Unrecognized html command")}if(!e.settings.isTrusted(l))throw new w(`Function "${t}" is not trusted`,r);return{type:"html",mode:e.mode,attributes:u,body:P(a)}},mathmlBuilder:(e,t)=>{const r=de(e.body,t),n=[];e.attributes.class&&n.push(...e.attributes.class.trim().split(/\s+/)),r.classes=n;for(const o in e.attributes)o!=="class"&&Object.prototype.hasOwnProperty.call(e.attributes,o)&&r.setAttribute(o,e.attributes[o]);return r}});const tt=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};{const t=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!t)throw new w("Invalid size: '"+e+"' in \\includegraphics");const r={number:+(t[1]+t[2]),unit:t[3]};if(!cr(r))throw new w("Invalid unit: '"+r.unit+"' in \\includegraphics.");return r}};q({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:({parser:e,token:t},r,n)=>{let o={number:0,unit:"em"},a={number:.9,unit:"em"},l={number:0,unit:"em"},u="";if(n[0]){const y=O(n[0],"raw").string.split(",");for(let _=0;_<y.length;_++){const b=y[_].split("=");if(b.length===2){const A=b[1].trim();switch(b[0].trim()){case"alt":u=A;break;case"width":o=tt(A);break;case"height":a=tt(A);break;case"totalheight":l=tt(A);break;default:throw new w("Invalid key: '"+b[0]+"' in \\includegraphics.")}}}}const h=O(r[0],"url").url;if(u===""&&(u=h,u=u.replace(/^.*[\\/]/,""),u=u.substring(0,u.lastIndexOf("."))),!e.settings.isTrusted({command:"\\includegraphics",url:h}))throw new w('Function "\\includegraphics" is not trusted',t);return{type:"includegraphics",mode:e.mode,alt:u,width:o,height:a,totalheight:l,src:h}},mathmlBuilder:(e,t)=>{const r=le(e.height,t),n={number:0,unit:"em"};e.totalheight.number>0&&e.totalheight.unit===r.unit&&e.totalheight.number>r.number&&(n.number=e.totalheight.number-r.number,n.unit=r.unit);let o=0;e.width.number>0&&(o=le(e.width,t));const a={height:r.number+n.number+"em"};o.number>0&&(a.width=o.number+o.unit),n.number>0&&(a.verticalAlign=-n.number+n.unit);const l=new Xr(e.src,e.alt,a);return l.height=r,l.depth=n,new p.MathNode("mtext",[l])}});q({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler({parser:e,funcName:t,token:r},n){const o=O(n[0],"size");if(e.settings.strict){const a=t[1]==="m",l=o.value.unit==="mu";if(a){if(!l)throw new w(`LaTeX's ${t} supports only mu units, not ${o.value.unit} units`,r);if(e.mode!=="math")throw new w(`LaTeX's ${t} works only in math mode`,r)}else if(l)throw new w(`LaTeX's ${t} doesn't support mu units`,r)}return{type:"kern",mode:e.mode,dimension:o.value}},mathmlBuilder(e,t){const r=le(e.dimension,t),n=r.unit==="em"?wr(r.number):"";if(e.mode==="text"&&n.length>0){const o=new p.TextNode(n);return new p.MathNode("mtext",[o])}else{const o=new p.MathNode("mspace");return o.setAttribute("width",r.number+r.unit),r.number<0&&(o.style.marginLeft=r.number+r.unit),o}}});const wr=function(e){return e>=.05555&&e<=.05556?" ":e>=.1666&&e<=.1667?" ":e>=.2222&&e<=.2223?" ":e>=.2777&&e<=.2778?"  ":""},yr=/[^A-Za-z_0-9-]/g;q({type:"label",names:["\\label"],props:{numArgs:1,argTypes:["raw"]},handler({parser:e},t){return{type:"label",mode:e.mode,string:t[0].string.replace(yr,"")}},mathmlBuilder(e,t){const r=new p.MathNode("mrow",[],["tml-label"]);return e.string.length>0&&r.setAttribute("id",e.string),r}});const Nn=["\\clap","\\llap","\\rlap"];q({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap","\\clap","\\llap","\\rlap"],props:{numArgs:1,allowedInText:!0},handler:({parser:e,funcName:t,token:r},n)=>{if(Nn.includes(t)){if(e.settings.strict&&e.mode!=="text")throw new w(`{${t}} can be used only in text mode.
 Try \\math${t.slice(1)}`,r);t=t.slice(1)}else t=t.slice(5);const o=n[0];return{type:"lap",mode:e.mode,alignment:t,body:o}},mathmlBuilder:(e,t)=>{let r;if(e.alignment==="llap"){const a=K(P(e.body),t),l=new p.MathNode("mphantom",a);r=new p.MathNode("mpadded",[l]),r.setAttribute("width","0px")}const n=E(e.body,t);let o;if(e.alignment==="llap"?(n.style.position="absolute",n.style.right="0",n.style.bottom="0",o=new p.MathNode("mpadded",[r,n])):o=new p.MathNode("mpadded",[n]),e.alignment==="rlap")e.body.body.length>0&&e.body.body[0].type==="genfrac"&&o.setAttribute("lspace","0.16667em");else{const a=e.alignment==="llap"?"-1":"-0.5";o.setAttribute("lspace",a+"width"),e.alignment==="llap"?o.style.position="relative":(o.style.display="flex",o.style.justifyContent="center")}return o.setAttribute("width","0px"),o}});q({type:"ordgroup",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler({funcName:e,parser:t},r){const n=t.mode;t.switchMode("math");const o=e==="\\("?"\\)":"$",a=t.parseExpression(!1,o);return t.expect(o),t.switchMode(n),{type:"ordgroup",mode:t.mode,body:a}}});q({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(e,t){throw new w(`Mismatched ${e.funcName}`,t)}});const Ln=(e,t)=>{switch(t.level){case G.DISPLAY:return e.display;case G.TEXT:return e.text;case G.SCRIPT:return e.script;case G.SCRIPTSCRIPT:return e.scriptscript;default:return e.text}};q({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:({parser:e},t)=>({type:"mathchoice",mode:e.mode,display:P(t[0]),text:P(t[1]),script:P(t[2]),scriptscript:P(t[3])}),mathmlBuilder:(e,t)=>{const r=Ln(e,t);return de(r,t)}});const En=["text","textord","mathord","atom"],fe=e=>{const t=new p.MathNode("mspace");return t.setAttribute("width",e+"em"),t};function vr(e,t){let r;const n=K(e.body,t);if(e.mclass==="minner")r=new p.MathNode("mpadded",n);else if(e.mclass==="mord")e.isCharacterBox||n[0].type==="mathord"?(r=n[0],r.type="mi",r.children.length===1&&r.children[0].text&&r.children[0].text==="∇"&&r.setAttribute("mathvariant","normal")):r=new p.MathNode("mi",n);else{r=new p.MathNode("mrow",n),e.mustPromote?(r=n[0],r.type="mo",e.isCharacterBox&&e.body[0].text&&/[A-Za-z]/.test(e.body[0].text)&&r.setAttribute("mathvariant","italic")):r=new p.MathNode("mrow",n);const o=t.level<2;r.type==="mrow"?o&&(e.mclass==="mbin"?(r.children.unshift(fe(.2222)),r.children.push(fe(.2222))):e.mclass==="mrel"?(r.children.unshift(fe(.2778)),r.children.push(fe(.2778))):e.mclass==="mpunct"?r.children.push(fe(.1667)):e.mclass==="minner"&&(r.children.unshift(fe(.0556)),r.children.push(fe(.0556)))):e.mclass==="mbin"?(r.attributes.lspace=o?"0.2222em":"0",r.attributes.rspace=o?"0.2222em":"0"):e.mclass==="mrel"?(r.attributes.lspace=o?"0.2778em":"0",r.attributes.rspace=o?"0.2778em":"0"):e.mclass==="mpunct"?(r.attributes.lspace="0em",r.attributes.rspace=o?"0.1667em":"0"):e.mclass==="mopen"||e.mclass==="mclose"?(r.attributes.lspace="0em",r.attributes.rspace="0em"):e.mclass==="minner"&&o&&(r.attributes.lspace="0.0556em",r.attributes.width="+0.1111em"),e.mclass==="mopen"||e.mclass==="mclose"||(delete r.attributes.stretchy,delete r.attributes.form)}return r}q({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler({parser:e,funcName:t},r){const n=r[0],o=L.isCharacterBox(n);let a=!0;const l={type:"mathord",text:"",mode:e.mode},u=n.body?n.body:[n];for(const h of u)if(En.includes(h.type))j[e.mode][h.text]?l.text+=j[e.mode][h.text].replace:h.text?l.text+=h.text:h.body&&h.body.map(g=>{l.text+=g.text});else{a=!1;break}return{type:"mclass",mode:e.mode,mclass:"m"+t.slice(5),body:P(a?l:n),isCharacterBox:o,mustPromote:a}},mathmlBuilder:vr});const zn=e=>{const t=e.type==="ordgroup"&&e.body.length?e.body[0]:e;return t.type==="atom"&&(t.family==="bin"||t.family==="rel")?"m"+t.family:"mord"};q({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler({parser:e},t){return{type:"mclass",mode:e.mode,mclass:zn(t[0]),body:P(t[1]),isCharacterBox:L.isCharacterBox(t[1])}}});q({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler({parser:e,funcName:t},r){const n=r[1],o=r[0],a={type:"op",mode:n.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,stack:!0,suppressBaseShift:t!=="\\stackrel",body:P(n)};return{type:"supsub",mode:o.mode,base:a,sup:t==="\\underset"?null:o,sub:t==="\\underset"?o:null}},mathmlBuilder:vr});const Fe=(e,t,r)=>{if(!e)return r;const n=E(e,t);return n.type==="mrow"&&n.children.length===0?r:n};q({type:"multiscript",names:["\\sideset","\\pres@cript"],props:{numArgs:3},handler({parser:e,funcName:t,token:r},n){if(n[2].body.length===0)throw new w(t+"cannot parse an empty base.");const o=n[2].body[0];if(e.settings.strict&&t==="\\sideset"&&!o.symbol)throw new w("The base of \\sideset must be a big operator. Try \\prescript.");if(n[0].body.length>0&&n[0].body[0].type!=="supsub"||n[1].body.length>0&&n[1].body[0].type!=="supsub")throw new w("\\sideset can parse only subscripts and superscripts in its first two arguments",r);const a=n[0].body.length>0?n[0].body[0]:null,l=n[1].body.length>0?n[1].body[0]:null;return!a&&!l?o:a?{type:"multiscript",mode:e.mode,isSideset:t==="\\sideset",prescripts:a,postscripts:l,base:o}:{type:"styling",mode:e.mode,scriptLevel:"text",body:[{type:"supsub",mode:e.mode,base:o,sup:l.sup,sub:l.sub}]}},mathmlBuilder(e,t){const r=E(e.base,t),n=new p.MathNode("mprescripts"),o=new p.MathNode("none");let a=[];const l=Fe(e.prescripts.sub,t,o),u=Fe(e.prescripts.sup,t,o);if(e.isSideset&&(l.setAttribute("style","text-align: left;"),u.setAttribute("style","text-align: left;")),e.postscripts){const h=Fe(e.postscripts.sub,t,o),g=Fe(e.postscripts.sup,t,o);a=[r,h,g,n,l,u]}else a=[r,n,l,u];return new p.MathNode("mmultiscripts",a)}});q({type:"not",names:["\\not"],props:{numArgs:1,primitive:!0,allowedInText:!1},handler({parser:e},t){const r=L.isCharacterBox(t[0]);let n;return r?(n=P(t[0]),n[0].text.charAt(0)==="\\"&&(n[0].text=j.math[n[0].text].replace),n[0].text=n[0].text.slice(0,1)+"̸"+n[0].text.slice(1)):n=[{type:"textord",mode:"math",text:"̸"},{type:"kern",mode:"math",dimension:{number:-.6,unit:"em"}},t[0]],{type:"not",mode:e.mode,body:n,isCharacterBox:r}},mathmlBuilder(e,t){return e.isCharacterBox?K(e.body,t,!0)[0]:de(e.body,t)}});const In=["textord","mathord","atom"],Fn=["\\smallint"],pt=["textord","mathord","ordgroup","close","leftright"],Ut=e=>{e.attributes.lspace="0.1667em",e.attributes.rspace="0.1667em"},Le=(e,t)=>{let r;if(e.symbol)r=new Y("mo",[Q(e.name,e.mode)]),Fn.includes(e.name)?r.setAttribute("largeop","false"):r.setAttribute("movablelimits","false"),e.fromMathOp&&Ut(r);else if(e.body)r=new Y("mo",K(e.body,t)),e.fromMathOp&&Ut(r);else if(r=new Y("mi",[new ar(e.name.slice(1))]),!e.parentIsSupSub){const n=new Y("mo",[Q("⁡","text")]),o=[r,n];if(e.needsLeadingSpace){const a=new Y("mspace");a.setAttribute("width","0.1667em"),o.unshift(a)}if(!e.isFollowedByDelimiter){const a=new Y("mspace");a.setAttribute("width","0.1667em"),o.push(a)}r=new Y("mrow",o)}return r},Pn={"∏":"\\prod","∐":"\\coprod","∑":"\\sum","⋀":"\\bigwedge","⋁":"\\bigvee","⋂":"\\bigcap","⋃":"\\bigcup","⨀":"\\bigodot","⨁":"\\bigoplus","⨂":"\\bigotimes","⨄":"\\biguplus","⨅":"\\bigsqcap","⨆":"\\bigsqcup","⨉":"\\bigtimes"};q({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcap","\\bigsqcup","\\bigtimes","\\smallint","∏","∐","∑","⋀","⋁","⋂","⋃","⨀","⨁","⨂","⨄","⨆"],props:{numArgs:0},handler:({parser:e,funcName:t},r)=>{let n=t;return n.length===1&&(n=Pn[n]),{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:!0,stack:!1,name:n}},mathmlBuilder:Le});q({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:({parser:e},t)=>{const r=t[0],n=r.body?r.body:[r],o=n.length===1&&In.includes(n[0].type);return{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:o,fromMathOp:!0,stack:!1,name:o?n[0].text:null,body:o?null:P(r)}},mathmlBuilder:Le});const Rn={"∫":"\\int","∬":"\\iint","∭":"\\iiint","∮":"\\oint","∯":"\\oiint","∰":"\\oiiint","∱":"\\intclockwise","∲":"\\varointclockwise","⨌":"\\iiiint","⨍":"\\intbar","⨎":"\\intBar","⨏":"\\fint","⨒":"\\rppolint","⨓":"\\scpolint","⨕":"\\pointint","⨖":"\\sqint","⨗":"\\intlarhk","⨘":"\\intx","⨙":"\\intcap","⨚":"\\intcup"};q({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\sgn","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler({parser:e,funcName:t}){const r=e.prevAtomType,n=e.gullet.future().text;return{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!1,stack:!1,isFollowedByDelimiter:Ye(n),needsLeadingSpace:r.length>0&&pt.includes(r),name:t}},mathmlBuilder:Le});q({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler({parser:e,funcName:t}){const r=e.prevAtomType,n=e.gullet.future().text;return{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:!1,stack:!1,isFollowedByDelimiter:Ye(n),needsLeadingSpace:r.length>0&&pt.includes(r),name:t}},mathmlBuilder:Le});q({type:"op",names:["\\int","\\iint","\\iiint","\\iiiint","\\oint","\\oiint","\\oiiint","\\intclockwise","\\varointclockwise","\\intbar","\\intBar","\\fint","\\rppolint","\\scpolint","\\pointint","\\sqint","\\intlarhk","\\intx","\\intcap","\\intcup","∫","∬","∭","∮","∯","∰","∱","∲","⨌","⨍","⨎","⨏","⨒","⨓","⨕","⨖","⨗","⨘","⨙","⨚"],props:{numArgs:0},handler({parser:e,funcName:t}){let r=t;return r.length===1&&(r=Rn[r]),{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!0,stack:!1,name:r}},mathmlBuilder:Le});const kr={};function c(e,t){kr[e]=t}const Gn=(e,t)=>{let r=K(e.body,t.withFont("mathrm")),n=!0;for(let a=0;a<r.length;a++){let l=r[a];if(l instanceof p.MathNode)switch(l.type==="mrow"&&l.children.length===1&&l.children[0]instanceof p.MathNode&&(l=l.children[0]),l.type){case"mi":case"mn":case"ms":case"mtext":break;case"mspace":if(l.attributes.width){const u=l.attributes.width.replace("em",""),h=wr(Number(u));h===""?n=!1:r[a]=new p.MathNode("mtext",[new p.TextNode(h)])}break;case"mo":{const u=l.children[0];l.children.length===1&&u instanceof p.TextNode?u.text=u.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):n=!1;break}default:n=!1}else n=!1}if(n){const a=r.map(l=>l.toText()).join("");r=[new p.TextNode(a)]}else if(r.length===1&&["mover","munder"].includes(r[0].type)&&(r[0].children[0].type==="mi"||r[0].children[0].type==="mtext")){if(r[0].children[0].type="mi",e.parentIsSupSub)return new p.MathNode("mrow",r);{const a=new p.MathNode("mo",[Q("⁡","text")]);return p.newDocumentFragment([r[0],a])}}let o;if(n?(o=new p.MathNode("mi",r),r[0].text.length===1&&o.setAttribute("mathvariant","normal")):o=new p.MathNode("mrow",r),!e.parentIsSupSub){const a=new p.MathNode("mo",[Q("⁡","text")]),l=[o,a];if(e.needsLeadingSpace){const u=new p.MathNode("mspace");u.setAttribute("width","0.1667em"),l.unshift(u)}if(!e.isFollowedByDelimiter){const u=new p.MathNode("mspace");u.setAttribute("width","0.1667em"),l.push(u)}return p.newDocumentFragment(l)}return o};q({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1,allowedInArgument:!0},handler:({parser:e,funcName:t},r)=>{const n=r[0],o=e.prevAtomType,a=e.gullet.future().text;return{type:"operatorname",mode:e.mode,body:P(n),alwaysHandleSupSub:t==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1,isFollowedByDelimiter:Ye(a),needsLeadingSpace:o.length>0&&pt.includes(o)}},mathmlBuilder:Gn});c("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@");xe({type:"ordgroup",mathmlBuilder(e,t){return de(e.body,t,e.semisimple)}});q({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:({parser:e},t)=>{const r=t[0];return{type:"phantom",mode:e.mode,body:P(r)}},mathmlBuilder:(e,t)=>{const r=K(e.body,t);return new p.MathNode("mphantom",r)}});q({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:({parser:e},t)=>{const r=t[0];return{type:"hphantom",mode:e.mode,body:r}},mathmlBuilder:(e,t)=>{const r=K(P(e.body),t),n=new p.MathNode("mphantom",r),o=new p.MathNode("mpadded",[n]);return o.setAttribute("height","0px"),o.setAttribute("depth","0px"),o}});q({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:({parser:e},t)=>{const r=t[0];return{type:"vphantom",mode:e.mode,body:r}},mathmlBuilder:(e,t)=>{const r=K(P(e.body),t),n=new p.MathNode("mphantom",r),o=new p.MathNode("mpadded",[n]);return o.setAttribute("width","0px"),o}});q({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler({parser:e},t){return{type:"pmb",mode:e.mode,body:P(t[0])}},mathmlBuilder(e,t){const r=K(e.body,t),n=ut(r);return n.setAttribute("style","font-weight:bold"),n}});const Sr=(e,t)=>{const r=t.withLevel(G.TEXT),n=new p.MathNode("mpadded",[E(e.body,r)]),o=le(e.dy,t);return n.setAttribute("voffset",o.number+o.unit),o.number>0?n.style.padding=o.number+o.unit+" 0 0 0":n.style.padding="0 0 "+Math.abs(o.number)+o.unit+" 0",n};q({type:"raise",names:["\\raise","\\lower"],props:{numArgs:2,argTypes:["size","primitive"],primitive:!0},handler({parser:e,funcName:t},r){const n=O(r[0],"size").value;t==="\\lower"&&(n.number*=-1);const o=r[1];return{type:"raise",mode:e.mode,dy:n,body:o}},mathmlBuilder:Sr});q({type:"raise",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler({parser:e,funcName:t},r){const n=O(r[0],"size").value,o=r[1];return{type:"raise",mode:e.mode,dy:n,body:o}},mathmlBuilder:Sr});q({type:"ref",names:["\\ref","\\eqref"],props:{numArgs:1,argTypes:["raw"]},handler({parser:e,funcName:t},r){return{type:"ref",mode:e.mode,funcName:t,string:r[0].string.replace(yr,"")}},mathmlBuilder(e,t){const r=e.funcName==="\\ref"?["tml-ref"]:["tml-ref","tml-eqref"],n=new p.MathNode("mtext",[new p.TextNode("")],r);return n.setAttribute("href","#"+e.string),n}});q({type:"reflect",names:["\\reflectbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler({parser:e},t){return{type:"reflect",mode:e.mode,body:t[0]}},mathmlBuilder(e,t){const r=E(e.body,t);return r.style.transform="scaleX(-1)",r}});q({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0},handler({parser:e}){return{type:"internal",mode:e.mode}}});q({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,argTypes:["size","size","size"]},handler({parser:e},t,r){const n=r[0],o=O(t[0],"size"),a=O(t[1],"size");return{type:"rule",mode:e.mode,shift:n&&O(n,"size").value,width:o.value,height:a.value}},mathmlBuilder(e,t){const r=le(e.width,t),n=le(e.height,t),o=e.shift?le(e.shift,t):{number:0,unit:"em"},a=t.color&&t.getColor()||"black",l=new p.MathNode("mspace");if(r.number>0&&n.number>0&&l.setAttribute("mathbackground",a),l.setAttribute("width",r.number+r.unit),l.setAttribute("height",n.number+n.unit),o.number===0)return l;const u=new p.MathNode("mpadded",[l]);return o.number>=0?u.setAttribute("height","+"+o.number+o.unit):(u.setAttribute("height",o.number+o.unit),u.setAttribute("depth","+"+-o.number+o.unit)),u.setAttribute("voffset",o.number+o.unit),u}});const Vt={"\\tiny":.5,"\\sixptsize":.6,"\\Tiny":.6,"\\scriptsize":.7,"\\footnotesize":.8,"\\small":.9,"\\normalsize":1,"\\large":1.2,"\\Large":1.44,"\\LARGE":1.728,"\\huge":2.074,"\\Huge":2.488};q({type:"sizing",names:["\\tiny","\\sixptsize","\\Tiny","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],props:{numArgs:0,allowedInText:!0},handler:({breakOnTokenText:e,funcName:t,parser:r},n)=>{r.settings.strict&&r.mode==="math"&&console.log(`Temml strict-mode warning: Command ${t} is invalid in math mode.`);const o=r.parseExpression(!1,e,!0);return{type:"sizing",mode:r.mode,funcName:t,body:o}},mathmlBuilder:(e,t)=>{const r=t.withFontSize(Vt[e.funcName]),n=K(e.body,r),o=ut(n),a=(Vt[e.funcName]/t.fontSize).toFixed(4);return o.setAttribute("mathsize",a+"em"),o}});q({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:({parser:e},t,r)=>{let n=!1,o=!1;const a=r[0]&&O(r[0],"ordgroup");if(a){let u="";for(let h=0;h<a.body.length;++h)if(u=a.body[h].text,u==="t")n=!0;else if(u==="b")o=!0;else{n=!1,o=!1;break}}else n=!0,o=!0;const l=t[0];return{type:"smash",mode:e.mode,body:l,smashHeight:n,smashDepth:o}},mathmlBuilder:(e,t)=>{const r=new p.MathNode("mpadded",[E(e.body,t)]);return e.smashHeight&&r.setAttribute("height","0px"),e.smashDepth&&r.setAttribute("depth","0px"),r}});q({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler({parser:e},t,r){const n=r[0],o=t[0];return{type:"sqrt",mode:e.mode,body:o,index:n}},mathmlBuilder(e,t){const{body:r,index:n}=e;return n?new p.MathNode("mroot",[E(r,t),E(n,t.incrementLevel())]):new p.MathNode("msqrt",[E(r,t)])}});const jn={display:0,text:1,script:2,scriptscript:3},Un={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]};q({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler({breakOnTokenText:e,funcName:t,parser:r},n){const o=r.parseExpression(!0,e,!0),a=t.slice(1,t.length-5);return{type:"styling",mode:r.mode,scriptLevel:a,body:o}},mathmlBuilder(e,t){const r=t.withLevel(jn[e.scriptLevel]),n=K(e.body,r),o=ut(n),a=Un[e.scriptLevel];return o.setAttribute("scriptlevel",a[0]),o.setAttribute("displaystyle",a[1]),o}});const Vn=/^m(over|under|underover)$/;xe({type:"supsub",mathmlBuilder(e,t){let r=!1,n,o,a=!1,l=!1,u=!1;e.base&&e.base.type==="horizBrace"&&(o=!!e.sup,o===e.base.isOver&&(r=!0,n=e.base.isOver)),e.base&&!e.base.stack&&(e.base.type==="op"||e.base.type==="operatorname")&&(e.base.parentIsSupSub=!0,a=!e.base.symbol,l=a&&!e.isFollowedByDelimiter,u=e.base.needsLeadingSpace);const h=e.base&&e.base.stack?[E(e.base.body[0],t)]:[E(e.base,t)],g=t.inSubOrSup();if(e.sub&&h.push(E(e.sub,g)),e.sup){const b=E(e.sup,g),A=b.type==="mrow"?b.children[0]:b;A.type==="mo"&&A.classes.includes("tml-prime")&&e.base&&e.base.text&&e.base.text==="f"&&A.classes.push("prime-pad"),h.push(b)}let y;if(r)y=n?"mover":"munder";else if(e.sub)if(e.sup){const b=e.base;b&&(b.type==="op"&&b.limits||b.type==="multiscript")&&(t.level===G.DISPLAY||b.alwaysHandleSupSub)||b&&b.type==="operatorname"&&b.alwaysHandleSupSub&&(t.level===G.DISPLAY||b.limits)?y="munderover":y="msubsup"}else{const b=e.base;b&&b.type==="op"&&b.limits&&(t.level===G.DISPLAY||b.alwaysHandleSupSub)||b&&b.type==="operatorname"&&b.alwaysHandleSupSub&&(b.limits||t.level===G.DISPLAY)?y="munder":y="msub"}else{const b=e.base;b&&b.type==="op"&&b.limits&&(t.level===G.DISPLAY||b.alwaysHandleSupSub)||b&&b.type==="operatorname"&&b.alwaysHandleSupSub&&(b.limits||t.level===G.DISPLAY)?y="mover":y="msup"}let _=new p.MathNode(y,h);if(a){const b=new p.MathNode("mo",[Q("⁡","text")]);if(u){const A=new p.MathNode("mspace");A.setAttribute("width","0.1667em"),_=p.newDocumentFragment([A,_,b])}else _=p.newDocumentFragment([_,b]);if(l){const A=new p.MathNode("mspace");A.setAttribute("width","0.1667em"),_.children.push(A)}}else Vn.test(y)&&(_=new p.MathNode("mrow",[_]));return _}});const Wn=["\\shortmid","\\nshortmid","\\shortparallel","\\nshortparallel","\\smallsetminus"],Hn=["\\Rsh","\\Lsh","\\restriction"],Zn=e=>{if(e.length===1){const t=e.codePointAt(0);return 8591<t&&t<8704}return e.indexOf("arrow")>-1||e.indexOf("harpoon")>-1||Hn.includes(e)};xe({type:"atom",mathmlBuilder(e,t){const r=new p.MathNode("mo",[Q(e.text,e.mode)]);return e.family==="punct"?r.setAttribute("separator","true"):e.family==="open"||e.family==="close"?e.family==="open"?(r.setAttribute("form","prefix"),r.setAttribute("stretchy","false")):e.family==="close"&&(r.setAttribute("form","postfix"),r.setAttribute("stretchy","false")):e.text==="\\mid"?(r.setAttribute("lspace","0.22em"),r.setAttribute("rspace","0.22em"),r.setAttribute("stretchy","false")):e.family==="rel"&&Zn(e.text)?r.setAttribute("stretchy","false"):Wn.includes(e.text)?r.setAttribute("mathsize","70%"):e.text===":"&&(r.attributes.lspace="0.2222em",r.attributes.rspace="0.2222em"),r}});const Wt={mathbf:"bold",mathrm:"normal",textit:"italic",mathit:"italic",mathnormal:"italic",mathbb:"double-struck",mathcal:"script",mathfrak:"fraktur",mathscr:"script",mathsf:"sans-serif",mathtt:"monospace"},Ar=function(e,t){if(t.fontFamily==="texttt")return"monospace";if(t.fontFamily==="textsc")return"normal";if(t.fontFamily==="textsf")return t.fontShape==="textit"&&t.fontWeight==="textbf"?"sans-serif-bold-italic":t.fontShape==="textit"?"sans-serif-italic":t.fontWeight==="textbf"?"sans-serif-bold":"sans-serif";if(t.fontShape==="textit"&&t.fontWeight==="textbf")return"bold-italic";if(t.fontShape==="textit")return"italic";if(t.fontWeight==="textbf")return"bold";const r=t.font;if(!r||r==="mathnormal")return null;const n=e.mode;switch(r){case"mathit":return"italic";case"mathrm":{const a=e.text.codePointAt(0);return 939<a&&a<975?"italic":"normal"}case"greekItalic":return"italic";case"up@greek":return"normal";case"boldsymbol":case"mathboldsymbol":return"bold-italic";case"mathbf":return"bold";case"mathbb":return"double-struck";case"mathfrak":return"fraktur";case"mathscr":case"mathcal":return"script";case"mathsf":return"sans-serif";case"mathtt":return"monospace"}let o=e.text;return j[n][o]&&j[n][o].replace&&(o=j[n][o].replace),Object.prototype.hasOwnProperty.call(Wt,r)?Wt[r]:null},Ht=Object.freeze({B:8426,E:8427,F:8427,H:8387,I:8391,L:8390,M:8422,R:8393,e:8394,g:8355,o:8389}),Xn=Object.freeze({C:8426,H:8388,I:8392,R:8394,Z:8398}),Yn=Object.freeze({C:8383,H:8389,N:8391,P:8393,Q:8393,R:8395,Z:8394}),_r=Object.freeze({"ϵ":119527,ϑ:119564,ϰ:119534,φ:119577,ϱ:119535,ϖ:119563}),Kn=Object.freeze({"ϵ":119643,ϑ:119680,ϰ:119650,φ:119693,ϱ:119651,ϖ:119679}),Zt=Object.freeze({"ϵ":119701,ϑ:119738,ϰ:119708,φ:119751,ϱ:119709,ϖ:119737}),Jn=Object.freeze({"ϵ":119759,ϑ:119796,ϰ:119766,φ:119809,ϱ:119767,ϖ:119795}),Qn=Object.freeze({upperCaseLatin:{normal:e=>0,bold:e=>119743,italic:e=>119795,"bold-italic":e=>119847,script:e=>Ht[e]||119899,"script-bold":e=>119951,fraktur:e=>Xn[e]||120003,"fraktur-bold":e=>120107,"double-struck":e=>Yn[e]||120055,"sans-serif":e=>120159,"sans-serif-bold":e=>120211,"sans-serif-italic":e=>120263,"sans-serif-bold-italic":e=>120380,monospace:e=>120367},lowerCaseLatin:{normal:e=>0,bold:e=>119737,italic:e=>e==="h"?8358:119789,"bold-italic":e=>119841,script:e=>Ht[e]||119893,"script-bold":e=>119945,fraktur:e=>119997,"fraktur-bold":e=>120101,"double-struck":e=>120049,"sans-serif":e=>120153,"sans-serif-bold":e=>120205,"sans-serif-italic":e=>120257,"sans-serif-bold-italic":e=>120309,monospace:e=>120361},upperCaseGreek:{normal:e=>0,bold:e=>119575,italic:e=>119633,"bold-italic":e=>119575,script:e=>0,"script-bold":e=>0,fraktur:e=>0,"fraktur-bold":e=>0,"double-struck":e=>0,"sans-serif":e=>119749,"sans-serif-bold":e=>119749,"sans-serif-italic":e=>0,"sans-serif-bold-italic":e=>119807,monospace:e=>0},lowerCaseGreek:{normal:e=>0,bold:e=>119569,italic:e=>119627,"bold-italic":e=>e==="ϕ"?119678:119685,script:e=>0,"script-bold":e=>0,fraktur:e=>0,"fraktur-bold":e=>0,"double-struck":e=>0,"sans-serif":e=>119743,"sans-serif-bold":e=>119743,"sans-serif-italic":e=>0,"sans-serif-bold-italic":e=>119801,monospace:e=>0},varGreek:{normal:e=>0,bold:e=>_r[e]||-51,italic:e=>0,"bold-italic":e=>Kn[e]||58,script:e=>0,"script-bold":e=>0,fraktur:e=>0,"fraktur-bold":e=>0,"double-struck":e=>0,"sans-serif":e=>Zt[e]||116,"sans-serif-bold":e=>Zt[e]||116,"sans-serif-italic":e=>0,"sans-serif-bold-italic":e=>Jn[e]||174,monospace:e=>0},numeral:{normal:e=>0,bold:e=>120734,italic:e=>0,"bold-italic":e=>0,script:e=>0,"script-bold":e=>0,fraktur:e=>0,"fraktur-bold":e=>0,"double-struck":e=>120744,"sans-serif":e=>120754,"sans-serif-bold":e=>120764,"sans-serif-italic":e=>0,"sans-serif-bold-italic":e=>0,monospace:e=>120774}}),$e=(e,t)=>{const r=e.codePointAt(0),n=64<r&&r<91?"upperCaseLatin":96<r&&r<123?"lowerCaseLatin":912<r&&r<938?"upperCaseGreek":944<r&&r<970||e==="ϕ"?"lowerCaseGreek":120545<r&&r<120572||_r[e]?"varGreek":47<r&&r<58?"numeral":"other";return n==="other"?e:String.fromCodePoint(r+Qn[n][t](e))},eo=Object.freeze({a:"ᴀ",b:"ʙ",c:"ᴄ",d:"ᴅ",e:"ᴇ",f:"ꜰ",g:"ɢ",h:"ʜ",i:"ɪ",j:"ᴊ",k:"ᴋ",l:"ʟ",m:"ᴍ",n:"ɴ",o:"ᴏ",p:"ᴘ",q:"ǫ",r:"ʀ",s:"s",t:"ᴛ",u:"ᴜ",v:"ᴠ",w:"ᴡ",x:"x",y:"ʏ",z:"ᴢ"}),to=/^\d(?:[\d,.]*\d)?$/,ro=/[A-Ba-z]/,no=new Set(["\\prime","\\dprime","\\trprime","\\qprime","\\backprime","\\backdprime","\\backtrprime"]),oo=(e,t,r)=>{const n=new p.MathNode(r,[e]),o=new p.MathNode("mstyle",[n]);return o.style["font-style"]="italic",o.style["font-family"]="Cambria, 'Times New Roman', serif",t==="bold-italic"&&(o.style["font-weight"]="bold"),o};xe({type:"mathord",mathmlBuilder(e,t){const r=Q(e.text,e.mode,t),n=r.text.codePointAt(0),o=912<n&&n<938?"normal":"italic",a=Ar(e,t)||o;if(a==="script")return r.text=$e(r.text,a),new p.MathNode("mi",[r],[t.font]);a!=="italic"&&(r.text=$e(r.text,a));let l=new p.MathNode("mi",[r]);return a==="normal"&&(l.setAttribute("mathvariant","normal"),r.text.length===1&&(l=new p.MathNode("mrow",[l]))),l}});xe({type:"textord",mathmlBuilder(e,t){let r=e.text;const n=r.codePointAt(0);t.fontFamily==="textsc"&&96<n&&n<123&&(r=eo[r]);const o=Q(r,e.mode,t),a=Ar(e,t)||"normal";let l;if(to.test(e.text)){const u=e.mode==="text"?"mtext":"mn";if(a==="italic"||a==="bold-italic")return oo(o,a,u);a!=="normal"&&(o.text=o.text.split("").map(h=>$e(h,a)).join("")),l=new p.MathNode(u,[o])}else if(e.mode==="text")a!=="normal"&&(o.text=$e(o.text,a)),l=new p.MathNode("mtext",[o]);else if(no.has(e.text))l=new p.MathNode("mo",[o]),l.classes.push("tml-prime");else{const u=o.text;a!=="italic"&&(o.text=$e(o.text,a)),l=new p.MathNode("mi",[o]),o.text===u&&ro.test(u)&&l.setAttribute("mathvariant","italic")}return l}});const so={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},io={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};xe({type:"spacing",mathmlBuilder(e,t){let r;if(Object.prototype.hasOwnProperty.call(io,e.text))r=new p.MathNode("mtext",[new p.TextNode(" ")]);else if(Object.prototype.hasOwnProperty.call(so,e.text))r=new p.MathNode("mo"),e.text==="\\nobreak"&&r.setAttribute("linebreak","nobreak");else throw new w(`Unknown type of space "${e.text}"`);return r}});xe({type:"tag"});const Xt={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm","\\textsc":"textsc"},Yt={"\\textbf":"textbf","\\textmd":"textmd"},ao={"\\textit":"textit","\\textup":"textup"},lo=(e,t)=>{const r=e.font;return r?Xt[r]?t.withTextFontFamily(Xt[r]):Yt[r]?t.withTextFontWeight(Yt[r]):t.withTextFontShape(ao[r]):t};q({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textsc","\\textbf","\\textmd","\\textit","\\textup"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler({parser:e,funcName:t},r){const n=r[0];return{type:"text",mode:e.mode,body:P(n),font:t}},mathmlBuilder(e,t){const r=lo(e,t),n=de(e.body,r);return ct(n)}});q({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(e,t,r){throw new w("\\verb ended by end of line instead of matching delimiter")},mathmlBuilder(e,t){const r=new p.TextNode(uo(e)),n=new p.MathNode("mtext",[r]);return n.setAttribute("mathvariant","monospace"),n}});const uo=e=>e.body.replace(/ /g,e.star?"␣":" "),ge=sr;class J{constructor(t,r,n){this.lexer=t,this.start=r,this.end=n}static range(t,r){return r?!t||!t.loc||!r.loc||t.loc.lexer!==r.loc.lexer?null:new J(t.loc.lexer,t.loc.start,r.loc.end):t&&t.loc}}class se{constructor(t,r){this.text=t,this.loc=r}range(t,r){return new se(r,J.range(this,t))}}const qr=`[ \r
	]`,co="\\\\[a-zA-Z@]+",mo="\\\\[^\uD800-\uDFFF]",ho=`(${co})${qr}*`,po=`\\\\(
|[ \r	]+
?)[ \r	]*`,it="[̀-ͯ]",fo=new RegExp(`${it}+$`),go=`(${qr}+)|${po}|([!-\\[\\]-‧‪-퟿豈-￿]${it}*|[\uD800-\uDBFF][\uDC00-\uDFFF]${it}*|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5|${ho}|${mo})`;class Kt{constructor(t,r){this.input=t,this.settings=r,this.tokenRegex=new RegExp(go,"g"),this.catcodes={"%":14,"~":13}}setCatcode(t,r){this.catcodes[t]=r}lex(){const t=this.input,r=this.tokenRegex.lastIndex;if(r===t.length)return new se("EOF",new J(this,r,r));const n=this.tokenRegex.exec(t);if(n===null||n.index!==r)throw new w(`Unexpected character: '${t[r]}'`,new se(t[r],new J(this,r,r+1)));const o=n[6]||n[3]||(n[2]?"\\ ":" ");if(this.catcodes[o]===14){const a=t.indexOf(`
`,this.tokenRegex.lastIndex);if(a===-1){if(this.tokenRegex.lastIndex=t.length,this.settings.strict)throw new w("% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode")}else this.tokenRegex.lastIndex=a+1;return this.lex()}return new se(o,new J(this,r,this.tokenRegex.lastIndex))}}class bo{constructor(t={},r={}){this.current=r,this.builtins=t,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(this.undefStack.length===0)throw new w("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");const t=this.undefStack.pop();for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(t[r]===void 0?delete this.current[r]:this.current[r]=t[r])}has(t){return Object.prototype.hasOwnProperty.call(this.current,t)||Object.prototype.hasOwnProperty.call(this.builtins,t)}get(t){return Object.prototype.hasOwnProperty.call(this.current,t)?this.current[t]:this.builtins[t]}set(t,r,n=!1){if(n){for(let o=0;o<this.undefStack.length;o++)delete this.undefStack[o][t];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][t]=r)}else{const o=this.undefStack[this.undefStack.length-1];o&&!Object.prototype.hasOwnProperty.call(o,t)&&(o[t]=this.current[t])}this.current[t]=r}}const xo=kr;c("\\noexpand",function(e){const t=e.popToken();return e.isExpandable(t.text)&&(t.noexpand=!0,t.treatAsRelax=!0),{tokens:[t],numArgs:0}});c("\\expandafter",function(e){const t=e.popToken();return e.expandOnce(!0),{tokens:[t],numArgs:0}});c("\\@firstoftwo",function(e){return{tokens:e.consumeArgs(2)[0],numArgs:0}});c("\\@secondoftwo",function(e){return{tokens:e.consumeArgs(2)[1],numArgs:0}});c("\\@ifnextchar",function(e){const t=e.consumeArgs(3);e.consumeSpaces();const r=e.future();return t[0].length===1&&t[0][0].text===r.text?{tokens:t[1],numArgs:0}:{tokens:t[2],numArgs:0}});c("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}");c("\\TextOrMath",function(e){const t=e.consumeArgs(2);return e.mode==="text"?{tokens:t[0],numArgs:0}:{tokens:t[1],numArgs:0}});const wo=e=>{let t="";for(let r=e.length-1;r>-1;r--)t+=e[r].text;return t},ft={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15},Jt=e=>{const t=e.future().text;return t==="EOF"?[null,""]:[ft[t.charAt(0)],t]},Qt=(e,t,r)=>{for(let n=1;n<t.length;n++){const o=ft[t.charAt(n)];e*=r,e+=o}return e};c("\\char",function(e){let t=e.popToken(),r,n="";if(t.text==="'")r=8,t=e.popToken();else if(t.text==='"')r=16,t=e.popToken();else if(t.text==="`")if(t=e.popToken(),t.text[0]==="\\")n=t.text.charCodeAt(1);else{if(t.text==="EOF")throw new w("\\char` missing argument");n=t.text.charCodeAt(0)}else r=10;if(r){let o=t.text;if(n=ft[o.charAt(0)],n==null||n>=r)throw new w(`Invalid base-${r} digit ${t.text}`);n=Qt(n,o,r);let a;for([a,o]=Jt(e);a!=null&&a<r;)n*=r,n+=a,n=Qt(n,o,r),e.popToken(),[a,o]=Jt(e)}return`\\@char{${n}}`});function gt(e){const t=e.consumeArgs(1)[0];let r="",n=t[t.length-1].loc.start;for(let o=t.length-1;o>=0;o--){const a=t[o].loc.start;a>n&&(r+=" ",n=a),r+=t[o].text,n+=t[o].text.length}return r}c("\\surd","\\sqrt{\\vphantom{|}}");c("⊕","\\oplus");c("\\long","");c("\\bgroup","{");c("\\egroup","}");c("~","\\nobreakspace");c("\\lq","`");c("\\rq","'");c("\\aa","\\r a");c("\\Bbbk","\\Bbb{k}");c("\\mathstrut","\\vphantom{(}");c("\\underbar","\\underline{\\text{#1}}");c("\\vdots","{\\varvdots\\rule{0pt}{15pt}}");c("⋮","\\vdots");c("\\substack","\\begin{subarray}{c}#1\\end{subarray}");c("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;");c("\\implies","\\DOTSB\\;\\Longrightarrow\\;");c("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");const er={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcap":"\\dotsb","\\bigsqcup":"\\dotsb","\\bigtimes":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};c("\\dots",function(e){let t="\\dotso";const r=e.expandAfterFuture().text;return r in er?t=er[r]:(r.slice(0,4)==="\\not"||r in j.math&&["bin","rel"].includes(j.math[r].group))&&(t="\\dotsb"),t});const bt={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};c("\\dotso",function(e){return e.future().text in bt?"\\ldots\\,":"\\ldots"});c("\\dotsc",function(e){const t=e.future().text;return t in bt&&t!==","?"\\ldots\\,":"\\ldots"});c("\\cdots",function(e){return e.future().text in bt?"\\@cdots\\,":"\\@cdots"});c("\\dotsb","\\cdots");c("\\dotsm","\\cdots");c("\\dotsi","\\!\\cdots");c("\\idotsint","\\dotsi");c("\\dotsx","\\ldots\\,");c("\\DOTSI","\\relax");c("\\DOTSB","\\relax");c("\\DOTSX","\\relax");c("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax");c("\\,","{\\tmspace+{3mu}{.1667em}}");c("\\thinspace","\\,");c("\\>","\\mskip{4mu}");c("\\:","{\\tmspace+{4mu}{.2222em}}");c("\\medspace","\\:");c("\\;","{\\tmspace+{5mu}{.2777em}}");c("\\thickspace","\\;");c("\\!","{\\tmspace-{3mu}{.1667em}}");c("\\negthinspace","\\!");c("\\negmedspace","{\\tmspace-{4mu}{.2222em}}");c("\\negthickspace","{\\tmspace-{5mu}{.277em}}");c("\\enspace","\\kern.5em ");c("\\enskip","\\hskip.5em\\relax");c("\\quad","\\hskip1em\\relax");c("\\qquad","\\hskip2em\\relax");c("\\AA","\\TextOrMath{\\Angstrom}{\\mathring{A}}\\relax");c("\\tag","\\@ifstar\\tag@literal\\tag@paren");c("\\tag@paren","\\tag@literal{({#1})}");c("\\tag@literal",e=>{if(e.macros.get("\\df@tag"))throw new w("Multiple \\tag");return"\\def\\df@tag{\\text{#1}}"});c("\\bmod","\\mathbin{\\text{mod}}");c("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)");c("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}");c("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1");c("\\newline","\\\\\\relax");c("\\TeX","\\textrm{T}\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125em\\textrm{X}");c("\\LaTeX","\\textrm{L}\\kern-.35em\\raisebox{0.2em}{\\scriptstyle A}\\kern-.15em\\TeX");c("\\Temml","\\textrm{T}\\kern-0.2em\\lower{0.2em}{\\textrm{E}}\\kern-0.08em{\\textrm{M}\\kern-0.08em\\raise{0.2em}\\textrm{M}\\kern-0.08em\\textrm{L}}");c("\\hspace","\\@ifstar\\@hspacer\\@hspace");c("\\@hspace","\\hskip #1\\relax");c("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax");c("\\colon",'\\mathpunct{\\char"3a}');c("\\prescript","\\pres@cript{_{#1}^{#2}}{}{#3}");c("\\ordinarycolon",'\\char"3a');c("\\vcentcolon","\\mathrel{\\raisebox{0.035em}{\\ordinarycolon}}");c("\\coloneq",'\\mathrel{\\raisebox{0.035em}{\\ordinarycolon}\\char"2212}');c("\\Coloneq",'\\mathrel{\\char"2237\\char"2212}');c("\\Eqqcolon",'\\mathrel{\\char"3d\\char"2237}');c("\\Eqcolon",'\\mathrel{\\char"2212\\char"2237}');c("\\colonapprox",'\\mathrel{\\raisebox{0.035em}{\\ordinarycolon}\\char"2248}');c("\\Colonapprox",'\\mathrel{\\char"2237\\char"2248}');c("\\colonsim",'\\mathrel{\\raisebox{0.035em}{\\ordinarycolon}\\char"223c}');c("\\Colonsim",'\\mathrel{\\raisebox{0.035em}{\\ordinarycolon}\\char"223c}');c("\\ratio","\\vcentcolon");c("\\coloncolon","\\dblcolon");c("\\colonequals","\\coloneqq");c("\\coloncolonequals","\\Coloneqq");c("\\equalscolon","\\eqqcolon");c("\\equalscoloncolon","\\Eqqcolon");c("\\colonminus","\\coloneq");c("\\coloncolonminus","\\Coloneq");c("\\minuscolon","\\eqcolon");c("\\minuscoloncolon","\\Eqcolon");c("\\coloncolonapprox","\\Colonapprox");c("\\coloncolonsim","\\Colonsim");c("\\notni","\\mathrel{\\char`∌}");c("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}");c("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}");c("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}");c("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}");c("\\varlimsup","\\DOTSB\\operatorname*{\\overline{\\text{lim}}}");c("\\varliminf","\\DOTSB\\operatorname*{\\underline{\\text{lim}}}");c("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{\\text{lim}}}");c("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{\\text{lim}}}");c("\\centerdot","{\\medspace\\rule{0.167em}{0.189em}\\medspace}");c("\\argmin","\\DOTSB\\operatorname*{arg\\,min}");c("\\argmax","\\DOTSB\\operatorname*{arg\\,max}");c("\\plim","\\DOTSB\\operatorname*{plim}");c("\\leftmodels","\\mathop{\\reflectbox{$\\models$}}");c("\\bra","\\mathinner{\\langle{#1}|}");c("\\ket","\\mathinner{|{#1}\\rangle}");c("\\braket","\\mathinner{\\langle{#1}\\rangle}");c("\\Bra","\\left\\langle#1\\right|");c("\\Ket","\\left|#1\\right\\rangle");const Tr=(e,t)=>{const n=`}\\,\\middle${t[0]==="|"?"\\vert":"\\Vert"}\\,{`;return e.slice(0,t.index)+n+e.slice(t.index+t[0].length)};c("\\Braket",function(e){let t=gt(e);const r=/\|\||\||\\\|/g;let n;for(;(n=r.exec(t))!==null;)t=Tr(t,n);return"\\left\\langle{"+t+"}\\right\\rangle"});c("\\Set",function(e){let t=gt(e);const r=/\|\||\||\\\|/.exec(t);return r&&(t=Tr(t,r)),"\\left\\{\\:{"+t+"}\\:\\right\\}"});c("\\set",function(e){return"\\{{"+gt(e).replace(/\|/,"}\\mid{")+"}\\}"});c("\\angln","{\\angl n}");c("\\odv","\\@ifstar\\odv@next\\odv@numerator");c("\\odv@numerator","\\frac{\\mathrm{d}#1}{\\mathrm{d}#2}");c("\\odv@next","\\frac{\\mathrm{d}}{\\mathrm{d}#2}#1");c("\\pdv","\\@ifstar\\pdv@next\\pdv@numerator");const $r=e=>{const t=e[0][0].text,r=wo(e[1]).split(","),n=String(r.length),o=n==="1"?"\\partial":`\\partial^${n}`;let a="";return r.map(l=>{a+="\\partial "+l.trim()+"\\,"}),[t,o,a.replace(/\\,$/,"")]};c("\\pdv@numerator",function(e){const[t,r,n]=$r(e.consumeArgs(2));return`\\frac{${r} ${t}}{${n}}`});c("\\pdv@next",function(e){const[t,r,n]=$r(e.consumeArgs(2));return`\\frac{${r}}{${n}} ${t}`});c("\\upalpha","\\up@greek{\\alpha}");c("\\upbeta","\\up@greek{\\beta}");c("\\upgamma","\\up@greek{\\gamma}");c("\\updelta","\\up@greek{\\delta}");c("\\upepsilon","\\up@greek{\\epsilon}");c("\\upzeta","\\up@greek{\\zeta}");c("\\upeta","\\up@greek{\\eta}");c("\\uptheta","\\up@greek{\\theta}");c("\\upiota","\\up@greek{\\iota}");c("\\upkappa","\\up@greek{\\kappa}");c("\\uplambda","\\up@greek{\\lambda}");c("\\upmu","\\up@greek{\\mu}");c("\\upnu","\\up@greek{\\nu}");c("\\upxi","\\up@greek{\\xi}");c("\\upomicron","\\up@greek{\\omicron}");c("\\uppi","\\up@greek{\\pi}");c("\\upalpha","\\up@greek{\\alpha}");c("\\uprho","\\up@greek{\\rho}");c("\\upsigma","\\up@greek{\\sigma}");c("\\uptau","\\up@greek{\\tau}");c("\\upupsilon","\\up@greek{\\upsilon}");c("\\upphi","\\up@greek{\\phi}");c("\\upchi","\\up@greek{\\chi}");c("\\uppsi","\\up@greek{\\psi}");c("\\upomega","\\up@greek{\\omega}");c("\\invamp",'\\mathbin{\\char"214b}');c("\\parr",'\\mathbin{\\char"214b}');c("\\with",'\\mathbin{\\char"26}');c("\\multimapinv",'\\mathrel{\\char"27dc}');c("\\multimapboth",'\\mathrel{\\char"29df}');c("\\scoh",'{\\mkern5mu\\char"2322\\mkern5mu}');c("\\sincoh",'{\\mkern5mu\\char"2323\\mkern5mu}');c("\\coh",`{\\mkern5mu\\rule{}{0.7em}\\mathrlap{\\smash{\\raise2mu{\\char"2322}}}
{\\smash{\\lower4mu{\\char"2323}}}\\mkern5mu}`);c("\\incoh",`{\\mkern5mu\\rule{}{0.7em}\\mathrlap{\\smash{\\raise2mu{\\char"2323}}}
{\\smash{\\lower4mu{\\char"2322}}}\\mkern5mu}`);c("\\standardstate","\\text{\\tiny\\char`⦵}");c("\\ce",function(e){return Dr(e.consumeArgs(1)[0],"ce")});c("\\pu",function(e){return Dr(e.consumeArgs(1)[0],"pu")});c("\\uniDash","{\\rule{0.672em}{0.06em}}");c("\\triDash","{\\rule{0.15em}{0.06em}\\kern2mu\\rule{0.15em}{0.06em}\\kern2mu\\rule{0.15em}{0.06em}}");c("\\tripleDash","\\kern0.075em\\raise0.25em{\\triDash}\\kern0.075em");c("\\tripleDashOverLine","\\kern0.075em\\mathrlap{\\raise0.125em{\\uniDash}}\\raise0.34em{\\triDash}\\kern0.075em");c("\\tripleDashOverDoubleLine","\\kern0.075em\\mathrlap{\\mathrlap{\\raise0.48em{\\triDash}}\\raise0.27em{\\uniDash}}{\\raise0.05em{\\uniDash}}\\kern0.075em");c("\\tripleDashBetweenDoubleLine","\\kern0.075em\\mathrlap{\\mathrlap{\\raise0.48em{\\uniDash}}\\raise0.27em{\\triDash}}{\\raise0.05em{\\uniDash}}\\kern0.075em");var Dr=function(e,t){for(var r="",n=e.length&&e[e.length-1].loc.start,o=e.length-1;o>=0;o--)e[o].loc.start>n&&(r+=" ",n=e[o].loc.start),r+=e[o].text,n+=e[o].text.length;var a=z.go(x.go(r,t));return a},x={go:function(e,t){if(!e)return[];t===void 0&&(t="ce");var r="0",n={};n.parenthesisLevel=0,e=e.replace(/\n/g," "),e=e.replace(/[\u2212\u2013\u2014\u2010]/g,"-"),e=e.replace(/[\u2026]/g,"...");for(var o,a=10,l=[];;){o!==e?(a=10,o=e):a--;var u=x.stateMachines[t],h=u.transitions[r]||u.transitions["*"];e:for(var g=0;g<h.length;g++){var y=x.patterns.match_(h[g].pattern,e);if(y){for(var _=h[g].task,b=0;b<_.action_.length;b++){var A;if(u.actions[_.action_[b].type_])A=u.actions[_.action_[b].type_](n,y.match_,_.action_[b].option);else if(x.actions[_.action_[b].type_])A=x.actions[_.action_[b].type_](n,y.match_,_.action_[b].option);else throw["MhchemBugA","mhchem bug A. Please report. ("+_.action_[b].type_+")"];x.concatArray(l,A)}if(r=_.nextState||r,e.length>0){if(_.revisit||(e=y.remainder),!_.toContinue)break e}else return l}}if(a<=0)throw["MhchemBugU","mhchem bug U. Please report."]}},concatArray:function(e,t){if(t)if(Array.isArray(t))for(var r=0;r<t.length;r++)e.push(t[r]);else e.push(t)},patterns:{patterns:{empty:/^$/,else:/^./,else2:/^./,space:/^\s/,"space A":/^\s(?=[A-Z\\$])/,space$:/^\s$/,"a-z":/^[a-z]/,x:/^x/,x$:/^x$/,i$:/^i$/,letters:/^(?:[a-zA-Z\u03B1-\u03C9\u0391-\u03A9?@]|(?:\\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega|Gamma|Delta|Theta|Lambda|Xi|Pi|Sigma|Upsilon|Phi|Psi|Omega)(?:\s+|\{\}|(?![a-zA-Z]))))+/,"\\greek":/^\\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega|Gamma|Delta|Theta|Lambda|Xi|Pi|Sigma|Upsilon|Phi|Psi|Omega)(?:\s+|\{\}|(?![a-zA-Z]))/,"one lowercase latin letter $":/^(?:([a-z])(?:$|[^a-zA-Z]))$/,"$one lowercase latin letter$ $":/^\$(?:([a-z])(?:$|[^a-zA-Z]))\$$/,"one lowercase greek letter $":/^(?:\$?[\u03B1-\u03C9]\$?|\$?\\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega)\s*\$?)(?:\s+|\{\}|(?![a-zA-Z]))$/,digits:/^[0-9]+/,"-9.,9":/^[+\-]?(?:[0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))/,"-9.,9 no missing 0":/^[+\-]?[0-9]+(?:[.,][0-9]+)?/,"(-)(9.,9)(e)(99)":function(e){var t=e.match(/^(\+\-|\+\/\-|\+|\-|\\pm\s?)?([0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))?(\((?:[0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))\))?(?:([eE]|\s*(\*|x|\\times|\u00D7)\s*10\^)([+\-]?[0-9]+|\{[+\-]?[0-9]+\}))?/);return t&&t[0]?{match_:t.splice(1),remainder:e.substr(t[0].length)}:null},"(-)(9)^(-9)":function(e){var t=e.match(/^(\+\-|\+\/\-|\+|\-|\\pm\s?)?([0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+)?)\^([+\-]?[0-9]+|\{[+\-]?[0-9]+\})/);return t&&t[0]?{match_:t.splice(1),remainder:e.substr(t[0].length)}:null},"state of aggregation $":function(e){var t=x.patterns.findObserveGroups(e,"",/^\([a-z]{1,3}(?=[\),])/,")","");if(t&&t.remainder.match(/^($|[\s,;\)\]\}])/))return t;var r=e.match(/^(?:\((?:\\ca\s?)?\$[amothc]\$\))/);return r?{match_:r[0],remainder:e.substr(r[0].length)}:null},"_{(state of aggregation)}$":/^_\{(\([a-z]{1,3}\))\}/,"{[(":/^(?:\\\{|\[|\()/,")]}":/^(?:\)|\]|\\\})/,", ":/^[,;]\s*/,",":/^[,;]/,".":/^[.]/,". ":/^([.\u22C5\u00B7\u2022])\s*/,"...":/^\.\.\.(?=$|[^.])/,"* ":/^([*])\s*/,"^{(...)}":function(e){return x.patterns.findObserveGroups(e,"^{","","","}")},"^($...$)":function(e){return x.patterns.findObserveGroups(e,"^","$","$","")},"^a":/^\^([0-9]+|[^\\_])/,"^\\x{}{}":function(e){return x.patterns.findObserveGroups(e,"^",/^\\[a-zA-Z]+\{/,"}","","","{","}","",!0)},"^\\x{}":function(e){return x.patterns.findObserveGroups(e,"^",/^\\[a-zA-Z]+\{/,"}","")},"^\\x":/^\^(\\[a-zA-Z]+)\s*/,"^(-1)":/^\^(-?\d+)/,"'":/^'/,"_{(...)}":function(e){return x.patterns.findObserveGroups(e,"_{","","","}")},"_($...$)":function(e){return x.patterns.findObserveGroups(e,"_","$","$","")},_9:/^_([+\-]?[0-9]+|[^\\])/,"_\\x{}{}":function(e){return x.patterns.findObserveGroups(e,"_",/^\\[a-zA-Z]+\{/,"}","","","{","}","",!0)},"_\\x{}":function(e){return x.patterns.findObserveGroups(e,"_",/^\\[a-zA-Z]+\{/,"}","")},"_\\x":/^_(\\[a-zA-Z]+)\s*/,"^_":/^(?:\^(?=_)|\_(?=\^)|[\^_]$)/,"{}":/^\{\}/,"{...}":function(e){return x.patterns.findObserveGroups(e,"","{","}","")},"{(...)}":function(e){return x.patterns.findObserveGroups(e,"{","","","}")},"$...$":function(e){return x.patterns.findObserveGroups(e,"","$","$","")},"${(...)}$":function(e){return x.patterns.findObserveGroups(e,"${","","","}$")},"$(...)$":function(e){return x.patterns.findObserveGroups(e,"$","","","$")},"=<>":/^[=<>]/,"#":/^[#\u2261]/,"+":/^\+/,"-$":/^-(?=[\s_},;\]/]|$|\([a-z]+\))/,"-9":/^-(?=[0-9])/,"- orbital overlap":/^-(?=(?:[spd]|sp)(?:$|[\s,;\)\]\}]))/,"-":/^-/,"pm-operator":/^(?:\\pm|\$\\pm\$|\+-|\+\/-)/,operator:/^(?:\+|(?:[\-=<>]|<<|>>|\\approx|\$\\approx\$)(?=\s|$|-?[0-9]))/,arrowUpDown:/^(?:v|\(v\)|\^|\(\^\))(?=$|[\s,;\)\]\}])/,"\\bond{(...)}":function(e){return x.patterns.findObserveGroups(e,"\\bond{","","","}")},"->":/^(?:<->|<-->|->|<-|<=>>|<<=>|<=>|[\u2192\u27F6\u21CC])/,CMT:/^[CMT](?=\[)/,"[(...)]":function(e){return x.patterns.findObserveGroups(e,"[","","","]")},"1st-level escape":/^(&|\\\\|\\hline)\s*/,"\\,":/^(?:\\[,\ ;:])/,"\\x{}{}":function(e){return x.patterns.findObserveGroups(e,"",/^\\[a-zA-Z]+\{/,"}","","","{","}","",!0)},"\\x{}":function(e){return x.patterns.findObserveGroups(e,"",/^\\[a-zA-Z]+\{/,"}","")},"\\ca":/^\\ca(?:\s+|(?![a-zA-Z]))/,"\\x":/^(?:\\[a-zA-Z]+\s*|\\[_&{}%])/,orbital:/^(?:[0-9]{1,2}[spdfgh]|[0-9]{0,2}sp)(?=$|[^a-zA-Z])/,others:/^[\/~|]/,"\\frac{(...)}":function(e){return x.patterns.findObserveGroups(e,"\\frac{","","","}","{","","","}")},"\\overset{(...)}":function(e){return x.patterns.findObserveGroups(e,"\\overset{","","","}","{","","","}")},"\\underset{(...)}":function(e){return x.patterns.findObserveGroups(e,"\\underset{","","","}","{","","","}")},"\\underbrace{(...)}":function(e){return x.patterns.findObserveGroups(e,"\\underbrace{","","","}_","{","","","}")},"\\color{(...)}0":function(e){return x.patterns.findObserveGroups(e,"\\color{","","","}")},"\\color{(...)}{(...)}1":function(e){return x.patterns.findObserveGroups(e,"\\color{","","","}","{","","","}")},"\\color(...){(...)}2":function(e){return x.patterns.findObserveGroups(e,"\\color","\\","",/^(?=\{)/,"{","","","}")},"\\ce{(...)}":function(e){return x.patterns.findObserveGroups(e,"\\ce{","","","}")},oxidation$:/^(?:[+-][IVX]+|\\pm\s*0|\$\\pm\$\s*0)$/,"d-oxidation$":/^(?:[+-]?\s?[IVX]+|\\pm\s*0|\$\\pm\$\s*0)$/,"roman numeral":/^[IVX]+/,"1/2$":/^[+\-]?(?:[0-9]+|\$[a-z]\$|[a-z])\/[0-9]+(?:\$[a-z]\$|[a-z])?$/,amount:function(e){var t;if(t=e.match(/^(?:(?:(?:\([+\-]?[0-9]+\/[0-9]+\)|[+\-]?(?:[0-9]+|\$[a-z]\$|[a-z])\/[0-9]+|[+\-]?[0-9]+[.,][0-9]+|[+\-]?\.[0-9]+|[+\-]?[0-9]+)(?:[a-z](?=\s*[A-Z]))?)|[+\-]?[a-z](?=\s*[A-Z])|\+(?!\s))/),t)return{match_:t[0],remainder:e.substr(t[0].length)};var r=x.patterns.findObserveGroups(e,"","$","$","");return r&&(t=r.match_.match(/^\$(?:\(?[+\-]?(?:[0-9]*[a-z]?[+\-])?[0-9]*[a-z](?:[+\-][0-9]*[a-z]?)?\)?|\+|-)\$$/),t)?{match_:t[0],remainder:e.substr(t[0].length)}:null},amount2:function(e){return this.amount(e)},"(KV letters),":/^(?:[A-Z][a-z]{0,2}|i)(?=,)/,formula$:function(e){if(e.match(/^\([a-z]+\)$/))return null;var t=e.match(/^(?:[a-z]|(?:[0-9\ \+\-\,\.\(\)]+[a-z])+[0-9\ \+\-\,\.\(\)]*|(?:[a-z][0-9\ \+\-\,\.\(\)]+)+[a-z]?)$/);return t?{match_:t[0],remainder:e.substr(t[0].length)}:null},uprightEntities:/^(?:pH|pOH|pC|pK|iPr|iBu)(?=$|[^a-zA-Z])/,"/":/^\s*(\/)\s*/,"//":/^\s*(\/\/)\s*/,"*":/^\s*[*.]\s*/},findObserveGroups:function(e,t,r,n,o,a,l,u,h,g){var y=function(I,V){if(typeof V=="string")return I.indexOf(V)!==0?null:V;var Ee=I.match(V);return Ee?Ee[0]:null},_=function(I,V,Ee){for(var _e=0;V<I.length;){var yt=I.charAt(V),vt=y(I.substr(V),Ee);if(vt!==null&&_e===0)return{endMatchBegin:V,endMatchEnd:V+vt.length};if(yt==="{")_e++;else if(yt==="}"){if(_e===0)throw["ExtraCloseMissingOpen","Extra close brace or missing open brace"];_e--}V++}return _e>0,null},b=y(e,t);if(b===null||(e=e.substr(b.length),b=y(e,r),b===null))return null;var A=_(e,b.length,n||o);if(A===null)return null;var C=e.substring(0,n?A.endMatchEnd:A.endMatchBegin);if(a||l){var H=this.findObserveGroups(e.substr(A.endMatchEnd),a,l,u,h);if(H===null)return null;var oe=[C,H.match_];return{match_:g?oe.join(""):oe,remainder:H.remainder}}else return{match_:C,remainder:e.substr(A.endMatchEnd)}},match_:function(e,t){var r=x.patterns.patterns[e];if(r===void 0)throw["MhchemBugP","mhchem bug P. Please report. ("+e+")"];if(typeof r=="function")return x.patterns.patterns[e](t);var n=t.match(r);if(n){var o;return n[2]?o=[n[1],n[2]]:n[1]?o=n[1]:o=n[0],{match_:o,remainder:t.substr(n[0].length)}}return null}},actions:{"a=":function(e,t){e.a=(e.a||"")+t},"b=":function(e,t){e.b=(e.b||"")+t},"p=":function(e,t){e.p=(e.p||"")+t},"o=":function(e,t){e.o=(e.o||"")+t},"q=":function(e,t){e.q=(e.q||"")+t},"d=":function(e,t){e.d=(e.d||"")+t},"rm=":function(e,t){e.rm=(e.rm||"")+t},"text=":function(e,t){e.text_=(e.text_||"")+t},insert:function(e,t,r){return{type_:r}},"insert+p1":function(e,t,r){return{type_:r,p1:t}},"insert+p1+p2":function(e,t,r){return{type_:r,p1:t[0],p2:t[1]}},copy:function(e,t){return t},rm:function(e,t){return{type_:"rm",p1:t||""}},text:function(e,t){return x.go(t,"text")},"{text}":function(e,t){var r=["{"];return x.concatArray(r,x.go(t,"text")),r.push("}"),r},"tex-math":function(e,t){return x.go(t,"tex-math")},"tex-math tight":function(e,t){return x.go(t,"tex-math tight")},bond:function(e,t,r){return{type_:"bond",kind_:r||t}},"color0-output":function(e,t){return{type_:"color0",color:t[0]}},ce:function(e,t){return x.go(t)},"1/2":function(e,t){var r=[];t.match(/^[+\-]/)&&(r.push(t.substr(0,1)),t=t.substr(1));var n=t.match(/^([0-9]+|\$[a-z]\$|[a-z])\/([0-9]+)(\$[a-z]\$|[a-z])?$/);return n[1]=n[1].replace(/\$/g,""),r.push({type_:"frac",p1:n[1],p2:n[2]}),n[3]&&(n[3]=n[3].replace(/\$/g,""),r.push({type_:"tex-math",p1:n[3]})),r},"9,9":function(e,t){return x.go(t,"9,9")}},createTransitions:function(e){var t,r,n,o,a={};for(t in e)for(r in e[t])for(n=r.split("|"),e[t][r].stateArray=n,o=0;o<n.length;o++)a[n[o]]=[];for(t in e)for(r in e[t])for(n=e[t][r].stateArray||[],o=0;o<n.length;o++){var l=e[t][r];if(l.action_){l.action_=[].concat(l.action_);for(var u=0;u<l.action_.length;u++)typeof l.action_[u]=="string"&&(l.action_[u]={type_:l.action_[u]})}else l.action_=[];for(var h=t.split("|"),g=0;g<h.length;g++)if(n[o]==="*")for(var y in a)a[y].push({pattern:h[g],task:l});else a[n[o]].push({pattern:h[g],task:l})}return a},stateMachines:{}};x.stateMachines={ce:{transitions:x.createTransitions({empty:{"*":{action_:"output"}},else:{"0|1|2":{action_:"beginsWithBond=false",revisit:!0,toContinue:!0}},oxidation$:{0:{action_:"oxidation-output"}},CMT:{r:{action_:"rdt=",nextState:"rt"},rd:{action_:"rqt=",nextState:"rdt"}},arrowUpDown:{"0|1|2|as":{action_:["sb=false","output","operator"],nextState:"1"}},uprightEntities:{"0|1|2":{action_:["o=","output"],nextState:"1"}},orbital:{"0|1|2|3":{action_:"o=",nextState:"o"}},"->":{"0|1|2|3":{action_:"r=",nextState:"r"},"a|as":{action_:["output","r="],nextState:"r"},"*":{action_:["output","r="],nextState:"r"}},"+":{o:{action_:"d= kv",nextState:"d"},"d|D":{action_:"d=",nextState:"d"},q:{action_:"d=",nextState:"qd"},"qd|qD":{action_:"d=",nextState:"qd"},dq:{action_:["output","d="],nextState:"d"},3:{action_:["sb=false","output","operator"],nextState:"0"}},amount:{"0|2":{action_:"a=",nextState:"a"}},"pm-operator":{"0|1|2|a|as":{action_:["sb=false","output",{type_:"operator",option:"\\pm"}],nextState:"0"}},operator:{"0|1|2|a|as":{action_:["sb=false","output","operator"],nextState:"0"}},"-$":{"o|q":{action_:["charge or bond","output"],nextState:"qd"},d:{action_:"d=",nextState:"d"},D:{action_:["output",{type_:"bond",option:"-"}],nextState:"3"},q:{action_:"d=",nextState:"qd"},qd:{action_:"d=",nextState:"qd"},"qD|dq":{action_:["output",{type_:"bond",option:"-"}],nextState:"3"}},"-9":{"3|o":{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"3"}},"- orbital overlap":{o:{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"2"},d:{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"2"}},"-":{"0|1|2":{action_:[{type_:"output",option:1},"beginsWithBond=true",{type_:"bond",option:"-"}],nextState:"3"},3:{action_:{type_:"bond",option:"-"}},a:{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"2"},as:{action_:[{type_:"output",option:2},{type_:"bond",option:"-"}],nextState:"3"},b:{action_:"b="},o:{action_:{type_:"- after o/d",option:!1},nextState:"2"},q:{action_:{type_:"- after o/d",option:!1},nextState:"2"},"d|qd|dq":{action_:{type_:"- after o/d",option:!0},nextState:"2"},"D|qD|p":{action_:["output",{type_:"bond",option:"-"}],nextState:"3"}},amount2:{"1|3":{action_:"a=",nextState:"a"}},letters:{"0|1|2|3|a|as|b|p|bp|o":{action_:"o=",nextState:"o"},"q|dq":{action_:["output","o="],nextState:"o"},"d|D|qd|qD":{action_:"o after d",nextState:"o"}},digits:{o:{action_:"q=",nextState:"q"},"d|D":{action_:"q=",nextState:"dq"},q:{action_:["output","o="],nextState:"o"},a:{action_:"o=",nextState:"o"}},"space A":{"b|p|bp":{}},space:{a:{nextState:"as"},0:{action_:"sb=false"},"1|2":{action_:"sb=true"},"r|rt|rd|rdt|rdq":{action_:"output",nextState:"0"},"*":{action_:["output","sb=true"],nextState:"1"}},"1st-level escape":{"1|2":{action_:["output",{type_:"insert+p1",option:"1st-level escape"}]},"*":{action_:["output",{type_:"insert+p1",option:"1st-level escape"}],nextState:"0"}},"[(...)]":{"r|rt":{action_:"rd=",nextState:"rd"},"rd|rdt":{action_:"rq=",nextState:"rdq"}},"...":{"o|d|D|dq|qd|qD":{action_:["output",{type_:"bond",option:"..."}],nextState:"3"},"*":{action_:[{type_:"output",option:1},{type_:"insert",option:"ellipsis"}],nextState:"1"}},". |* ":{"*":{action_:["output",{type_:"insert",option:"addition compound"}],nextState:"1"}},"state of aggregation $":{"*":{action_:["output","state of aggregation"],nextState:"1"}},"{[(":{"a|as|o":{action_:["o=","output","parenthesisLevel++"],nextState:"2"},"0|1|2|3":{action_:["o=","output","parenthesisLevel++"],nextState:"2"},"*":{action_:["output","o=","output","parenthesisLevel++"],nextState:"2"}},")]}":{"0|1|2|3|b|p|bp|o":{action_:["o=","parenthesisLevel--"],nextState:"o"},"a|as|d|D|q|qd|qD|dq":{action_:["output","o=","parenthesisLevel--"],nextState:"o"}},", ":{"*":{action_:["output","comma"],nextState:"0"}},"^_":{"*":{}},"^{(...)}|^($...$)":{"0|1|2|as":{action_:"b=",nextState:"b"},p:{action_:"b=",nextState:"bp"},"3|o":{action_:"d= kv",nextState:"D"},q:{action_:"d=",nextState:"qD"},"d|D|qd|qD|dq":{action_:["output","d="],nextState:"D"}},"^a|^\\x{}{}|^\\x{}|^\\x|'":{"0|1|2|as":{action_:"b=",nextState:"b"},p:{action_:"b=",nextState:"bp"},"3|o":{action_:"d= kv",nextState:"d"},q:{action_:"d=",nextState:"qd"},"d|qd|D|qD":{action_:"d="},dq:{action_:["output","d="],nextState:"d"}},"_{(state of aggregation)}$":{"d|D|q|qd|qD|dq":{action_:["output","q="],nextState:"q"}},"_{(...)}|_($...$)|_9|_\\x{}{}|_\\x{}|_\\x":{"0|1|2|as":{action_:"p=",nextState:"p"},b:{action_:"p=",nextState:"bp"},"3|o":{action_:"q=",nextState:"q"},"d|D":{action_:"q=",nextState:"dq"},"q|qd|qD|dq":{action_:["output","q="],nextState:"q"}},"=<>":{"0|1|2|3|a|as|o|q|d|D|qd|qD|dq":{action_:[{type_:"output",option:2},"bond"],nextState:"3"}},"#":{"0|1|2|3|a|as|o":{action_:[{type_:"output",option:2},{type_:"bond",option:"#"}],nextState:"3"}},"{}":{"*":{action_:{type_:"output",option:1},nextState:"1"}},"{...}":{"0|1|2|3|a|as|b|p|bp":{action_:"o=",nextState:"o"},"o|d|D|q|qd|qD|dq":{action_:["output","o="],nextState:"o"}},"$...$":{a:{action_:"a="},"0|1|2|3|as|b|p|bp|o":{action_:"o=",nextState:"o"},"as|o":{action_:"o="},"q|d|D|qd|qD|dq":{action_:["output","o="],nextState:"o"}},"\\bond{(...)}":{"*":{action_:[{type_:"output",option:2},"bond"],nextState:"3"}},"\\frac{(...)}":{"*":{action_:[{type_:"output",option:1},"frac-output"],nextState:"3"}},"\\overset{(...)}":{"*":{action_:[{type_:"output",option:2},"overset-output"],nextState:"3"}},"\\underset{(...)}":{"*":{action_:[{type_:"output",option:2},"underset-output"],nextState:"3"}},"\\underbrace{(...)}":{"*":{action_:[{type_:"output",option:2},"underbrace-output"],nextState:"3"}},"\\color{(...)}{(...)}1|\\color(...){(...)}2":{"*":{action_:[{type_:"output",option:2},"color-output"],nextState:"3"}},"\\color{(...)}0":{"*":{action_:[{type_:"output",option:2},"color0-output"]}},"\\ce{(...)}":{"*":{action_:[{type_:"output",option:2},"ce"],nextState:"3"}},"\\,":{"*":{action_:[{type_:"output",option:1},"copy"],nextState:"1"}},"\\x{}{}|\\x{}|\\x":{"0|1|2|3|a|as|b|p|bp|o|c0":{action_:["o=","output"],nextState:"3"},"*":{action_:["output","o=","output"],nextState:"3"}},others:{"*":{action_:[{type_:"output",option:1},"copy"],nextState:"3"}},else2:{a:{action_:"a to o",nextState:"o",revisit:!0},as:{action_:["output","sb=true"],nextState:"1",revisit:!0},"r|rt|rd|rdt|rdq":{action_:["output"],nextState:"0",revisit:!0},"*":{action_:["output","copy"],nextState:"3"}}}),actions:{"o after d":function(e,t){var r;if((e.d||"").match(/^[0-9]+$/)){var n=e.d;e.d=void 0,r=this.output(e),e.b=n}else r=this.output(e);return x.actions["o="](e,t),r},"d= kv":function(e,t){e.d=t,e.dType="kv"},"charge or bond":function(e,t){if(e.beginsWithBond){var r=[];return x.concatArray(r,this.output(e)),x.concatArray(r,x.actions.bond(e,t,"-")),r}else e.d=t},"- after o/d":function(e,t,r){var n=x.patterns.match_("orbital",e.o||""),o=x.patterns.match_("one lowercase greek letter $",e.o||""),a=x.patterns.match_("one lowercase latin letter $",e.o||""),l=x.patterns.match_("$one lowercase latin letter$ $",e.o||""),u=t==="-"&&(n&&n.remainder===""||o||a||l);u&&!e.a&&!e.b&&!e.p&&!e.d&&!e.q&&!n&&a&&(e.o="$"+e.o+"$");var h=[];return u?(x.concatArray(h,this.output(e)),h.push({type_:"hyphen"})):(n=x.patterns.match_("digits",e.d||""),r&&n&&n.remainder===""?(x.concatArray(h,x.actions["d="](e,t)),x.concatArray(h,this.output(e))):(x.concatArray(h,this.output(e)),x.concatArray(h,x.actions.bond(e,t,"-")))),h},"a to o":function(e){e.o=e.a,e.a=void 0},"sb=true":function(e){e.sb=!0},"sb=false":function(e){e.sb=!1},"beginsWithBond=true":function(e){e.beginsWithBond=!0},"beginsWithBond=false":function(e){e.beginsWithBond=!1},"parenthesisLevel++":function(e){e.parenthesisLevel++},"parenthesisLevel--":function(e){e.parenthesisLevel--},"state of aggregation":function(e,t){return{type_:"state of aggregation",p1:x.go(t,"o")}},comma:function(e,t){var r=t.replace(/\s*$/,""),n=r!==t;return n&&e.parenthesisLevel===0?{type_:"comma enumeration L",p1:r}:{type_:"comma enumeration M",p1:r}},output:function(e,t,r){var n;if(!e.r)n=[],!e.a&&!e.b&&!e.p&&!e.o&&!e.q&&!e.d&&!r||(e.sb&&n.push({type_:"entitySkip"}),!e.o&&!e.q&&!e.d&&!e.b&&!e.p&&r!==2?(e.o=e.a,e.a=void 0):!e.o&&!e.q&&!e.d&&(e.b||e.p)?(e.o=e.a,e.d=e.b,e.q=e.p,e.a=e.b=e.p=void 0):e.o&&e.dType==="kv"&&x.patterns.match_("d-oxidation$",e.d||"")?e.dType="oxidation":e.o&&e.dType==="kv"&&!e.q&&(e.dType=void 0),n.push({type_:"chemfive",a:x.go(e.a,"a"),b:x.go(e.b,"bd"),p:x.go(e.p,"pq"),o:x.go(e.o,"o"),q:x.go(e.q,"pq"),d:x.go(e.d,e.dType==="oxidation"?"oxidation":"bd"),dType:e.dType}));else{var o;e.rdt==="M"?o=x.go(e.rd,"tex-math"):e.rdt==="T"?o=[{type_:"text",p1:e.rd||""}]:o=x.go(e.rd);var a;e.rqt==="M"?a=x.go(e.rq,"tex-math"):e.rqt==="T"?a=[{type_:"text",p1:e.rq||""}]:a=x.go(e.rq),n={type_:"arrow",r:e.r,rd:o,rq:a}}for(var l in e)l!=="parenthesisLevel"&&l!=="beginsWithBond"&&delete e[l];return n},"oxidation-output":function(e,t){var r=["{"];return x.concatArray(r,x.go(t,"oxidation")),r.push("}"),r},"frac-output":function(e,t){return{type_:"frac-ce",p1:x.go(t[0]),p2:x.go(t[1])}},"overset-output":function(e,t){return{type_:"overset",p1:x.go(t[0]),p2:x.go(t[1])}},"underset-output":function(e,t){return{type_:"underset",p1:x.go(t[0]),p2:x.go(t[1])}},"underbrace-output":function(e,t){return{type_:"underbrace",p1:x.go(t[0]),p2:x.go(t[1])}},"color-output":function(e,t){return{type_:"color",color1:t[0],color2:x.go(t[1])}},"r=":function(e,t){e.r=t},"rdt=":function(e,t){e.rdt=t},"rd=":function(e,t){e.rd=t},"rqt=":function(e,t){e.rqt=t},"rq=":function(e,t){e.rq=t},operator:function(e,t,r){return{type_:"operator",kind_:r||t}}}},a:{transitions:x.createTransitions({empty:{"*":{}},"1/2$":{0:{action_:"1/2"}},else:{0:{nextState:"1",revisit:!0}},"$(...)$":{"*":{action_:"tex-math tight",nextState:"1"}},",":{"*":{action_:{type_:"insert",option:"commaDecimal"}}},else2:{"*":{action_:"copy"}}}),actions:{}},o:{transitions:x.createTransitions({empty:{"*":{}},"1/2$":{0:{action_:"1/2"}},else:{0:{nextState:"1",revisit:!0}},letters:{"*":{action_:"rm"}},"\\ca":{"*":{action_:{type_:"insert",option:"circa"}}},"\\x{}{}|\\x{}|\\x":{"*":{action_:"copy"}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"{(...)}":{"*":{action_:"{text}"}},else2:{"*":{action_:"copy"}}}),actions:{}},text:{transitions:x.createTransitions({empty:{"*":{action_:"output"}},"{...}":{"*":{action_:"text="}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"\\greek":{"*":{action_:["output","rm"]}},"\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:["output","copy"]}},else:{"*":{action_:"text="}}}),actions:{output:function(e){if(e.text_){var t={type_:"text",p1:e.text_};for(var r in e)delete e[r];return t}}}},pq:{transitions:x.createTransitions({empty:{"*":{}},"state of aggregation $":{"*":{action_:"state of aggregation"}},i$:{0:{nextState:"!f",revisit:!0}},"(KV letters),":{0:{action_:"rm",nextState:"0"}},formula$:{0:{nextState:"f",revisit:!0}},"1/2$":{0:{action_:"1/2"}},else:{0:{nextState:"!f",revisit:!0}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"{(...)}":{"*":{action_:"text"}},"a-z":{f:{action_:"tex-math"}},letters:{"*":{action_:"rm"}},"-9.,9":{"*":{action_:"9,9"}},",":{"*":{action_:{type_:"insert+p1",option:"comma enumeration S"}}},"\\color{(...)}{(...)}1|\\color(...){(...)}2":{"*":{action_:"color-output"}},"\\color{(...)}0":{"*":{action_:"color0-output"}},"\\ce{(...)}":{"*":{action_:"ce"}},"\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"copy"}},else2:{"*":{action_:"copy"}}}),actions:{"state of aggregation":function(e,t){return{type_:"state of aggregation subscript",p1:x.go(t,"o")}},"color-output":function(e,t){return{type_:"color",color1:t[0],color2:x.go(t[1],"pq")}}}},bd:{transitions:x.createTransitions({empty:{"*":{}},x$:{0:{nextState:"!f",revisit:!0}},formula$:{0:{nextState:"f",revisit:!0}},else:{0:{nextState:"!f",revisit:!0}},"-9.,9 no missing 0":{"*":{action_:"9,9"}},".":{"*":{action_:{type_:"insert",option:"electron dot"}}},"a-z":{f:{action_:"tex-math"}},x:{"*":{action_:{type_:"insert",option:"KV x"}}},letters:{"*":{action_:"rm"}},"'":{"*":{action_:{type_:"insert",option:"prime"}}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"{(...)}":{"*":{action_:"text"}},"\\color{(...)}{(...)}1|\\color(...){(...)}2":{"*":{action_:"color-output"}},"\\color{(...)}0":{"*":{action_:"color0-output"}},"\\ce{(...)}":{"*":{action_:"ce"}},"\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"copy"}},else2:{"*":{action_:"copy"}}}),actions:{"color-output":function(e,t){return{type_:"color",color1:t[0],color2:x.go(t[1],"bd")}}}},oxidation:{transitions:x.createTransitions({empty:{"*":{}},"roman numeral":{"*":{action_:"roman-numeral"}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},else:{"*":{action_:"copy"}}}),actions:{"roman-numeral":function(e,t){return{type_:"roman numeral",p1:t||""}}}},"tex-math":{transitions:x.createTransitions({empty:{"*":{action_:"output"}},"\\ce{(...)}":{"*":{action_:["output","ce"]}},"{...}|\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"o="}},else:{"*":{action_:"o="}}}),actions:{output:function(e){if(e.o){var t={type_:"tex-math",p1:e.o};for(var r in e)delete e[r];return t}}}},"tex-math tight":{transitions:x.createTransitions({empty:{"*":{action_:"output"}},"\\ce{(...)}":{"*":{action_:["output","ce"]}},"{...}|\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"o="}},"-|+":{"*":{action_:"tight operator"}},else:{"*":{action_:"o="}}}),actions:{"tight operator":function(e,t){e.o=(e.o||"")+"{"+t+"}"},output:function(e){if(e.o){var t={type_:"tex-math",p1:e.o};for(var r in e)delete e[r];return t}}}},"9,9":{transitions:x.createTransitions({empty:{"*":{}},",":{"*":{action_:"comma"}},else:{"*":{action_:"copy"}}}),actions:{comma:function(){return{type_:"commaDecimal"}}}},pu:{transitions:x.createTransitions({empty:{"*":{action_:"output"}},space$:{"*":{action_:["output","space"]}},"{[(|)]}":{"0|a":{action_:"copy"}},"(-)(9)^(-9)":{0:{action_:"number^",nextState:"a"}},"(-)(9.,9)(e)(99)":{0:{action_:"enumber",nextState:"a"}},space:{"0|a":{}},"pm-operator":{"0|a":{action_:{type_:"operator",option:"\\pm"},nextState:"0"}},operator:{"0|a":{action_:"copy",nextState:"0"}},"//":{d:{action_:"o=",nextState:"/"}},"/":{d:{action_:"o=",nextState:"/"}},"{...}|else":{"0|d":{action_:"d=",nextState:"d"},a:{action_:["space","d="],nextState:"d"},"/|q":{action_:"q=",nextState:"q"}}}),actions:{enumber:function(e,t){var r=[];return t[0]==="+-"||t[0]==="+/-"?r.push("\\pm "):t[0]&&r.push(t[0]),t[1]&&(x.concatArray(r,x.go(t[1],"pu-9,9")),t[2]&&(t[2].match(/[,.]/)?x.concatArray(r,x.go(t[2],"pu-9,9")):r.push(t[2])),t[3]=t[4]||t[3],t[3]&&(t[3]=t[3].trim(),t[3]==="e"||t[3].substr(0,1)==="*"?r.push({type_:"cdot"}):r.push({type_:"times"}))),t[3]&&r.push("10^{"+t[5]+"}"),r},"number^":function(e,t){var r=[];return t[0]==="+-"||t[0]==="+/-"?r.push("\\pm "):t[0]&&r.push(t[0]),x.concatArray(r,x.go(t[1],"pu-9,9")),r.push("^{"+t[2]+"}"),r},operator:function(e,t,r){return{type_:"operator",kind_:r||t}},space:function(){return{type_:"pu-space-1"}},output:function(e){var t,r=x.patterns.match_("{(...)}",e.d||"");r&&r.remainder===""&&(e.d=r.match_);var n=x.patterns.match_("{(...)}",e.q||"");if(n&&n.remainder===""&&(e.q=n.match_),e.d&&(e.d=e.d.replace(/\u00B0C|\^oC|\^{o}C/g,"{}^{\\circ}C"),e.d=e.d.replace(/\u00B0F|\^oF|\^{o}F/g,"{}^{\\circ}F")),e.q){e.q=e.q.replace(/\u00B0C|\^oC|\^{o}C/g,"{}^{\\circ}C"),e.q=e.q.replace(/\u00B0F|\^oF|\^{o}F/g,"{}^{\\circ}F");var o={d:x.go(e.d,"pu"),q:x.go(e.q,"pu")};e.o==="//"?t={type_:"pu-frac",p1:o.d,p2:o.q}:(t=o.d,o.d.length>1||o.q.length>1?t.push({type_:" / "}):t.push({type_:"/"}),x.concatArray(t,o.q))}else t=x.go(e.d,"pu-2");for(var a in e)delete e[a];return t}}},"pu-2":{transitions:x.createTransitions({empty:{"*":{action_:"output"}},"*":{"*":{action_:["output","cdot"],nextState:"0"}},"\\x":{"*":{action_:"rm="}},space:{"*":{action_:["output","space"],nextState:"0"}},"^{(...)}|^(-1)":{1:{action_:"^(-1)"}},"-9.,9":{0:{action_:"rm=",nextState:"0"},1:{action_:"^(-1)",nextState:"0"}},"{...}|else":{"*":{action_:"rm=",nextState:"1"}}}),actions:{cdot:function(){return{type_:"tight cdot"}},"^(-1)":function(e,t){e.rm+="^{"+t+"}"},space:function(){return{type_:"pu-space-2"}},output:function(e){var t=[];if(e.rm){var r=x.patterns.match_("{(...)}",e.rm||"");r&&r.remainder===""?t=x.go(r.match_,"pu"):t={type_:"rm",p1:e.rm}}for(var n in e)delete e[n];return t}}},"pu-9,9":{transitions:x.createTransitions({empty:{0:{action_:"output-0"},o:{action_:"output-o"}},",":{0:{action_:["output-0","comma"],nextState:"o"}},".":{0:{action_:["output-0","copy"],nextState:"o"}},else:{"*":{action_:"text="}}}),actions:{comma:function(){return{type_:"commaDecimal"}},"output-0":function(e){var t=[];if(e.text_=e.text_||"",e.text_.length>4){var r=e.text_.length%3;r===0&&(r=3);for(var n=e.text_.length-3;n>0;n-=3)t.push(e.text_.substr(n,3)),t.push({type_:"1000 separator"});t.push(e.text_.substr(0,r)),t.reverse()}else t.push(e.text_);for(var o in e)delete e[o];return t},"output-o":function(e){var t=[];if(e.text_=e.text_||"",e.text_.length>4){for(var r=e.text_.length-3,n=0;n<r;n+=3)t.push(e.text_.substr(n,3)),t.push({type_:"1000 separator"});t.push(e.text_.substr(n))}else t.push(e.text_);for(var o in e)delete e[o];return t}}}};var z={go:function(e,t){if(!e)return"";for(var r="",n=!1,o=0;o<e.length;o++){var a=e[o];typeof a=="string"?r+=a:(r+=z._go2(a),a.type_==="1st-level escape"&&(n=!0))}return!t&&!n&&r&&(r="{"+r+"}"),r},_goInner:function(e){return e&&z.go(e,!0)},_go2:function(e){var t;switch(e.type_){case"chemfive":t="";var r={a:z._goInner(e.a),b:z._goInner(e.b),p:z._goInner(e.p),o:z._goInner(e.o),q:z._goInner(e.q),d:z._goInner(e.d)};r.a&&(r.a.match(/^[+\-]/)&&(r.a="{"+r.a+"}"),t+=r.a+"\\,"),(r.b||r.p)&&(t+="{\\vphantom{X}}",t+="^{\\hphantom{"+(r.b||"")+"}}_{\\hphantom{"+(r.p||"")+"}}",t+="{\\vphantom{X}}",t+="^{\\smash[t]{\\vphantom{2}}\\mathllap{"+(r.b||"")+"}}",t+="_{\\vphantom{2}\\mathllap{\\smash[t]{"+(r.p||"")+"}}}"),r.o&&(r.o.match(/^[+\-]/)&&(r.o="{"+r.o+"}"),t+=r.o),e.dType==="kv"?((r.d||r.q)&&(t+="{\\vphantom{X}}"),r.d&&(t+="^{"+r.d+"}"),r.q&&(t+="_{\\smash[t]{"+r.q+"}}")):e.dType==="oxidation"?(r.d&&(t+="{\\vphantom{X}}",t+="^{"+r.d+"}"),r.q&&(t+="{{}}",t+="_{\\smash[t]{"+r.q+"}}")):(r.q&&(t+="{{}}",t+="_{\\smash[t]{"+r.q+"}}"),r.d&&(t+="{{}}",t+="^{"+r.d+"}"));break;case"rm":t="\\mathrm{"+e.p1+"}";break;case"text":e.p1.match(/[\^_]/)?(e.p1=e.p1.replace(" ","~").replace("-","\\text{-}"),t="\\mathrm{"+e.p1+"}"):t="\\text{"+e.p1+"}";break;case"roman numeral":t="\\mathrm{"+e.p1+"}";break;case"state of aggregation":t="\\mskip2mu "+z._goInner(e.p1);break;case"state of aggregation subscript":t="\\mskip1mu "+z._goInner(e.p1);break;case"bond":if(t=z._getBond(e.kind_),!t)throw["MhchemErrorBond","mhchem Error. Unknown bond type ("+e.kind_+")"];break;case"frac":var n="\\frac{"+e.p1+"}{"+e.p2+"}";t="\\mathchoice{\\textstyle"+n+"}{"+n+"}{"+n+"}{"+n+"}";break;case"pu-frac":var o="\\frac{"+z._goInner(e.p1)+"}{"+z._goInner(e.p2)+"}";t="\\mathchoice{\\textstyle"+o+"}{"+o+"}{"+o+"}{"+o+"}";break;case"tex-math":t=e.p1+" ";break;case"frac-ce":t="\\frac{"+z._goInner(e.p1)+"}{"+z._goInner(e.p2)+"}";break;case"overset":t="\\overset{"+z._goInner(e.p1)+"}{"+z._goInner(e.p2)+"}";break;case"underset":t="\\underset{"+z._goInner(e.p1)+"}{"+z._goInner(e.p2)+"}";break;case"underbrace":t="\\underbrace{"+z._goInner(e.p1)+"}_{"+z._goInner(e.p2)+"}";break;case"color":t="{\\color{"+e.color1+"}{"+z._goInner(e.color2)+"}}";break;case"color0":t="\\color{"+e.color+"}";break;case"arrow":var a={rd:z._goInner(e.rd),rq:z._goInner(e.rq)},l=z._getArrow(e.r);a.rq&&(l+="[{\\rm "+a.rq+"}]"),a.rd?l+="{\\rm "+a.rd+"}":l+="{}",t=l;break;case"operator":t=z._getOperator(e.kind_);break;case"1st-level escape":t=e.p1+" ";break;case"space":t=" ";break;case"entitySkip":t="~";break;case"pu-space-1":t="~";break;case"pu-space-2":t="\\mkern3mu ";break;case"1000 separator":t="\\mkern2mu ";break;case"commaDecimal":t="{,}";break;case"comma enumeration L":t="{"+e.p1+"}\\mkern6mu ";break;case"comma enumeration M":t="{"+e.p1+"}\\mkern3mu ";break;case"comma enumeration S":t="{"+e.p1+"}\\mkern1mu ";break;case"hyphen":t="\\text{-}";break;case"addition compound":t="\\,{\\cdot}\\,";break;case"electron dot":t="\\mkern1mu \\text{\\textbullet}\\mkern1mu ";break;case"KV x":t="{\\times}";break;case"prime":t="\\prime ";break;case"cdot":t="\\cdot ";break;case"tight cdot":t="\\mkern1mu{\\cdot}\\mkern1mu ";break;case"times":t="\\times ";break;case"circa":t="{\\sim}";break;case"^":t="uparrow";break;case"v":t="downarrow";break;case"ellipsis":t="\\ldots ";break;case"/":t="/";break;case" / ":t="\\,/\\,";break;default:throw["MhchemBugT","mhchem bug T. Please report."]}return t},_getArrow:function(e){switch(e){case"->":return"\\yields";case"→":return"\\yields";case"⟶":return"\\yields";case"<-":return"\\yieldsLeft";case"<->":return"\\mesomerism";case"<-->":return"\\yieldsLeftRight";case"<=>":return"\\equilibrium";case"⇌":return"\\equilibrium";case"<=>>":return"\\equilibriumRight";case"<<=>":return"\\equilibriumLeft";default:throw["MhchemBugT","mhchem bug T. Please report."]}},_getBond:function(e){switch(e){case"-":return"{-}";case"1":return"{-}";case"=":return"{=}";case"2":return"{=}";case"#":return"{\\equiv}";case"3":return"{\\equiv}";case"~":return"{\\tripleDash}";case"~-":return"{\\tripleDashOverLine}";case"~=":return"{\\tripleDashOverDoubleLine}";case"~--":return"{\\tripleDashOverDoubleLine}";case"-~-":return"{\\tripleDashBetweenDoubleLine}";case"...":return"{{\\cdot}{\\cdot}{\\cdot}}";case"....":return"{{\\cdot}{\\cdot}{\\cdot}{\\cdot}}";case"->":return"{\\rightarrow}";case"<-":return"{\\leftarrow}";case"<":return"{<}";case">":return"{>}";default:throw["MhchemBugT","mhchem bug T. Please report."]}},_getOperator:function(e){switch(e){case"+":return" {}+{} ";case"-":return" {}-{} ";case"=":return" {}={} ";case"<":return" {}<{} ";case">":return" {}>{} ";case"<<":return" {}\\ll{} ";case">>":return" {}\\gg{} ";case"\\pm":return" {}\\pm{} ";case"\\approx":return" {}\\approx{} ";case"$\\approx$":return" {}\\approx{} ";case"v":return" \\downarrow{} ";case"(v)":return" \\downarrow{} ";case"^":return" \\uparrow{} ";case"(^)":return" \\uparrow{} ";default:throw["MhchemBugT","mhchem bug T. Please report."]}}};c("\\darr","\\downarrow");c("\\dArr","\\Downarrow");c("\\Darr","\\Downarrow");c("\\lang","\\langle");c("\\rang","\\rangle");c("\\uarr","\\uparrow");c("\\uArr","\\Uparrow");c("\\Uarr","\\Uparrow");c("\\N","\\mathbb{N}");c("\\R","\\mathbb{R}");c("\\Z","\\mathbb{Z}");c("\\alef","\\aleph");c("\\alefsym","\\aleph");c("\\bull","\\bullet");c("\\clubs","\\clubsuit");c("\\cnums","\\mathbb{C}");c("\\Complex","\\mathbb{C}");c("\\Dagger","\\ddagger");c("\\diamonds","\\diamondsuit");c("\\empty","\\emptyset");c("\\exist","\\exists");c("\\harr","\\leftrightarrow");c("\\hArr","\\Leftrightarrow");c("\\Harr","\\Leftrightarrow");c("\\hearts","\\heartsuit");c("\\image","\\Im");c("\\infin","\\infty");c("\\isin","\\in");c("\\larr","\\leftarrow");c("\\lArr","\\Leftarrow");c("\\Larr","\\Leftarrow");c("\\lrarr","\\leftrightarrow");c("\\lrArr","\\Leftrightarrow");c("\\Lrarr","\\Leftrightarrow");c("\\natnums","\\mathbb{N}");c("\\plusmn","\\pm");c("\\rarr","\\rightarrow");c("\\rArr","\\Rightarrow");c("\\Rarr","\\Rightarrow");c("\\real","\\Re");c("\\reals","\\mathbb{R}");c("\\Reals","\\mathbb{R}");c("\\sdot","\\cdot");c("\\sect","\\S");c("\\spades","\\spadesuit");c("\\sub","\\subset");c("\\sube","\\subseteq");c("\\supe","\\supseteq");c("\\thetasym","\\vartheta");c("\\weierp","\\wp");c("\\quantity","{\\left\\{ #1 \\right\\}}");c("\\qty","{\\left\\{ #1 \\right\\}}");c("\\pqty","{\\left( #1 \\right)}");c("\\bqty","{\\left[ #1 \\right]}");c("\\vqty","{\\left\\vert #1 \\right\\vert}");c("\\Bqty","{\\left\\{ #1 \\right\\}}");c("\\absolutevalue","{\\left\\vert #1 \\right\\vert}");c("\\abs","{\\left\\vert #1 \\right\\vert}");c("\\norm","{\\left\\Vert #1 \\right\\Vert}");c("\\evaluated","{\\left.#1 \\right\\vert}");c("\\eval","{\\left.#1 \\right\\vert}");c("\\order","{\\mathcal{O} \\left( #1 \\right)}");c("\\commutator","{\\left[ #1 , #2 \\right]}");c("\\comm","{\\left[ #1 , #2 \\right]}");c("\\anticommutator","{\\left\\{ #1 , #2 \\right\\}}");c("\\acomm","{\\left\\{ #1 , #2 \\right\\}}");c("\\poissonbracket","{\\left\\{ #1 , #2 \\right\\}}");c("\\pb","{\\left\\{ #1 , #2 \\right\\}}");c("\\vectorbold","{\\boldsymbol{ #1 }}");c("\\vb","{\\boldsymbol{ #1 }}");c("\\vectorarrow","{\\vec{\\boldsymbol{ #1 }}}");c("\\va","{\\vec{\\boldsymbol{ #1 }}}");c("\\vectorunit","{{\\boldsymbol{\\hat{ #1 }}}}");c("\\vu","{{\\boldsymbol{\\hat{ #1 }}}}");c("\\dotproduct","\\mathbin{\\boldsymbol\\cdot}");c("\\vdot","{\\boldsymbol\\cdot}");c("\\crossproduct","\\mathbin{\\boldsymbol\\times}");c("\\cross","\\mathbin{\\boldsymbol\\times}");c("\\cp","\\mathbin{\\boldsymbol\\times}");c("\\gradient","{\\boldsymbol\\nabla}");c("\\grad","{\\boldsymbol\\nabla}");c("\\divergence","{\\grad\\vdot}");c("\\curl","{\\grad\\cross}");c("\\laplacian","\\nabla^2");c("\\tr","{\\operatorname{tr}}");c("\\Tr","{\\operatorname{Tr}}");c("\\rank","{\\operatorname{rank}}");c("\\erf","{\\operatorname{erf}}");c("\\Res","{\\operatorname{Res}}");c("\\principalvalue","{\\mathcal{P}}");c("\\pv","{\\mathcal{P}}");c("\\PV","{\\operatorname{P.V.}}");c("\\qqtext","{\\quad\\text{ #1 }\\quad}");c("\\qq","{\\quad\\text{ #1 }\\quad}");c("\\qcomma","{\\text{,}\\quad}");c("\\qc","{\\text{,}\\quad}");c("\\qcc","{\\quad\\text{c.c.}\\quad}");c("\\qif","{\\quad\\text{if}\\quad}");c("\\qthen","{\\quad\\text{then}\\quad}");c("\\qelse","{\\quad\\text{else}\\quad}");c("\\qotherwise","{\\quad\\text{otherwise}\\quad}");c("\\qunless","{\\quad\\text{unless}\\quad}");c("\\qgiven","{\\quad\\text{given}\\quad}");c("\\qusing","{\\quad\\text{using}\\quad}");c("\\qassume","{\\quad\\text{assume}\\quad}");c("\\qsince","{\\quad\\text{since}\\quad}");c("\\qlet","{\\quad\\text{let}\\quad}");c("\\qfor","{\\quad\\text{for}\\quad}");c("\\qall","{\\quad\\text{all}\\quad}");c("\\qeven","{\\quad\\text{even}\\quad}");c("\\qodd","{\\quad\\text{odd}\\quad}");c("\\qinteger","{\\quad\\text{integer}\\quad}");c("\\qand","{\\quad\\text{and}\\quad}");c("\\qor","{\\quad\\text{or}\\quad}");c("\\qas","{\\quad\\text{as}\\quad}");c("\\qin","{\\quad\\text{in}\\quad}");c("\\differential","{\\text{d}}");c("\\dd","{\\text{d}}");c("\\derivative","{\\frac{\\text{d}{ #1 }}{\\text{d}{ #2 }}}");c("\\dv","{\\frac{\\text{d}{ #1 }}{\\text{d}{ #2 }}}");c("\\partialderivative","{\\frac{\\partial{ #1 }}{\\partial{ #2 }}}");c("\\variation","{\\delta}");c("\\var","{\\delta}");c("\\functionalderivative","{\\frac{\\delta{ #1 }}{\\delta{ #2 }}}");c("\\fdv","{\\frac{\\delta{ #1 }}{\\delta{ #2 }}}");c("\\innerproduct","{\\left\\langle {#1} \\mid { #2} \\right\\rangle}");c("\\outerproduct","{\\left\\vert { #1 } \\right\\rangle\\left\\langle { #2} \\right\\vert}");c("\\dyad","{\\left\\vert { #1 } \\right\\rangle\\left\\langle { #2} \\right\\vert}");c("\\ketbra","{\\left\\vert { #1 } \\right\\rangle\\left\\langle { #2} \\right\\vert}");c("\\op","{\\left\\vert { #1 } \\right\\rangle\\left\\langle { #2} \\right\\vert}");c("\\expectationvalue","{\\left\\langle {#1 } \\right\\rangle}");c("\\expval","{\\left\\langle {#1 } \\right\\rangle}");c("\\ev","{\\left\\langle {#1 } \\right\\rangle}");c("\\matrixelement","{\\left\\langle{ #1 }\\right\\vert{ #2 }\\left\\vert{#3}\\right\\rangle}");c("\\matrixel","{\\left\\langle{ #1 }\\right\\vert{ #2 }\\left\\vert{#3}\\right\\rangle}");c("\\mel","{\\left\\langle{ #1 }\\right\\vert{ #2 }\\left\\vert{#3}\\right\\rangle}");const Or={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class yo{constructor(t,r,n){this.settings=r,this.expansionCount=0,this.feed(t),this.macros=new bo(xo,r.macros),this.mode=n,this.stack=[]}feed(t){this.lexer=new Kt(t,this.settings)}switchMode(t){this.mode=t}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}future(){return this.stack.length===0&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(t){this.stack.push(t)}pushTokens(t){this.stack.push(...t)}scanArgument(t){let r,n,o;if(t){if(this.consumeSpaces(),this.future().text!=="[")return null;r=this.popToken(),{tokens:o,end:n}=this.consumeArg(["]"])}else({tokens:o,start:r,end:n}=this.consumeArg());return this.pushToken(new se("EOF",n.loc)),this.pushTokens(o),r.range(n,"")}consumeSpaces(){for(;this.future().text===" ";)this.stack.pop()}consumeArg(t){const r=[],n=t&&t.length>0;n||this.consumeSpaces();const o=this.future();let a,l=0,u=0;do{if(a=this.popToken(),r.push(a),a.text==="{")++l;else if(a.text==="}"){if(--l,l===-1)throw new w("Extra }",a)}else if(a.text==="EOF")throw new w("Unexpected end of input in a macro argument, expected '"+(t&&n?t[u]:"}")+"'",a);if(t&&n)if((l===0||l===1&&t[u]==="{")&&a.text===t[u]){if(++u,u===t.length){r.splice(-u,u);break}}else u=0}while(l!==0||n);return o.text==="{"&&r[r.length-1].text==="}"&&(r.pop(),r.shift()),r.reverse(),{tokens:r,start:o,end:a}}consumeArgs(t,r){if(r){if(r.length!==t+1)throw new w("The length of delimiters doesn't match the number of args!");const o=r[0];for(let a=0;a<o.length;a++){const l=this.popToken();if(o[a]!==l.text)throw new w("Use of the macro doesn't match its definition",l)}}const n=[];for(let o=0;o<t;o++)n.push(this.consumeArg(r&&r[o+1]).tokens);return n}expandOnce(t){const r=this.popToken(),n=r.text,o=r.noexpand?null:this._getExpansion(n);if(o==null||t&&o.unexpandable){if(t&&o==null&&n[0]==="\\"&&!this.isDefined(n))throw new w("Undefined control sequence: "+n);return this.pushToken(r),!1}if(this.expansionCount++,this.expansionCount>this.settings.maxExpand)throw new w("Too many expansions: infinite loop or need to increase maxExpand setting");let a=o.tokens;const l=this.consumeArgs(o.numArgs,o.delimiters);if(o.numArgs){a=a.slice();for(let u=a.length-1;u>=0;--u){let h=a[u];if(h.text==="#"){if(u===0)throw new w("Incomplete placeholder at end of macro body",h);if(h=a[--u],h.text==="#")a.splice(u+1,1);else if(/^[1-9]$/.test(h.text))a.splice(u,2,...l[+h.text-1]);else throw new w("Not a valid argument number",h)}}}return this.pushTokens(a),a.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(this.expandOnce()===!1){const t=this.stack.pop();return t.treatAsRelax&&(t.text="\\relax"),t}throw new Error}expandMacro(t){return this.macros.has(t)?this.expandTokens([new se(t)]):void 0}expandTokens(t){const r=[],n=this.stack.length;for(this.pushTokens(t);this.stack.length>n;)if(this.expandOnce(!0)===!1){const o=this.stack.pop();o.treatAsRelax&&(o.noexpand=!1,o.treatAsRelax=!1),r.push(o)}return r}expandMacroAsText(t){const r=this.expandMacro(t);return r&&r.map(n=>n.text).join("")}_getExpansion(t){const r=this.macros.get(t);if(r==null)return r;if(t.length===1){const o=this.lexer.catcodes[t];if(o!=null&&o!==13)return}const n=typeof r=="function"?r(this):r;if(typeof n=="string"){let o=0;if(n.indexOf("#")!==-1){const g=n.replace(/##/g,"");for(;g.indexOf("#"+(o+1))!==-1;)++o}const a=new Kt(n,this.settings),l=[];let u=a.lex();for(;u.text!=="EOF";)l.push(u),u=a.lex();return l.reverse(),{tokens:l,numArgs:o}}return n}isDefined(t){return this.macros.has(t)||Object.prototype.hasOwnProperty.call(ge,t)||Object.prototype.hasOwnProperty.call(j.math,t)||Object.prototype.hasOwnProperty.call(j.text,t)||Object.prototype.hasOwnProperty.call(Or,t)}isExpandable(t){const r=this.macros.get(t);return r!=null?typeof r=="string"||typeof r=="function"||!r.unexpandable:Object.prototype.hasOwnProperty.call(ge,t)&&!ge[t].primitive}}const tr=/^[₊₋₌₍₎₀₁₂₃₄₅₆₇₈₉ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓᵦᵧᵨᵩᵪ]/,Pe=Object.freeze({"₊":"+","₋":"-","₌":"=","₍":"(","₎":")","₀":"0","₁":"1","₂":"2","₃":"3","₄":"4","₅":"5","₆":"6","₇":"7","₈":"8","₉":"9","ₐ":"a","ₑ":"e","ₕ":"h","ᵢ":"i","ⱼ":"j","ₖ":"k","ₗ":"l","ₘ":"m","ₙ":"n","ₒ":"o","ₚ":"p","ᵣ":"r","ₛ":"s","ₜ":"t","ᵤ":"u","ᵥ":"v","ₓ":"x","ᵦ":"β","ᵧ":"γ","ᵨ":"ρ","ᵩ":"ϕ","ᵪ":"χ","⁺":"+","⁻":"-","⁼":"=","⁽":"(","⁾":")","⁰":"0","¹":"1","²":"2","³":"3","⁴":"4","⁵":"5","⁶":"6","⁷":"7","⁸":"8","⁹":"9","ᴬ":"A","ᴮ":"B","ᴰ":"D","ᴱ":"E","ᴳ":"G","ᴴ":"H","ᴵ":"I","ᴶ":"J","ᴷ":"K","ᴸ":"L","ᴹ":"M","ᴺ":"N","ᴼ":"O","ᴾ":"P","ᴿ":"R","ᵀ":"T","ᵁ":"U","ⱽ":"V","ᵂ":"W","ᵃ":"a","ᵇ":"b","ᶜ":"c","ᵈ":"d","ᵉ":"e","ᶠ":"f","ᵍ":"g",ʰ:"h","ⁱ":"i",ʲ:"j","ᵏ":"k",ˡ:"l","ᵐ":"m",ⁿ:"n","ᵒ":"o","ᵖ":"p",ʳ:"r",ˢ:"s","ᵗ":"t","ᵘ":"u","ᵛ":"v",ʷ:"w",ˣ:"x",ʸ:"y","ᶻ":"z","ᵝ":"β","ᵞ":"γ","ᵟ":"δ","ᵠ":"ϕ","ᵡ":"χ","ᶿ":"θ"}),rr=Object.freeze({"𝒜":"A",ℬ:"B","𝒞":"C","𝒟":"D",ℰ:"E",ℱ:"F","𝒢":"G",ℋ:"H",ℐ:"I","𝒥":"J","𝒦":"K",ℒ:"L",ℳ:"M","𝒩":"N","𝒪":"O","𝒫":"P","𝒬":"Q",ℛ:"R","𝒮":"S","𝒯":"T","𝒰":"U","𝒱":"V","𝒲":"W","𝒳":"X","𝒴":"Y","𝒵":"Z"});var rt={"́":{text:"\\'",math:"\\acute"},"̀":{text:"\\`",math:"\\grave"},"̈":{text:'\\"',math:"\\ddot"},"̃":{text:"\\~",math:"\\tilde"},"̄":{text:"\\=",math:"\\bar"},"̆":{text:"\\u",math:"\\breve"},"̌":{text:"\\v",math:"\\check"},"̂":{text:"\\^",math:"\\hat"},"̇":{text:"\\.",math:"\\dot"},"̊":{text:"\\r",math:"\\mathring"},"̋":{text:"\\H"},"̧":{text:"\\c"}},nr={á:"á",à:"à",ä:"ä",ǟ:"ǟ",ã:"ã",ā:"ā",ă:"ă",ắ:"ắ",ằ:"ằ",ẵ:"ẵ",ǎ:"ǎ",â:"â",ấ:"ấ",ầ:"ầ",ẫ:"ẫ",ȧ:"ȧ",ǡ:"ǡ",å:"å",ǻ:"ǻ",ḃ:"ḃ",ć:"ć",č:"č",ĉ:"ĉ",ċ:"ċ",ď:"ď",ḋ:"ḋ",é:"é",è:"è",ë:"ë",ẽ:"ẽ",ē:"ē",ḗ:"ḗ",ḕ:"ḕ",ĕ:"ĕ",ě:"ě",ê:"ê",ế:"ế",ề:"ề",ễ:"ễ",ė:"ė",ḟ:"ḟ",ǵ:"ǵ",ḡ:"ḡ",ğ:"ğ",ǧ:"ǧ",ĝ:"ĝ",ġ:"ġ",ḧ:"ḧ",ȟ:"ȟ",ĥ:"ĥ",ḣ:"ḣ",í:"í",ì:"ì",ï:"ï",ḯ:"ḯ",ĩ:"ĩ",ī:"ī",ĭ:"ĭ",ǐ:"ǐ",î:"î",ǰ:"ǰ",ĵ:"ĵ",ḱ:"ḱ",ǩ:"ǩ",ĺ:"ĺ",ľ:"ľ",ḿ:"ḿ",ṁ:"ṁ",ń:"ń",ǹ:"ǹ",ñ:"ñ",ň:"ň",ṅ:"ṅ",ó:"ó",ò:"ò",ö:"ö",ȫ:"ȫ",õ:"õ",ṍ:"ṍ",ṏ:"ṏ",ȭ:"ȭ",ō:"ō",ṓ:"ṓ",ṑ:"ṑ",ŏ:"ŏ",ǒ:"ǒ",ô:"ô",ố:"ố",ồ:"ồ",ỗ:"ỗ",ȯ:"ȯ",ȱ:"ȱ",ő:"ő",ṕ:"ṕ",ṗ:"ṗ",ŕ:"ŕ",ř:"ř",ṙ:"ṙ",ś:"ś",ṥ:"ṥ",š:"š",ṧ:"ṧ",ŝ:"ŝ",ṡ:"ṡ",ẗ:"ẗ",ť:"ť",ṫ:"ṫ",ú:"ú",ù:"ù",ü:"ü",ǘ:"ǘ",ǜ:"ǜ",ǖ:"ǖ",ǚ:"ǚ",ũ:"ũ",ṹ:"ṹ",ū:"ū",ṻ:"ṻ",ŭ:"ŭ",ǔ:"ǔ",û:"û",ů:"ů",ű:"ű",ṽ:"ṽ",ẃ:"ẃ",ẁ:"ẁ",ẅ:"ẅ",ŵ:"ŵ",ẇ:"ẇ",ẘ:"ẘ",ẍ:"ẍ",ẋ:"ẋ",ý:"ý",ỳ:"ỳ",ÿ:"ÿ",ỹ:"ỹ",ȳ:"ȳ",ŷ:"ŷ",ẏ:"ẏ",ẙ:"ẙ",ź:"ź",ž:"ž",ẑ:"ẑ",ż:"ż",Á:"Á",À:"À",Ä:"Ä",Ǟ:"Ǟ",Ã:"Ã",Ā:"Ā",Ă:"Ă",Ắ:"Ắ",Ằ:"Ằ",Ẵ:"Ẵ",Ǎ:"Ǎ",Â:"Â",Ấ:"Ấ",Ầ:"Ầ",Ẫ:"Ẫ",Ȧ:"Ȧ",Ǡ:"Ǡ",Å:"Å",Ǻ:"Ǻ",Ḃ:"Ḃ",Ć:"Ć",Č:"Č",Ĉ:"Ĉ",Ċ:"Ċ",Ď:"Ď",Ḋ:"Ḋ",É:"É",È:"È",Ë:"Ë",Ẽ:"Ẽ",Ē:"Ē",Ḗ:"Ḗ",Ḕ:"Ḕ",Ĕ:"Ĕ",Ě:"Ě",Ê:"Ê",Ế:"Ế",Ề:"Ề",Ễ:"Ễ",Ė:"Ė",Ḟ:"Ḟ",Ǵ:"Ǵ",Ḡ:"Ḡ",Ğ:"Ğ",Ǧ:"Ǧ",Ĝ:"Ĝ",Ġ:"Ġ",Ḧ:"Ḧ",Ȟ:"Ȟ",Ĥ:"Ĥ",Ḣ:"Ḣ",Í:"Í",Ì:"Ì",Ï:"Ï",Ḯ:"Ḯ",Ĩ:"Ĩ",Ī:"Ī",Ĭ:"Ĭ",Ǐ:"Ǐ",Î:"Î",İ:"İ",Ĵ:"Ĵ",Ḱ:"Ḱ",Ǩ:"Ǩ",Ĺ:"Ĺ",Ľ:"Ľ",Ḿ:"Ḿ",Ṁ:"Ṁ",Ń:"Ń",Ǹ:"Ǹ",Ñ:"Ñ",Ň:"Ň",Ṅ:"Ṅ",Ó:"Ó",Ò:"Ò",Ö:"Ö",Ȫ:"Ȫ",Õ:"Õ",Ṍ:"Ṍ",Ṏ:"Ṏ",Ȭ:"Ȭ",Ō:"Ō",Ṓ:"Ṓ",Ṑ:"Ṑ",Ŏ:"Ŏ",Ǒ:"Ǒ",Ô:"Ô",Ố:"Ố",Ồ:"Ồ",Ỗ:"Ỗ",Ȯ:"Ȯ",Ȱ:"Ȱ",Ő:"Ő",Ṕ:"Ṕ",Ṗ:"Ṗ",Ŕ:"Ŕ",Ř:"Ř",Ṙ:"Ṙ",Ś:"Ś",Ṥ:"Ṥ",Š:"Š",Ṧ:"Ṧ",Ŝ:"Ŝ",Ṡ:"Ṡ",Ť:"Ť",Ṫ:"Ṫ",Ú:"Ú",Ù:"Ù",Ü:"Ü",Ǘ:"Ǘ",Ǜ:"Ǜ",Ǖ:"Ǖ",Ǚ:"Ǚ",Ũ:"Ũ",Ṹ:"Ṹ",Ū:"Ū",Ṻ:"Ṻ",Ŭ:"Ŭ",Ǔ:"Ǔ",Û:"Û",Ů:"Ů",Ű:"Ű",Ṽ:"Ṽ",Ẃ:"Ẃ",Ẁ:"Ẁ",Ẅ:"Ẅ",Ŵ:"Ŵ",Ẇ:"Ẇ",Ẍ:"Ẍ",Ẋ:"Ẋ",Ý:"Ý",Ỳ:"Ỳ",Ÿ:"Ÿ",Ỹ:"Ỹ",Ȳ:"Ȳ",Ŷ:"Ŷ",Ẏ:"Ẏ",Ź:"Ź",Ž:"Ž",Ẑ:"Ẑ",Ż:"Ż",ά:"ά",ὰ:"ὰ",ᾱ:"ᾱ",ᾰ:"ᾰ",έ:"έ",ὲ:"ὲ",ή:"ή",ὴ:"ὴ",ί:"ί",ὶ:"ὶ",ϊ:"ϊ",ΐ:"ΐ",ῒ:"ῒ",ῑ:"ῑ",ῐ:"ῐ",ό:"ό",ὸ:"ὸ",ύ:"ύ",ὺ:"ὺ",ϋ:"ϋ",ΰ:"ΰ",ῢ:"ῢ",ῡ:"ῡ",ῠ:"ῠ",ώ:"ώ",ὼ:"ὼ",Ύ:"Ύ",Ὺ:"Ὺ",Ϋ:"Ϋ",Ῡ:"Ῡ",Ῠ:"Ῠ",Ώ:"Ώ",Ὼ:"Ὼ"};const vo=["bin","op","open","punct","rel"];class Je{constructor(t,r,n=!1){this.mode="math",this.gullet=new yo(t,r,this.mode),this.settings=r,this.isPreamble=n,this.leftrightDepth=0,this.prevAtomType=""}expect(t,r=!0){if(this.fetch().text!==t)throw new w(`Expected '${t}', got '${this.fetch().text}'`,this.fetch());r&&this.consume()}consume(){this.nextToken=null}fetch(){return this.nextToken==null&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(t){this.mode=t,this.gullet.switchMode(t)}parse(){this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");const t=this.parseExpression(!1);if(this.expect("EOF"),this.isPreamble){const n=Object.create(null);return Object.entries(this.gullet.macros.current).forEach(([o,a])=>{n[o]=a}),this.gullet.endGroup(),n}const r=this.gullet.macros.get("\\df@tag");return this.gullet.endGroup(),r&&(this.gullet.macros.current["\\df@tag"]=r),t}static get endOfExpression(){return["}","\\endgroup","\\end","\\right","\\endtoggle","&"]}subparse(t){const r=this.nextToken;this.consume(),this.gullet.pushToken(new se("}")),this.gullet.pushTokens(t);const n=this.parseExpression(!1);return this.expect("}"),this.nextToken=r,n}parseExpression(t,r,n){const o=[];for(;;){this.mode==="math"&&this.consumeSpaces();const a=this.fetch();if(Je.endOfExpression.indexOf(a.text)!==-1||r&&a.text===r||n&&a.text==="\\middle"||t&&ge[a.text]&&ge[a.text].infix)break;const l=this.parseAtom(r);if(l){if(l.type==="internal")continue}else break;o.push(l),this.prevAtomType=l.type==="atom"?l.family:l.type}return this.mode==="text"&&this.formLigatures(o),this.handleInfixNodes(o)}handleInfixNodes(t){let r=-1,n;for(let o=0;o<t.length;o++)if(t[o].type==="infix"){if(r!==-1)throw new w("only one infix operator per group",t[o].token);r=o,n=t[o].replaceWith}if(r!==-1&&n){let o,a;const l=t.slice(0,r),u=t.slice(r+1);l.length===1&&l[0].type==="ordgroup"?o=l[0]:o={type:"ordgroup",mode:this.mode,body:l},u.length===1&&u[0].type==="ordgroup"?a=u[0]:a={type:"ordgroup",mode:this.mode,body:u};let h;return n==="\\\\abovefrac"?h=this.callFunction(n,[o,t[r],a],[]):h=this.callFunction(n,[o,a],[]),[h]}else return t}handleSupSubscript(t){const r=this.fetch(),n=r.text;this.consume(),this.consumeSpaces();const o=this.parseGroup(t);if(!o)throw new w("Expected group after '"+n+"'",r);return o}formatUnsupportedCmd(t){const r=[];for(let a=0;a<t.length;a++)r.push({type:"textord",mode:"text",text:t[a]});const n={type:"text",mode:this.mode,body:r};return{type:"color",mode:this.mode,color:this.settings.errorColor,body:[n]}}parseAtom(t){const r=this.parseGroup("atom",t);if(this.mode==="text")return r;let n,o;for(;;){this.consumeSpaces();const a=this.fetch();if(a.text==="\\limits"||a.text==="\\nolimits"){if(r&&r.type==="op"){const l=a.text==="\\limits";r.limits=l,r.alwaysHandleSupSub=!0}else if(r&&r.type==="operatorname")r.alwaysHandleSupSub&&(r.limits=a.text==="\\limits");else throw new w("Limit controls must follow a math operator",a);this.consume()}else if(a.text==="^"){if(n)throw new w("Double superscript",a);n=this.handleSupSubscript("superscript")}else if(a.text==="_"){if(o)throw new w("Double subscript",a);o=this.handleSupSubscript("subscript")}else if(a.text==="'"){if(n)throw new w("Double superscript",a);const l={type:"textord",mode:this.mode,text:"\\prime"},u=[l];for(this.consume();this.fetch().text==="'";)u.push(l),this.consume();this.fetch().text==="^"&&u.push(this.handleSupSubscript("superscript")),n={type:"ordgroup",mode:this.mode,body:u}}else if(Pe[a.text]){const l=tr.test(a.text),u=[];for(u.push(new se(Pe[a.text])),this.consume();;){const g=this.fetch().text;if(!Pe[g]||tr.test(g)!==l)break;u.unshift(new se(Pe[g])),this.consume()}const h=this.subparse(u);l?o={type:"ordgroup",mode:"math",body:h}:n={type:"ordgroup",mode:"math",body:h}}else break}if(n||o){if(r&&r.type==="multiscript"&&!r.postscripts)return r.postscripts={sup:n,sub:o},r;{const a=!r||r.type!=="op"&&r.type!=="operatorname"?void 0:Ye(this.nextToken.text);return{type:"supsub",mode:this.mode,base:r,sup:n,sub:o,isFollowedByDelimiter:a}}}else return r}parseFunction(t,r){const n=this.fetch(),o=n.text,a=ge[o];if(!a)return null;if(this.consume(),r&&r!=="atom"&&!a.allowedInArgument)throw new w("Got function '"+o+"' with no arguments"+(r?" as "+r:""),n);if(this.mode==="text"&&!a.allowedInText)throw new w("Can't use function '"+o+"' in text mode",n);if(this.mode==="math"&&a.allowedInMath===!1)throw new w("Can't use function '"+o+"' in math mode",n);const l=this.prevAtomType,{args:u,optArgs:h}=this.parseArguments(o,a);return this.prevAtomType=l,this.callFunction(o,u,h,n,t)}callFunction(t,r,n,o,a){const l={funcName:t,parser:this,token:o,breakOnTokenText:a},u=ge[t];if(u&&u.handler)return u.handler(l,r,n);throw new w(`No function handler for ${t}`)}parseArguments(t,r){const n=r.numArgs+r.numOptionalArgs;if(n===0)return{args:[],optArgs:[]};const o=[],a=[];for(let l=0;l<n;l++){let u=r.argTypes&&r.argTypes[l];const h=l<r.numOptionalArgs;(r.primitive&&u==null||r.type==="sqrt"&&l===1&&a[0]==null)&&(u="primitive");const g=this.parseGroupOfType(`argument to '${t}'`,u,h);if(h)a.push(g);else if(g!=null)o.push(g);else throw new w("Null argument, please report this as a bug")}return{args:o,optArgs:a}}parseGroupOfType(t,r,n){switch(r){case"size":return this.parseSizeGroup(n);case"url":return this.parseUrlGroup(n);case"math":case"text":return this.parseArgumentGroup(n,r);case"hbox":{const o=this.parseArgumentGroup(n,"text");return o!=null?{type:"styling",mode:o.mode,body:[o],scriptLevel:"text"}:null}case"raw":{const o=this.parseStringGroup("raw",n);return o!=null?{type:"raw",mode:"text",string:o.text}:null}case"primitive":{if(n)throw new w("A primitive argument cannot be optional");const o=this.parseGroup(t);if(o==null)throw new w("Expected group as "+t,this.fetch());return o}case"original":case null:case void 0:return this.parseArgumentGroup(n);default:throw new w("Unknown group type as "+t,this.fetch())}}consumeSpaces(){for(;;){const t=this.fetch().text;if(t===" "||t===" "||t==="︎")this.consume();else break}}parseStringGroup(t,r){const n=this.gullet.scanArgument(r);if(n==null)return null;let o="",a;for(;(a=this.fetch()).text!=="EOF";)o+=a.text,this.consume();return this.consume(),n.text=o,n}parseRegexGroup(t,r){const n=this.fetch();let o=n,a="",l;for(;(l=this.fetch()).text!=="EOF"&&t.test(a+l.text);)o=l,a+=o.text,this.consume();if(a==="")throw new w("Invalid "+r+": '"+n.text+"'",n);return n.range(o,a)}parseSizeGroup(t){let r,n=!1;if(this.gullet.consumeSpaces(),!t&&this.gullet.future().text!=="{"?r=this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"):r=this.parseStringGroup("size",t),!r)return null;!t&&r.text.length===0&&(r.text="0pt",n=!0);const o=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(r.text);if(!o)throw new w("Invalid size: '"+r.text+"'",r);const a={number:+(o[1]+o[2]),unit:o[3]};if(!cr(a))throw new w("Invalid unit: '"+a.unit+"'",r);return{type:"size",mode:this.mode,value:a,isBlank:n}}parseUrlGroup(t){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);const r=this.parseStringGroup("url",t);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),r==null)return null;let n=r.text.replace(/\\([#$%&~_^{}])/g,"$1");return n=r.text.replace(/{\u2044}/g,"/"),{type:"url",mode:this.mode,url:n}}parseArgumentGroup(t,r){const n=this.gullet.scanArgument(t);if(n==null)return null;const o=this.mode;r&&this.switchMode(r),this.gullet.beginGroup();const a=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();const l={type:"ordgroup",mode:this.mode,loc:n.loc,body:a};return r&&this.switchMode(o),l}parseGroup(t,r){const n=this.fetch(),o=n.text;let a;if(o==="{"||o==="\\begingroup"||o==="\\toggle"){this.consume();const l=o==="{"?"}":o==="\\begingroup"?"\\endgroup":"\\endtoggle";this.gullet.beginGroup();const u=this.parseExpression(!1,l),h=this.fetch();this.expect(l),this.gullet.endGroup(),a={type:h.text==="\\endtoggle"?"toggle":"ordgroup",mode:this.mode,loc:J.range(n,h),body:u,semisimple:o==="\\begingroup"||void 0}}else a=this.parseFunction(r,t)||this.parseSymbol(),a==null&&o[0]==="\\"&&!Object.prototype.hasOwnProperty.call(Or,o)&&(a=this.formatUnsupportedCmd(o),this.consume());return a}formLigatures(t){let r=t.length-1;for(let n=0;n<r;++n){const o=t[n],a=o.text;a==="-"&&t[n+1].text==="-"&&(n+1<r&&t[n+2].text==="-"?(t.splice(n,3,{type:"textord",mode:"text",loc:J.range(o,t[n+2]),text:"---"}),r-=2):(t.splice(n,2,{type:"textord",mode:"text",loc:J.range(o,t[n+1]),text:"--"}),r-=1)),(a==="'"||a==="`")&&t[n+1].text===a&&(t.splice(n,2,{type:"textord",mode:"text",loc:J.range(o,t[n+1]),text:a+a}),r-=1)}}parseSymbol(){const t=this.fetch();let r=t.text;if(/^\\verb[^a-zA-Z]/.test(r)){this.consume();let a=r.slice(5);const l=a.charAt(0)==="*";if(l&&(a=a.slice(1)),a.length<2||a.charAt(0)!==a.slice(-1))throw new w(`\\verb assertion failed --
                    please report what input caused this bug`);return a=a.slice(1,-1),{type:"verb",mode:"text",body:a,star:l}}if(Object.prototype.hasOwnProperty.call(nr,r[0])&&!j[this.mode][r[0]]){if(this.settings.strict&&this.mode==="math")throw new w(`Accented Unicode text character "${r[0]}" used in math mode`,t);r=nr[r[0]]+r.slice(1)}const n=fo.exec(r);n&&(r=r.substring(0,n.index),r==="i"?r="ı":r==="j"&&(r="ȷ"));let o;if(j[this.mode][r]){let a=j[this.mode][r].group;a==="bin"&&vo.includes(this.prevAtomType)&&(a="open");const l=J.range(t);let u;if(Object.prototype.hasOwnProperty.call(en,a)){const h=a;u={type:"atom",mode:this.mode,family:h,loc:l,text:r}}else{if(rr[r]){this.consume();const h=this.fetch().text.charCodeAt(0),g=h===65025?"mathscr":"mathcal";return(h===65024||h===65025)&&this.consume(),{type:"font",mode:"math",font:g,body:{type:"mathord",mode:"math",loc:l,text:rr[r]}}}u={type:a,mode:this.mode,loc:l,text:r}}o=u}else if(r.charCodeAt(0)>=128){if(this.settings.strict&&this.mode==="math")throw new w(`Unicode text character "${r[0]}" used in math mode`,t);o={type:"textord",mode:"text",loc:J.range(t),text:r}}else return null;if(this.consume(),n)for(let a=0;a<n[0].length;a++){const l=n[0][a];if(!rt[l])throw new w(`Unknown accent ' ${l}'`,t);const u=rt[l][this.mode]||rt[l].text;if(!u)throw new w(`Accent ${l} unsupported in ${this.mode} mode`,t);o={type:"accent",mode:this.mode,loc:J.range(t),label:u,isStretchy:!1,base:o}}return o}}const Cr=function(e,t){if(!(typeof e=="string"||e instanceof String))throw new TypeError("Temml can only parse string typed expression");const r=new Je(e,t);delete r.gullet.macros.current["\\df@tag"];let n=r.parse();if(!(n.length>0&&n[0].type&&n[0].type==="array"&&n[0].addEqnNum)&&r.gullet.macros.get("\\df@tag")){if(!t.displayMode)throw new w("\\tag works only in display mode");r.gullet.feed("\\df@tag"),n=[{type:"tag",mode:"text",body:n,tag:r.parse()}]}return n},ko=[2,2,3,3];class xt{constructor(t){this.level=t.level,this.color=t.color,this.font=t.font||"",this.fontFamily=t.fontFamily||"",this.fontSize=t.fontSize||1,this.fontWeight=t.fontWeight||"",this.fontShape=t.fontShape||"",this.maxSize=t.maxSize}extend(t){const r={level:this.level,color:this.color,font:this.font,fontFamily:this.fontFamily,fontSize:this.fontSize,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);return new xt(r)}withLevel(t){return this.extend({level:t})}incrementLevel(){return this.extend({level:Math.min(this.level+1,3)})}inSubOrSup(){return this.extend({level:ko[this.level]})}withColor(t){return this.extend({color:t})}withFont(t){return this.extend({font:t})}withTextFontFamily(t){return this.extend({fontFamily:t,font:""})}withFontSize(t){return this.extend({fontSize:t})}withTextFontWeight(t){return this.extend({fontWeight:t,font:""})}withTextFontShape(t){return this.extend({fontShape:t,font:""})}getColor(){return this.color}}const So="0.10.22";function Ao(e){const t={};let r=0;const n=e.getElementsByClassName("tml-tageqn");for(const a of n){const l=a.getElementsByClassName("tml-eqn");l.length>0&&(r+=1,l[0].id="tml-eqn-"+r);const u=a.getElementsByClassName("tml-label");if(u.length!==0)if(l.length>0)t[u[0].id]=String(r);else{const h=a.getElementsByClassName("tml-tag");h.length>0&&(t[u[0].id]=h[0].textContent)}}[...e.getElementsByClassName("tml-ref")].forEach(a=>{let l=t[a.getAttribute("href").slice(1)];a.className.indexOf("tml-eqref")===-1&&(l=l.replace(/^\(/,""),l=l.replace(/\($/,"")),l.charAt(0)!=="("&&(l="("+l),l.slice(-1)!==")"&&(l=l+")"),a.textContent=l})}let Br=function(e,t,r={}){t.textContent="";const n=t.tagName.toLowerCase()==="math";n&&(r.wrap="none");const o=wt(e,r);n?(t.textContent="",o.children.forEach(a=>{t.appendChild(a.toNode())})):o.children.length>1?(t.textContent="",o.children.forEach(a=>{t.appendChild(a.toNode())})):t.appendChild(o.toNode())};typeof document<"u"&&document.compatMode!=="CSS1Compat"&&(typeof console<"u"&&console.warn("Warning: Temml doesn't work in quirks mode. Make sure your website has a suitable doctype."),Br=function(){throw new w("Temml doesn't work in quirks mode.")});const _o=function(e,t){return wt(e,t).toMarkup()},qo=function(e,t){const r=new at(t);return Cr(e,r)},To=function(e,t){const r=new at(t);if(r.macros={},!(typeof e=="string"||e instanceof String))throw new TypeError("Temml can only parse string typed expression");const n=new Je(e,r,!0);return delete n.gullet.macros.current["\\df@tag"],n.parse()},$o=function(e,t,r){if(r.throwOnError||!(e instanceof w))throw e;const n=new ir(["temml-error"],[new Zr(t+`
`+e.toString())]);return n.style.color=r.errorColor,n.style.whiteSpace="pre-line",n},wt=function(e,t){const r=new at(t);try{const n=Cr(e,r),o=new xt({level:r.displayMode?G.DISPLAY:G.TEXT,maxSize:r.maxSize});return cn(n,e,o,r)}catch(n){return $o(n,e,r)}};var Ae={version:So,render:Br,renderToString:_o,postProcess:Ao,ParseError:w,definePreamble:To,__parse:qo,__renderToMathMLTree:wt,__defineSymbol:s,__defineMacro:c};let ie=[ee(2,5),ee(2,-5),ee(-2,5),ee(-2,-5),ee(2,Qe(-5)),ee(2,["()",-5]),ee(["()",-2],["()",-5]),ee(2,ve(-1,Qe(-5))),ee(2,[-1,Qe(-5)]),ee(["()",-2],[-1,["()",-5]])],ne=ie.map(e=>`<div>${Ae.renderToString(e.toString())}</div>`).join(`
`);ne+=`<hr>
`;let ue=0,pe=[];for(const e of ie){let t=e.toString();ue<4?(e.simplify(),t+=" = "+e.toString()):ue<7?(e._remove_brackets(),t+=" = "+e.toString(),t+=" = "+e.simplify().toString()):(e._remove_brackets(),e.simplify({product:!0}),t+=" = "+e.toString(),t+=" = "+e.simplify().toString()),pe.push(t),ue++}ne+=pe.map(e=>`<div>${Ae.renderToString(e.toString())}</div>`).join(`
`);document.querySelector("#integer-addition").innerHTML=ne;ie=[ve(2,5),ve(2,-5),ve(-2,5),ve(-2,-5)];ie.forEach(e=>e.multiplicationSign=" \\times ");ne=ie.map(e=>`<div>${Ae.renderToString(e.toString())}</div>`).join(`
`);ne+=`<hr>
`;ue=0;pe=[];for(const e of ie){let t=e.toString();ue<4&&(e.simplify(),t+=" = "+e.toString()),pe.push(t),ue++}ne+=pe.map(e=>`<div>${Ae.renderToString(e.toString())}</div>`).join(`
`);document.querySelector("#integer-multiplication").innerHTML=ne;ie=[Re(10,5,{verbatim:!0}),Re(10,-5,{verbatim:!0}),De(-10,5,{verbatim:!0}),Re(-10,-5,{verbatim:!0})];ie.forEach(e=>e.multiplicationSign=" \\times ");ne=ie.map(e=>`<div>${Ae.renderToString("\\displaystyle "+e.toString())}</div>`).join(`
`);ne+=`<hr>
`;ue=0;pe=[];for(const e of ie){let t=e.toString();ue<4&&(e.simplify(),t+=" = "+e.toString()),pe.push(t),ue++}ne+=pe.map(e=>`<div>${Ae.renderToString("\\displaystyle "+e.toString())}</div>`).join(`
`);document.querySelector("#integer-division").innerHTML=ne;
